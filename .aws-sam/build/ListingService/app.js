"use strict";var Bu=Object.create;var Wr=Object.defineProperty;var Uu=Object.getOwnPropertyDescriptor;var Ku=Object.getOwnPropertyNames;var Zu=Object.getPrototypeOf,Gu=Object.prototype.hasOwnProperty;var Wu=(r,e,t)=>e in r?Wr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var qi=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Ju=(r,e)=>{for(var t in e)Wr(r,t,{get:e[t],enumerable:!0})},aa=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ku(e))!Gu.call(r,s)&&s!==t&&Wr(r,s,{get:()=>e[s],enumerable:!(n=Uu(e,s))||n.enumerable});return r};var ct=(r,e,t)=>(t=r!=null?Bu(Zu(r)):{},aa(e||!r||!r.__esModule?Wr(t,"default",{value:r,enumerable:!0}):t,r)),Hu=r=>aa(Wr({},"__esModule",{value:!0}),r);var c=(r,e,t)=>(Wu(r,typeof e!="symbol"?e+"":e,t),t);var Bo=qi(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});function Yc(r){return"source"in r&&"destination"in r?[r.source,r.destination]:[r,r]}var Xc=Symbol.for("__strategy__"),el=Symbol.for("__mappings__"),tl=Symbol.for("__metadata_map__"),rl=Symbol.for("__metadata_object_map__"),nl=Symbol.for("__error_handler__"),sl=Symbol.for("__naming_conventions__"),il=Symbol.for("__recursive_depth__"),ol=Symbol.for("__recursive_count__"),al=Symbol.for("__profile_configuration_context__"),Gp=Symbol.for("nodejs.util.inspect.custom");function zo(r){return r[nl]}function cl(r){return r[el]}function $i(r){return r[tl]}function ll(r){return r[rl]}function Wp(r){let e=r[sl];if(!!e)return Yc(e)}function ul(r){return r[il]}function Jp(r){return r[ol]}function Fo(r){return r[Xc]}function Io(r){return r[al]}function Hp(r,e,t,n,s,i){let o=Object.keys(e).reduce((f,u)=>{let y=u in r,h=t.some(T=>T===u),v=Object.getOwnPropertyDescriptor(e,u)?.writable===!0;return!h&&!y&&v&&r[u]===void 0&&f.push(u),f},[]),a=Wc(n),l=Wc(s);if(o.length){let f=`${a} -> ${l}`;i.handle(`
Unmapped properties for ${f}:
-------------------
${o.join(`,
`)}
`)}}function Wc(r){let e=r.toString();return r.name&&(e=r.name),e}function jr(r,e=[]){if(!e.length)return;let t,n=e.length;for(t=0;t<n&&r!=null;t++)r=r[e[t]];return t&&t==n?r:void 0}function kt(r,e,t,n=!1){let s=typeof e=="string"?Symbol.for(e):e,i=typeof t=="string"?Symbol.for(t):t,o=cl(r).get(s)?.get(i);if(o==null&&!n){let a=typeof e=="function"&&e.name||String(e),l=typeof t=="function"&&t.name||String(t),f=zo(r),u=`Mapping is not found for ${a} and ${l}`;throw f.handle(u),new Error(u)}return o}function Mr(r){return Object.getPrototypeOf(r)===Date||r===Date}function Qo(r){return Array.isArray(r)?!r.length:typeof r!="object"&&typeof r!="function"?!r:!Object.keys(r).length}function Ii(r,e){return r.length!==e.length?!1:r.every((t,n)=>e[n]===t)}function Kt(r){if(r==null)return!0;let e=Object.getPrototypeOf(r);return e===String||e===Number||e===Boolean||r===String||r===Number||r===Boolean}function qo(r,e,t){let{decomposedPath:n,base:s}=fl(e);return s===void 0?r:(dl(r,s),t=n.length<=1?t:qo(r[s],n.slice(1),t),Object.assign(r,{[s]:t}))}function wt(r,e,t){let{decomposedPath:n,base:s}=fl(e);s!==void 0&&(dl(r,s),n.length<=1?r[s]=t:wt(r[s],n.slice(1),t))}function fl(r){if(r.length<1)return{base:"",decomposedPath:[]};let e=r;return{base:r[0],decomposedPath:e}}function dl(r,e){r.hasOwnProperty(e)||(r[e]={})}function ml(r,e,t,n,s,i,o,a){let l,f=r[0],u=r[1],y=!(Kt(o)||Kt(a)||Mr(o)||Mr(a));switch(f){case 1:l=u(e);break;case 3:l=u();break;case 4:l=u(e,i,s?{extraArgs:()=>s}:void 0);break;case 5:l=u(e);break;case 2:case 7:case 8:l=u(e,n),y&&l!=null&&(l=Array.isArray(l)?i.mapArray(l,o,a):i.map(l,o,a));break;case 9:l=u(e,s||{});break;case 10:l=ml(u(e),e,t,n,s,i,o,a);break}return l}function pl(r,e){return t=>{e&&(e=qo(e,r,t))}}function Mo(r,e,t,n=!1){return ki({mapping:r,sourceObject:e,options:t,setMemberFn:pl,isMapArray:n})}function hl(r){return e=>t=>{t!==void 0&&wt(r,e,t)}}function gl(r){return e=>jr(r,e)}function Jc(r,e,t,n,s=!1){ki({sourceObject:e,mapping:r,setMemberFn:hl(t),getMemberFn:gl(t),options:n,isMapArray:s})}function ki({mapping:r,sourceObject:e,options:t,setMemberFn:n,getMemberFn:s,isMapArray:i=!1}){let[[o,a],[,l],f,,u,y,,[h,v]=[]]=r,{beforeMap:T,afterMap:b,destinationConstructor:L=y,extraArgs:C}=t??{},q=zo(u),z=$i(u),I=L(e,a),D=C?.(r,I),Y=[];if(!i){let P=T??h;P&&P(e,I,D)}for(let P=0,F=f.length;P<F;P++){let[Z,[,[S,[G,B=void 0]=[]]],[W,ie]=[]]=f[P],me=!Kt(W)&&!Mr(W)&&!Kt(ie)&&!Mr(ie)&&ie===W;me&&(me=!kt(u,ie,W,!0));let pe=ze=>{try{return n(Z,I)(ze())}catch(_){let $=`
Error at "${Z}" on ${a.prototype?.constructor?.name||a.toString()} (${JSON.stringify(I)})
---------------------------------------------------------------------
Original error: ${_}`;throw q.handle($),new Error($)}};if(Y.push(Z[0]),G&&!G(e)){pe(()=>B);continue}if(S[0]===6){let ze=z.get(a),_=ze&&ze.find(re=>Ii(re[0],Z))===null,$=S[1](e),se=S[2];if($==null||$ instanceof Date||Object.prototype.toString.call($).slice(8,-1)==="File"||_||me||se){pe(()=>$);continue}if(Array.isArray($)){let[re]=$;if(typeof re!="object"||re instanceof Date||Object.prototype.toString.call(re).slice(8,-1)==="File"){pe(()=>$.slice());continue}if(Qo(re)){pe(()=>[]);continue}if(Kt(W))continue;pe(()=>$.map(he=>Mo(kt(u,ie,W),he,{extraArgs:C})));continue}if(typeof $=="object"){let re=kt(u,ie,W);if(s){let he=s(Z);he!==void 0&&ki({sourceObject:$,mapping:re,options:{extraArgs:C},setMemberFn:hl(he),getMemberFn:gl(he)});continue}pe(()=>ki({mapping:re,sourceObject:$,options:{extraArgs:C},setMemberFn:pl}));continue}pe(()=>$);continue}pe(()=>ml(S,e,I,Z,D,u,ie,W))}if(!i){let P=b??v;P&&P(e,I,D)}return Hp(I,l,Y,o,a,q),I}var Pt=class{static configure(e={}){this.configured||(this.configured=!0,Object.entries(e).forEach(([t,n])=>{n!==void 0&&(this[t]=n)}))}static log(e){console.log.bind(console,this.AUTOMAPPER_PREFIX,e)}static warn(e){console.warn.bind(console,this.AUTOMAPPER_PREFIX,e)}static error(e){console.error.bind(console,this.AUTOMAPPER_PREFIX,e)}static info(e){console.info.bind(console,this.AUTOMAPPER_PREFIX,e)}};Pt.AUTOMAPPER_PREFIX="[AutoMapper]: ";Pt.configured=!1;function Yp({strategyInitializer:r,errorHandler:e,namingConventions:t}){let n,s,i,o,a,l,f;function u(y,h,v){if(h&&v)return{destinationIdentifier:h,mapOptions:v};let T=y;if(h&&!v){let b=typeof h;b==="string"||b==="function"?T=h:v=h}return{destinationIdentifier:T,mapOptions:v}}return new Proxy({[Gp](){return`
Mapper {} is an empty Object as a Proxy. The following methods are available to use with a Mapper:
- Mapper#map(Array)(Async), Mapper#mutate(Array)(Async)
- createMap()
- addProfile()
- getMapping()
- getMappings()
        `}},{get(y,h,v){return h===Xc?(n||(n=r(v)),n):h===al?(f||(f=new Set),f):h===el?(s||(s=new Map),s):h===tl?(i||(i=new Map),i):h===rl?(o||(o=new Map),o):h===nl?(e||(e={handle:Pt.error?Pt.error.bind(Pt):()=>{}}),e):h===sl?t:h===il?(a||(a=new Map),a):h===ol?(l||(l=new Map),l):h==="dispose"?()=>{s?.clear(),o?.clear(),a?.clear(),l?.clear(),f?.clear()}:h==="map"?(T,b,L,C)=>{if(T==null)return T;let{destinationIdentifier:q,mapOptions:z}=u(b,L,C),I=kt(v,b,q);T=n.preMap(T,I);let D=Mo(I,T,z||{});return n.postMap(T,D,I)}:h==="mapAsync"?(T,b,L,C)=>{let q=v.map(T,b,L,C);return new Promise(z=>{setTimeout(z,0,q)})}:h==="mapArray"?(T,b,L,C)=>{if(!T.length)return[];let{destinationIdentifier:q,mapOptions:z}=u(b,L,C),I=kt(v,b,q),{beforeMap:D,afterMap:Y,extraArgs:P}=z||{};D&&D(T,[]);let F=[];for(let Z=0,S=T.length;Z<S;Z++){let G=T[Z];G=n.preMap(G,I);let B=Mo(I,G,{extraArgs:P},!0);F.push(n.postMap(G,B,I))}return Y&&Y(T,F),F}:h==="mapArrayAsync"?(T,b,L,C)=>{let q=v.mapArray(T,b,L,C);return new Promise(z=>{setTimeout(z,0,q)})}:h==="mutate"?(T,b,L,C,q)=>{if(T==null)return;let{destinationIdentifier:z,mapOptions:I}=u(L,C,q),D=kt(v,L,z);T=n.preMap(T,D),Jc(D,T,b,I||{}),n.postMap(T,b,D)}:h==="mutateAsync"?(T,b,L,C,q)=>new Promise(z=>{v.mutate(T,b,L,C,q),setTimeout(z,0)}):h==="mutateArray"?(T,b,L,C,q)=>{if(!T.length)return;let{destinationIdentifier:z,mapOptions:I}=u(L,C,q),D=kt(v,L,z),{beforeMap:Y,afterMap:P,extraArgs:F}=I||{};Y&&Y(T,b);for(let Z=0,S=T.length;Z<S;Z++){let G=T[Z];G=n.preMap(G,D),Jc(D,G,b[Z]||{},{extraArgs:F},!0),n.postMap(G,b[Z],D)}P&&P(T,b)}:h==="mutateArrayAsync"?(T,b,L,C,q)=>new Promise(z=>{v.mutateArray(T,b,L,C,q),setTimeout(z,0)}):Reflect.get(y,h,v)}})}var Vo=Symbol("__recursive_data__");function jo(r,e,t){let n=r.get(e);return n?eh(n,t):void 0}function Pi(r,e,t,n){if(!r.has(e)){r.set(e,Hc(new Map,t,n));return}let s=r.get(e);Xp(s,t)||Hc(s,t,n)}function Hc(r,e,t){let n=r;for(let s of e){let i=n.get(s);i||(i=new Map,n.set(s,i)),n=i}return n.set(Vo,t),r}function Xp(r,e){let t=r;for(let n of e){let s=t.get(n);if(s)t=s;else return!1}return t.has(Vo)}function eh(r,e){let t=r;for(let n of e)if(t=t.get(n),!t)return;return t.get(Vo)}function th(r){let e=r.mapper,t=$i(e),n=ll(e),s=Jp(e),i=ul(e);function o(a,l,f=!0,u=!1){let y=t.get(a),h={};if(Qo(y)||!y)return h;for(let v=0,T=y.length;v<T;v++){let b=y[v][0],L=y[v][1],C=y[v][2];if(y[v][3]&&l===1)continue;let z=L();if(C){wt(h,b,[]);continue}if(Kt(z)||z===null){wt(h,b,void 0);continue}if(Mr(z)){wt(h,b,new Date);continue}let I=jo(i,a,b),D=jo(s,a,b)||0;if(I===0){wt(h,b,{});continue}if(I===D){(f||!u)&&Pi(s,a,b,0),wt(h,b,{});continue}Pi(s,a,b,D+1);let P=n.get(z)?.[l]||o(z,l,!1,z===a);wt(h,b,P)}return(f||!u)&&s.get(a)?.clear(),h}return o}var rh={applyMetadata:th,preMap(r){return r},postMap(r,e){return e}};function nh(r,e=!1){return e?r!==void 0:r!=null}function yl(r,e,t){if(!nh(t))return;let n=$i(r);if(!n.has(e))for(let[s,{isGetterOnly:i,type:o,depth:a,isArray:l}]of t)n.set(e,[...n.get(e)||[],[[s],o,l,i]]),a!=null&&Pi(ul(r),e,[s],a)}function sh(r){return[6,e=>jr(e,r)]}function bl(r,[e,t]){let n=r.map(s=>s.split(t.splittingExpression).filter(Boolean)).filter(s=>s.length>0);return n.length?n.map(s=>e.transformPropertyName(s)):r}function wl(r,e,t){let[n]=t,s=[].concat(...e.map(h=>h.split(n.splittingExpression).filter(Boolean))),[i,...o]=s.slice(0,s.length-1),a=i,l=0,f=Ei(r,a);if(!f){for(let h=0,v=o.length;h<v;h++)if(a=n.transformPropertyName([a,o[h]]),Ei(r,a)){l=h+1,f=!0;break}}if(!f)return e;let u=s.slice(l+1,s.length+1),y=n.transformPropertyName(u);return u.length>1&&!Ei(r[a],y)&&Ei(r[a],n.transformPropertyName([u[0]]))?[a,...wl(r[a],bl([y],t),t)]:[a,n.transformPropertyName(s.slice(l+1,s.length+1))]}function Ei(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function vl(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function ih(r){let e=[];for(let t=0,n=r.length;t<n;t++){let s=r[t];e.some(i=>vl(i,s))||e.push(s)}return e}var oh=["constructor","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","toString","valueOf","__proto__","toLocaleString"];function _l(r,e=[],t=[]){let n=t,s=!1,i=Array.from(new Set([...Object.getOwnPropertyNames(r)].filter(o=>!oh.includes(o))));for(let o=0,a=i.length;o<a;o++){let l=i[o],f=[...e,l],u=r[l];if(typeof u!="function"&&(n.push(f),typeof u=="object")){let y=Array.isArray(u)?u:[u];for(let h of y){let v=_l(h,f);v&&(s=!0,n.push(...v))}}}return s?ih(n):n}function Sl(r,e,t,n=[]){let s=Fo(r),i=s.applyMetadata.bind(s),o=s.destinationConstructor.bind(s),a=ll(r),l=a.get(e),f=a.get(t),u=f?.[1]||i(t,1);f?f[1]=u:a.set(t,[void 0,u]);let y=l?.[0]||i(e,0);l?l[0]=y:a.set(e,[y]);let h=[[e,t],[y,u],[],[],r,o];h[8]=Wp(r);for(let D=0,Y=n.length;D<Y;D++)n[D](h);let v=_l(u),T=h[2],b=h[3],L=b.length>0,C=h[8],{processSourcePath:q,getMetadataAtMember:z,getNestedMappingPair:I}=Tl(r,e,t);for(let D=0,Y=v.length;D<Y;D++){let P=v[D];if(L&&b.some(W=>Ii(W[0],P)))continue;let F=q(y,C,P);if(!(F[0]in y))continue;let Z=z(P,"destination"),S=z(F,"source");if(!S&&!Z)continue;let G=I(S,Z),B=[sh(F)];if(G){let W,ie=S[2],me=Z[2],pe=h[6];if(pe){let[ze,_]=pe.get(G[1])||[],[$,se]=(ie?_?.get(G[0]):ze?.get(G[0]))||[];W=me?se:$}if(W){let ze=B[0][1];B[0][1]=_=>W(ze(_)),B[0][2]=!0}}T.push([P,[P,B],G])}for(let D of b)T.push(D);return h}function Tl(r,e,t){let n=$i(r),s=n.get(t)||[],i=n.get(e)||[];return{getMetadataAtMember:(o,a)=>(a==="source"?i:s).find(l=>Ii(l[0],o)),processSourcePath:(o,a,l)=>{let f=l;return a&&(f=wl(o,bl(l,a),a)),f},getNestedMappingPair:(o,a)=>{if(o&&a)return[a[1](),o[1]()]}}}function ah(r,e,...t){let n=typeof e=="string"?Symbol.for(e):e,s=n,[i,...o]=t||[];i&&(typeof i=="string"?s=Symbol.for(i):typeof i=="function"&&i.prototype!==void 0?s=i:(o||[]).push(i));let a=cl(r),l=a.get(n)?.get(s);return l?(zo(r).handle(`Mapping for source ${String(e)} and destination ${String(i)} already exists`),l):(Fo(r).retrieveMetadata(n,s).forEach((y,h)=>{yl(r,h,y)}),l=Sl(r,n,s,(o||[]).concat(...Io(r).values()).filter(y=>y!=null)),a.has(n)?a.get(n).set(s,l):a.set(n,new Map([[s,l]])),l)}function ch(r,e,...t){t.forEach(n=>{Io(r).add(n)}),e.apply({profileName:e.name},[r]),Io(r).clear()}var xl=()=>{},lh=Cl(xl);function uh(r){let e=r(lh);if(typeof e!="function")return null;let t=e();return t.length===0||t.some(n=>typeof n!="string")?null:t}function fh(r){let e=uh(r);return e||[]}function Cl(r,e=[]){let t={get(n,s){let i=e.slice();return i.push(s),Cl(xl,i)},apply(){return e}};return new Proxy(r,t)}function Nl(r,...e){let[t,n]=e,s=fh(r);n==null&&(n=t,t=void 0);let i=[s,[n,t]];return o=>{let[a,l]=o[0],f=o[4],u=o[8],[y]=o[1],{getNestedMappingPair:h,getMetadataAtMember:v,processSourcePath:T}=Tl(f,a,l),b=T(y,u,s);if(!(b[0]in y)){o[3].push([s,i,void 0]);return}let L=v(s,"destination"),C=v(b,"source"),q=h(C,L);o[3].push([s,i,q])}}function dh(r,e){let t=Array.isArray(r)?r:void 0;return n=>{if(t==null){let[,i]=n[0],o=n[4],a=Fo(o),l=typeof r=="string"?Symbol.for(r):r;a.retrieveMetadata(l).forEach((u,y)=>{yl(o,y,u)}),t=Sl(o,l,i)}let s=t[2];for(let i=0,o=s.length;i<o;i++){let a=s[i];if(n[2].some(f=>Ii(f[0],a[0])))continue;let l=a[1][1];l[0][1]=f=>jr(e(f),a[0]),n[2].push([a[0],[a[0],l],a[2]])}}}function mh(r){return"convert"in r?r.convert.bind(r):r}function ph(r,e,t){return n=>{let s=Array.isArray(r),i=Array.isArray(e),o=s?r[0]:r,a=i?e[0]:e,l=mh(t),f=n[6]||(n[6]=new Map),u,[y,h]=f.get(o)||[];if(y||h){u=s?h:y;let[v,T]=u.get(a)||[];u.set(a,i?[v,l]:[l,T]);return}u=new Map([[a,i?[void 0,l]:[l,void 0]]]),f.set(o,s?[new Map,u]:[u,new Map])}}var hh=r=>e=>{e[5]=r};function gh(r){return e=>{e[7]==null&&(e[7]=[]),e[7][0]=r}}function yh(r){return e=>{e[7]==null&&(e[7]=[]),e[7][1]=r}}function bh(r,e){return t=>{let n;if(Array.isArray(r))n=r;else{let i=t[4];n=kt(i,r,e)}let s=n[2];for(let i=0,o=s.length;i<o;i++){let[a,l,f]=s[i];t[3].find(([y])=>vl(y,a))||t[3].push([a,l,f])}}}var wh=r=>e=>{e[8]=Yc(r)};function Al(r){return"resolve"in r}function Ol(r){return Al(r)?[1,r.resolve.bind(r)]:[1,r]}function vh(r){return Nl(e=>e[r],Ol(e=>e[r]))}function _h(r,e,t){return[4,(n,s,i)=>{let o=t(n);return Array.isArray(o)?s.mapArray(o,e,r,i):s.map(o,e,r,i)}]}function Sh(r,e){return[5,t=>r.convert(e(t))]}function Th(){return[0]}function xh(r){return[7,(e,t)=>{let n=jr(e,t);return n===null?r:n}]}function Ch(r,e){return[r,e]}function Nh(r,e){return[2,(t,n)=>r(t)?jr(t,n):e]}function Ah(r){return[3,()=>r]}function Oh(r){return Al(r)?[9,r.resolve.bind(r)]:[9,r]}function Eh(r){return[10,r]}function kh(r){return[8,(e,t)=>{let n=jr(e,t);return n===void 0?r:n}]}var Lo=class{constructor(){this.separatorCharacter="",this.splittingExpression=/(^[a-z]+(?=$|[A-Z][a-z0-9]+)|[A-Z]?[a-z0-9]+)/}transformPropertyName(e){let t="";for(let n=0,s=e.length;n<s;n++)n===0?t+=e[n].charAt(0).toLowerCase():t+=e[n].charAt(0).toUpperCase(),t+=e[n].substring(1);return t}},Do=class{constructor(){this.separatorCharacter="",this.splittingExpression=/(^[A-Z]+(?=$|[A-Z][a-z0-9]+)|[A-Z]?[a-z0-9]+)/}transformPropertyName(e){let t="";for(let n=0,s=e.length;n<s;n++)t+=e[n].charAt(0).toUpperCase()+e[n].substring(1);return t}},Ro=class{constructor(){this.separatorCharacter="_",this.splittingExpression=/_/}transformPropertyName(e){return e.length<=1?e[0].toLowerCase()||"":e.map(n=>n.toLowerCase()).join(this.separatorCharacter)}};ee.AutoMapperLogger=Pt;ee.CamelCaseNamingConvention=Lo;ee.PascalCaseNamingConvention=Do;ee.SnakeCaseNamingConvention=Ro;ee.addProfile=ch;ee.afterMap=yh;ee.autoMap=vh;ee.beforeMap=gh;ee.condition=Nh;ee.constructUsing=hh;ee.convertUsing=Sh;ee.createMap=ah;ee.createMapper=Yp;ee.defaultStrategyInitializerOptions=rh;ee.extend=bh;ee.forMember=Nl;ee.forSelf=dh;ee.fromValue=Ah;ee.getRecursiveValue=jo;ee.ignore=Th;ee.isDateConstructor=Mr;ee.isEmpty=Qo;ee.isPrimitiveConstructor=Kt;ee.mapDefer=Eh;ee.mapFrom=Ol;ee.mapWith=_h;ee.mapWithArguments=Oh;ee.namingConventions=wh;ee.nullSubstitution=xh;ee.preCondition=Ch;ee.set=qo;ee.setMutate=wt;ee.setRecursiveValue=Pi;ee.typeConverter=ph;ee.undefinedSubstitution=kh});var El=qi(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});var Ph=Bo(),On=class{static reset(){this.metadataStorage=new Map}static create(e,t={}){let n=typeof e=="string"?Symbol.for(e):e,s=Object.entries(t);if(!!s.length)for(let i=0,o=s.length;i<o;i++){let[a,l]=s[i],f=this.normalizePojoMetadata(l);this.metadataStorage.has(n)||this.metadataStorage.set(n,[]),this.metadataStorage.get(n)?.push([a,f])}}static retrieve(e){let t=this.metadataStorage.get(e);return t?t.map(([n,{type:s,depth:i}])=>{let o=s(),a=Array.isArray(o);return[n,{type:a?()=>o[0]:()=>o,isArray:a,depth:i}]}):[]}static normalizePojoMetadata(e){if(typeof e=="string"||typeof e=="symbol"||typeof e=="function"||Array.isArray(e))return{type:()=>this.toSymbol(e),depth:1};let t=e;return t.type=this.toSymbol(t.type),{type:()=>t.type,depth:t.depth}}static toSymbol(e){return typeof e=="string"?Symbol.for(e):Array.isArray(e)&&typeof e[0]=="string"?Symbol.for(e[0]):e}};On.metadataStorage=new Map;function $h(r={}){let{destinationConstructor:e=()=>({}),applyMetadata:t,postMap:n,preMap:s}={...Ph.defaultStrategyInitializerOptions,...r};return i=>({destinationConstructor:e,mapper:i,get applyMetadata(){return t(this)},retrieveMetadata(...o){let a=new Map;for(let l=0,f=o.length;l<f;l++){let u=o[l];a.set(u,On.retrieve(u))}return a},preMap:s,postMap:n})}Mi.PojosMetadataMap=On;Mi.pojos=$h});var Gl=qi((LT,Zl)=>{"use strict";var Jo=Object.defineProperty,qg=Object.getOwnPropertyDescriptor,Vg=Object.getOwnPropertyNames,Bg=Object.prototype.hasOwnProperty,Ug=(r,e)=>{for(var t in e)Jo(r,t,{get:e[t],enumerable:!0})},Kg=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Vg(e))!Bg.call(r,s)&&s!==t&&Jo(r,s,{get:()=>e[s],enumerable:!(n=qg(e,s))||n.enumerable});return r},Zg=r=>Kg(Jo({},"__esModule",{value:!0}),r),Kl={};Ug(Kl,{BadRequestError:()=>Wg});Zl.exports=Zg(Kl);var Gg=class extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}},Wg=class extends Gg{constructor(e,t={}){super(e);c(this,"statusCode",400);c(this,"logging",!1);c(this,"errors");this.errors=[{message:e,context:t}]}}});var Xg={};Ju(Xg,{lambdaHandler:()=>Yg});module.exports=Hu(Xg);var Na=ct(require("os"),1),Aa=ct(require("fs"),1);var jn=new Map,Vi=new Map,Bi=Symbol("OriginError"),ur={},Ue=class extends Promise{constructor(e,t,n,s,i={}){let o,a;super((l,f)=>{o=l,a=f}),this.tagged=Array.isArray(e.raw),this.strings=e,this.args=t,this.handler=n,this.canceller=s,this.options=i,this.state=null,this.statement=null,this.resolve=l=>(this.active=!1,o(l)),this.reject=l=>(this.active=!1,a(l)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[Bi]=this.handler.debug?new Error:this.tagged&&Yu(this.strings)}get origin(){return(this.handler.debug?this[Bi].stack:this.tagged&&Vi.has(this.strings)?Vi.get(this.strings):Vi.set(this.strings,this[Bi].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(e=1,t){if(this.options.simple=!1,typeof e=="function"&&(t=e,e=1),this.cursorRows=e,typeof t=="function")return this.cursorFn=t,this;let n;return{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};n&&n();let s=new Promise((i,o)=>{this.cursorFn=a=>(i({value:a,done:!1}),new Promise(l=>n=l)),this.resolve=()=>(this.active=!1,i({done:!0})),this.reject=a=>(this.active=!1,o(a))});return this.execute(),s},return(){return n&&n(ur),{done:!0}}})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw new Error(".stream has been renamed to .forEach")}forEach(e){return this.forEachFn=e,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}};function Yu(r){if(jn.has(r))return jn.get(r);let e=Error.stackTraceLimit;return Error.stackTraceLimit=4,jn.set(r,new Error),Error.stackTraceLimit=e,jn.get(r)}var Lt=class extends Error{constructor(e){super(e.message),this.name=this.constructor.name,Object.assign(this,e)}},Ce={connection:ca,postgres:la,generic:ua,notSupported:fa};function ca(r,e,t){let{host:n,port:s}=t||e,i=Object.assign(new Error("write "+r+" "+(e.path||n+":"+s)),{code:r,errno:r,address:e.path||n},e.path?{}:{port:s});return Error.captureStackTrace(i,ca),i}function la(r){let e=new Lt(r);return Error.captureStackTrace(e,la),e}function ua(r,e){let t=Object.assign(new Error(r+": "+e),{code:r});return Error.captureStackTrace(t,ua),t}function fa(r){let e=Object.assign(new Error(r+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:r});return Error.captureStackTrace(e,fa),e}var Xu={string:{to:25,from:null,serialize:r=>""+r},number:{to:0,from:[21,23,26,700,701],serialize:r=>""+r,parse:r=>+r},json:{to:114,from:[114,3802],serialize:r=>JSON.stringify(r),parse:r=>JSON.parse(r)},boolean:{to:16,from:16,serialize:r=>r===!0?"t":"f",parse:r=>r==="t"},date:{to:1184,from:[1082,1114,1184],serialize:r=>(r instanceof Date?r:new Date(r)).toISOString(),parse:r=>new Date(r)},bytea:{to:17,from:17,serialize:r=>"\\x"+Buffer.from(r).toString("hex"),parse:r=>Buffer.from(r.slice(2),"hex")}},Jr=class{then(){Ui()}catch(){Ui()}finally(){Ui()}},fr=class extends Jr{constructor(e){super(),this.value=zn(e)}},rt=class extends Jr{constructor(e,t,n){super(),this.value=e,this.type=t,this.array=n}},Hr=class extends Jr{constructor(e,t){super(),this.first=e,this.rest=t}build(e,t,n,s){let i=ef.map(([o,a])=>({fn:a,i:e.search(o)})).sort((o,a)=>o.i-a.i).pop();return i.i===-1?Ji(this.first,s):i.fn(this.first,this.rest,t,n,s)}};function Rn(r,e,t,n){let s=r instanceof rt?r.value:r;if(s===void 0&&(r instanceof rt?r.value=n.transform.undefined:s=r=n.transform.undefined,s===void 0))throw Ce.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+t.push(r instanceof rt?(e.push(r.value),r.array?r.array[r.type||Dn(r.value)]||r.type||ha(r.value):r.type):(e.push(r),Dn(r)))}var ma=ya(Xu);function Gi(r,e,t,n,s,i){for(let o=1;o<r.strings.length;o++)e+=Wi(e,t,n,s,i)+r.strings[o],t=r.args[o];return e}function Wi(r,e,t,n,s){return e instanceof Hr?e.build(r,t,n,s):e instanceof Ue?Zi(e,t,n,s):e instanceof fr?e.value:e&&e[0]instanceof Ue?e.reduce((i,o)=>i+" "+Zi(o,t,n,s),""):Rn(e,t,n,s)}function Zi(r,e,t,n){return r.fragment=!0,Gi(r,r.strings[0],r.args[0],e,t,n)}function pa(r,e,t,n,s){return r.map(i=>"("+n.map(o=>Wi("values",i[o],e,t,s)).join(",")+")").join(",")}function da(r,e,t,n,s){let i=Array.isArray(r[0]),o=e.length?e.flat():Object.keys(i?r[0]:r);return pa(i?r:[r],t,n,o,s)}function Ln(r,e,t,n,s){if(typeof r=="string"&&(r=[r].concat(e)),Array.isArray(r))return Ji(r,s);let i;return(e.length?e.flat():Object.keys(r)).map(a=>(i=r[a],(i instanceof Ue?Zi(i,t,n,s):i instanceof fr?i.value:Rn(i,t,n,s))+" as "+zn(s.transform.column.to?s.transform.column.to(a):a))).join(",")}var ef=Object.entries({values:da,in:(...r)=>{let e=da(...r);return e==="()"?"(null)":e},select:Ln,as:Ln,returning:Ln,"\\(":Ln,update(r,e,t,n,s){return(e.length?e.flat():Object.keys(r)).map(i=>zn(s.transform.column.to?s.transform.column.to(i):i)+"="+Wi("values",r[i],t,n,s))},insert(r,e,t,n,s){let i=e.length?e.flat():Object.keys(Array.isArray(r)?r[0]:r);return"("+Ji(i,s)+")values"+pa(Array.isArray(r)?r:[r],t,n,i,s)}}).map(([r,e])=>[new RegExp("((?:^|[\\s(])"+r+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),e]);function Ui(){throw Ce.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}var tf=ma.serializers,rf=ma.parsers;function ha(r){return Array.isArray(r)?ha(r[0]):typeof r=="string"?1009:0}var ga=function(r){let e=ya(r||{});return{serializers:Object.assign({},tf,e.serializers),parsers:Object.assign({},rf,e.parsers)}};function ya(r){return Object.keys(r).reduce((e,t)=>(r[t].from&&[].concat(r[t].from).forEach(n=>e.parsers[n]=r[t].parse),r[t].serialize&&(e.serializers[r[t].to]=r[t].serialize,r[t].from&&[].concat(r[t].from).forEach(n=>e.serializers[n]=r[t].serialize)),e),{parsers:{},serializers:{}})}function Ji(r,{transform:{column:e}}){return r.map(t=>zn(e.to?e.to(t):t)).join(",")}var zn=function(e){return'"'+e.replace(/"/g,'""').replace(/\./g,'"."')+'"'},Dn=function r(e){return e instanceof rt?e.type:e instanceof Date?1184:e instanceof Uint8Array?17:e===!0||e===!1?16:typeof e=="bigint"?20:Array.isArray(e)?r(e[0]):0},nf=/\\/g,sf=/"/g;function of(r){return r.replace(nf,"\\\\").replace(sf,'\\"')}var ba=function r(e,t,n,s){if(Array.isArray(e)===!1)return e;if(!e.length)return"{}";let i=e[0],o=s===1020?";":",";return Array.isArray(i)&&!i.type?"{"+e.map(a=>r(a,t,n,s)).join(o)+"}":"{"+e.map(a=>{if(a===void 0&&(a=n.transform.undefined,a===void 0))throw Ce.generic("UNDEFINED_VALUE","Undefined values are not allowed");return a===null?"null":'"'+of(t?t(a.type?a.value:a):""+a)+'"'}).join(o)+"}"},Ki={i:0,char:null,str:"",quoted:!1,last:0},wa=function(e,t,n){return Ki.i=Ki.last=0,va(Ki,e,t,n)};function va(r,e,t,n){let s=[],i=n===1020?";":",";for(;r.i<e.length;r.i++){if(r.char=e[r.i],r.quoted)r.char==="\\"?r.str+=e[++r.i]:r.char==='"'?(s.push(t?t(r.str):r.str),r.str="",r.quoted=e[r.i+1]==='"',r.last=r.i+2):r.str+=r.char;else if(r.char==='"')r.quoted=!0;else if(r.char==="{")r.last=++r.i,s.push(va(r,e,t,n));else if(r.char==="}"){r.quoted=!1,r.last<r.i&&s.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1;break}else r.char===i&&r.p!=="}"&&r.p!=='"'&&(s.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1);r.p=r.char}return r.last<r.i&&s.push(t?t(e.slice(r.last,r.i+1)):e.slice(r.last,r.i+1)),s}var Dt=r=>{let e=r[0];for(let t=1;t<r.length;t++)e+=r[t]==="_"?r[++t].toUpperCase():r[t];return e},Rt=r=>{let e=r[0].toUpperCase();for(let t=1;t<r.length;t++)e+=r[t]==="_"?r[++t].toUpperCase():r[t];return e},zt=r=>r.replace(/_/g,"-"),Yr=r=>r.replace(/([A-Z])/g,"_$1").toLowerCase(),Xr=r=>(r.slice(0,1)+r.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),en=r=>r.replace(/-/g,"_");function Hi(r){return function e(t,n){return typeof t=="object"&&t!==null&&(n.type===114||n.type===3802)?Array.isArray(t)?t.map(s=>e(s,n)):Object.entries(t).reduce((s,[i,o])=>Object.assign(s,{[r(i)]:e(o,n)}),{}):t}}Dt.column={from:Dt};Dt.value={from:Hi(Dt)};Yr.column={to:Yr};var Yi={...Dt};Yi.column.to=Yr;Rt.column={from:Rt};Rt.value={from:Hi(Rt)};Xr.column={to:Xr};var Xi={...Rt};Xi.column.to=Xr;zt.column={from:zt};zt.value={from:Hi(zt)};en.column={to:en};var eo={...zt};eo.column.to=en;var no=ct(require("net"),1),Ta=ct(require("tls"),1),mr=ct(require("crypto"),1),qn=ct(require("stream"),1),so=require("perf_hooks");var At=class extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}};var Ke=af;function af(r=[]){let e=r.slice(),t=0;return{get length(){return e.length-t},remove:n=>{let s=e.indexOf(n);return s===-1?null:(e.splice(s,1),n)},push:n=>(e.push(n),n),shift:()=>{let n=e[t++];return t===e.length?(t=0,e=[]):e[t-1]=void 0,n}}}var De=Buffer.allocUnsafe(256),cf="BCcDdEFfHPpQSX".split("").reduce((r,e)=>{let t=e.charCodeAt(0);return r[e]=()=>(De[0]=t,ce.i=5,ce),r},{}),ce=Object.assign(lf,cf,{N:String.fromCharCode(0),i:0,inc(r){return ce.i+=r,ce},str(r){let e=Buffer.byteLength(r);return Fn(e),ce.i+=De.write(r,ce.i,e,"utf8"),ce},i16(r){return Fn(2),De.writeUInt16BE(r,ce.i),ce.i+=2,ce},i32(r,e){return e||e===0?(De.writeUInt32BE(r,e),ce):(Fn(4),De.writeUInt32BE(r,ce.i),ce.i+=4,ce)},z(r){return Fn(r),De.fill(0,ce.i,ce.i+r),ce.i+=r,ce},raw(r){return De=Buffer.concat([De.subarray(0,ce.i),r]),ce.i=De.length,ce},end(r=1){De.writeUInt32BE(ce.i-r,r);let e=De.subarray(0,ce.i);return ce.i=0,De=Buffer.allocUnsafe(256),e}}),Q=ce;function Fn(r){if(De.length-ce.i<r){let e=De,t=e.length;De=Buffer.allocUnsafe(t+(t>>1)+r),e.copy(De)}}function lf(){return ce.i=0,ce}var io=xa,uf=1,Ot=Q().S().end(),_a=Q().H().end(),ff=Q().i32(8).i32(80877103).end(8),df=Buffer.concat([Q().E().str(Q.N).i32(0).end(),Ot]),mf=Q().D().str("S").str(Q.N).end(),dr=()=>{},pf=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),hf={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function xa(r,e={},{onopen:t=dr,onend:n=dr,onclose:s=dr}={}){let{ssl:i,max:o,user:a,host:l,port:f,database:u,parsers:y,transform:h,onnotice:v,onnotify:T,onparameter:b,max_pipeline:L,keep_alive:C,backoff:q,target_session_attrs:z}=r,I=Ke(),D=uf++,Y={pid:null,secret:null},P=ro(Fi,r.idle_timeout),F=ro(Fi,r.max_lifetime),Z=ro(nu,r.connect_timeout),S=null,G,B=new At,W=Buffer.alloc(0),ie=r.fetch_types,me={},pe={},ze=Math.random().toString(36).slice(2),_=1,$=0,se=0,re=0,he=0,X=0,ue=0,xe=0,we=null,ge=null,Ie=!1,fe=null,et=null,Me=null,Ct=null,Ae=null,ye=null,tt=null,ot=null,A=null,Kr=null,je={queue:e.closed,idleTimer:P,connect(d){Me=d||!0,ra()},terminate:Gr,execute:Zr,cancel:Xl,end:Fi,count:0,id:D};return e.closed&&e.closed.push(je),je;async function Yl(){let d;try{d=r.socket?await Promise.resolve(r.socket(r)):new no.default.Socket}catch(g){lr(g);return}return d.on("error",lr),d.on("close",na),d.on("drain",ea),d}async function Xl({pid:d,secret:g},V,oe){try{G=Q().i32(16).i32(80877102).i32(d).i32(g).end(16),await ta(),S.once("error",oe),S.once("close",V)}catch(_e){oe(_e)}}function Zr(d){if(Ie)return Mn(d,Ce.connection("CONNECTION_DESTROYED",r));if(!d.cancelled)try{return d.state=Y,A?I.push(d):(A=d,A.active=!0),ru(d),Ee(eu(d))&&!d.describeFirst&&!d.cursorFn&&I.length<L&&(!d.options.onexecute||d.options.onexecute(je))}catch(g){return I.length===0&&Ee(Ot),at(g),!0}}function eu(d){if(d.parameters.length>=65534)throw Ce.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return d.options.simple?Q().Q().str(d.statement.string+Q.N).end():d.describeFirst?Buffer.concat([Ho(d),_a]):d.prepare?d.prepared?In(d):Buffer.concat([Ho(d),In(d)]):tu(d)}function Ho(d){return Buffer.concat([ia(d.statement.string,d.parameters,d.statement.types,d.statement.name),Qu("S",d.statement.name)])}function In(d){return Buffer.concat([Fu(d.parameters,d.statement.types,d.statement.name,d.cursorName),d.cursorFn?oa("",d.cursorRows):df])}function tu(d){return Buffer.concat([ia(d.statement.string,d.parameters,d.statement.types),mf,In(d)])}function ru(d){let g=[],V=[],oe=Gi(d,d.strings[0],d.args[0],g,V,r);!d.tagged&&d.args.forEach(_e=>Rn(_e,g,V,r)),d.prepare=r.prepare&&("prepare"in d.options?d.options.prepare:!0),d.string=oe,d.signature=d.prepare&&V+oe,d.onlyDescribe&&delete pe[d.signature],d.parameters=d.parameters||g,d.prepared=d.prepare&&d.signature in pe,d.describeFirst=d.onlyDescribe||g.length&&!d.prepared,d.statement=d.prepared?pe[d.signature]:{string:oe,types:V,name:d.prepare?ze+_++:""},typeof r.debug=="function"&&r.debug(D,oe,g,V)}function Ee(d,g){return ye=ye?Buffer.concat([ye,d]):Buffer.from(d),g||ye.length>=1024?Yo(g):(ge===null&&(ge=setImmediate(Yo)),!0)}function Yo(d){let g=S.write(ye,d);return ge!==null&&clearImmediate(ge),ye=ge=null,g}function nu(){at(Ce.connection("CONNECT_TIMEOUT",r,S)),S.destroy()}async function Xo(){if(Ee(ff),!await new Promise(g=>S.once("data",V=>g(V[0]===83)))&&i==="prefer")return cr();S.removeAllListeners(),S=Ta.default.connect({socket:S,servername:no.default.isIP(S.host)?void 0:S.host,...i==="require"||i==="allow"||i==="prefer"?{rejectUnauthorized:!1}:i==="verify-full"?{}:typeof i=="object"?i:{}}),S.on("secureConnect",cr),S.on("error",lr),S.on("close",na),S.on("drain",ea)}function ea(){!A&&t(je)}function zi(d){if(!(fe&&(fe.push(d),se-=d.length,se>=0)))for(W=fe?Buffer.concat(fe,X-se):W.length===0?d:Buffer.concat([W,d],W.length+d.length);W.length>4;){if(X=W.readUInt32BE(1),X>=W.length){se=X-W.length,fe=[W];break}try{su(W.subarray(0,X+1))}catch(g){A&&(A.cursorFn||A.describeFirst)&&Ee(Ot),at(g)}W=W.subarray(X+1),se=0,fe=null}}async function ta(){if(Ie=!1,me={},S||(S=await Yl()),!!S){if(Z.start(),r.socket)return i?Xo():cr();if(S.on("connect",i?Xo:cr),r.path)return S.connect(r.path);S.ssl=i,S.connect(f[re],l[re]),S.host=l[re],S.port=f[re],re=(re+1)%f.length}}function ra(){setTimeout(ta,$?$+ue-so.performance.now():0)}function cr(){try{pe={},ie=r.fetch_types,ze=Math.random().toString(36).slice(2),_=1,F.start(),S.on("data",zi),C&&S.setKeepAlive&&S.setKeepAlive(!0,1e3*C);let d=Vu();Ee(d)}catch(d){lr(d)}}function lr(d){if(!(je.queue===e.connecting&&r.host[he+1]))for(at(d);I.length;)Mn(I.shift(),d)}function at(d){Ae&&(Ae.destroy(d),Ae=null),A&&Mn(A,d),Me&&(Mn(Me,d),Me=null)}function Mn(d,g){"query"in g||"parameters"in g||Object.defineProperties(g,{stack:{value:g.stack+d.origin.replace(/.*\n/,`
`),enumerable:r.debug},query:{value:d.string,enumerable:r.debug},parameters:{value:d.parameters,enumerable:r.debug},args:{value:d.args,enumerable:r.debug},types:{value:d.statement&&d.statement.types,enumerable:r.debug}}),d.reject(g)}function Fi(){return Ct||(!je.reserved&&n(je),!je.reserved&&!Me&&!A&&I.length===0?(Gr(),new Promise(d=>S&&S.readyState!=="closed"?S.once("close",d):d())):Ct=new Promise(d=>tt=d))}function Gr(){Ie=!0,(Ae||A||Me||I.length)&&lr(Ce.connection("CONNECTION_DESTROYED",r)),clearImmediate(ge),S&&(S.removeListener("data",zi),S.removeListener("connect",cr),S.readyState==="open"&&S.end(Q().X().end())),tt&&(tt(),Ct=tt=null)}async function na(d){if(W=Buffer.alloc(0),se=0,fe=null,clearImmediate(ge),S.removeListener("data",zi),S.removeListener("connect",cr),P.cancel(),F.cancel(),Z.cancel(),S.removeAllListeners(),S=null,Me)return ra();!d&&(A||I.length)&&lr(Ce.connection("CONNECTION_CLOSED",r,S)),$=so.performance.now(),d&&r.shared.retries++,ue=(typeof q=="function"?q(r.shared.retries):q)*1e3,s(je,Ce.connection("CONNECTION_CLOSED",r,S))}function su(d,g=d[0]){(g===68?iu:g===100?$u:g===65?Nu:g===83?ou:g===90?au:g===67?cu:g===50?sa:g===49?lu:g===116?uu:g===84?fu:g===82?du:g===110?bu:g===75?wu:g===69?xu:g===115?Au:g===51?Ou:g===71?Eu:g===78?Mu:g===72?ku:g===99?Iu:g===73?ju:g===86?Lu:g===118?Du:g===87?Pu:Ru)(d)}function iu(d){let g=7,V,oe,_e,Le=A.isRaw?new Array(A.statement.columns.length):{};for(let Fe=0;Fe<A.statement.columns.length;Fe++)oe=A.statement.columns[Fe],V=d.readInt32BE(g),g+=4,_e=V===-1?null:A.isRaw===!0?d.subarray(g,g+=V):oe.parser===void 0?d.toString("utf8",g,g+=V):oe.parser.array===!0?oe.parser(d.toString("utf8",g+1,g+=V)):oe.parser(d.toString("utf8",g,g+=V)),A.isRaw?Le[Fe]=A.isRaw===!0?_e:h.value.from?h.value.from(_e,oe):_e:Le[oe.name]=h.value.from?h.value.from(_e,oe):_e;A.forEachFn?A.forEachFn(h.row.from?h.row.from(Le):Le,B):B[xe++]=h.row.from?h.row.from(Le):Le}function ou(d){let[g,V]=d.toString("utf8",5,d.length-1).split(Q.N);me[g]=V,r.parameters[g]!==V&&(r.parameters[g]=V,b&&b(g,V))}function au(d){if(A&&A.options.simple&&A.resolve(et||B),A=et=null,B=new At,Z.cancel(),Me){if(z){if(!me.in_hot_standby||!me.default_transaction_read_only)return Tu();if(Su(z,me))return Gr()}if(ie)return Me===!0&&(Me=null),vu();Me!==!0&&Zr(Me),r.shared.retries=he=0,Me=null;return}for(;I.length&&(A=I.shift())&&(A.active=!0,A.cancelled);)xa(r).cancel(A.state,A.cancelled.resolve,A.cancelled.reject);A||(je.reserved?!je.reserved.release&&d[5]===73?Ct?Gr():(je.reserved=null,t(je)):je.reserved():Ct?Gr():t(je))}function cu(d){xe=0;for(let g=d.length-1;g>0;g--)if(d[g]===32&&d[g+1]<58&&B.count===null&&(B.count=+d.toString("utf8",g+1,d.length-1)),d[g-1]>=65){B.command=d.toString("utf8",5,g),B.state=Y;break}if(Kr&&(Kr(),Kr=null),B.command==="BEGIN"&&o!==1&&!je.reserved)return at(Ce.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"));if(A.options.simple)return sa();A.cursorFn&&(B.count&&A.cursorFn(B),Ee(Ot)),A.resolve(B)}function lu(){A.parsing=!1}function sa(){!B.statement&&(B.statement=A.statement),B.columns=A.statement.columns}function uu(d){let g=d.readUInt16BE(5);for(let V=0;V<g;++V)!A.statement.types[V]&&(A.statement.types[V]=d.readUInt32BE(7+V*4));A.prepare&&(pe[A.signature]=A.statement),A.describeFirst&&!A.onlyDescribe&&(Ee(In(A)),A.describeFirst=!1)}function fu(d){B.command&&(et=et||[B],et.push(B=new At),B.count=null,A.statement.columns=null);let g=d.readUInt16BE(5),V=7,oe;A.statement.columns=Array(g);for(let _e=0;_e<g;++_e){for(oe=V;d[V++]!==0;);let Le=d.readUInt32BE(V),Fe=d.readUInt16BE(V+4),Nt=d.readUInt32BE(V+6);A.statement.columns[_e]={name:h.column.from?h.column.from(d.toString("utf8",oe,V-1)):d.toString("utf8",oe,V-1),parser:y[Nt],table:Le,number:Fe,type:Nt},V+=18}if(B.statement=A.statement,A.onlyDescribe)return A.resolve(A.statement),Ee(Ot)}async function du(d,g=d.readUInt32BE(5)){(g===3?mu:g===5?pu:g===10?hu:g===11?gu:g===12?yu:g!==0?zu:dr)(d,g)}async function mu(){let d=await Qi();Ee(Q().p().str(d).z(1).end())}async function pu(d){let g="md5"+await Sa(Buffer.concat([Buffer.from(await Sa(await Qi()+a)),d.subarray(9)]));Ee(Q().p().str(g).z(1).end())}async function hu(){ot=(await mr.default.randomBytes(18)).toString("base64"),Q().p().str("SCRAM-SHA-256"+Q.N);let d=Q.i;Ee(Q.inc(4).str("n,,n=*,r="+ot).i32(Q.i-d-4,d).end())}async function gu(d){let g=d.toString("utf8",9).split(",").reduce((Fe,Nt)=>(Fe[Nt[0]]=Nt.slice(2),Fe),{}),V=await mr.default.pbkdf2Sync(await Qi(),Buffer.from(g.s,"base64"),parseInt(g.i),32,"sha256"),oe=await Qn(V,"Client Key"),_e="n=*,r="+ot+",r="+g.r+",s="+g.s+",i="+g.i+",c=biws,r="+g.r;we=(await Qn(await Qn(V,"Server Key"),_e)).toString("base64");let Le="c=biws,r="+g.r+",p="+yf(oe,Buffer.from(await Qn(await gf(oe),_e))).toString("base64");Ee(Q().p().str(Le).end())}function yu(d){d.toString("utf8",9).split(Q.N,1)[0].slice(2)!==we&&(at(Ce.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),S.destroy())}function Qi(){return Promise.resolve(typeof r.pass=="function"?r.pass():r.pass)}function bu(){if(B.statement=A.statement,B.statement.columns=[],A.onlyDescribe)return A.resolve(A.statement),Ee(Ot)}function wu(d){Y.pid=d.readUInt32BE(5),Y.secret=d.readUInt32BE(9)}async function vu(){ie=!1,(await new Ue([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],Zr)).forEach(({oid:g,typarray:V})=>_u(g,V))}function _u(d,g){if(!!r.parsers[g]&&!!r.serializers[g])return;let V=r.parsers[d];r.shared.typeArrayMap[d]=g,r.parsers[g]=oe=>wa(oe,V,g),r.parsers[g].array=!0,r.serializers[g]=oe=>ba(oe,r.serializers[d],r,g)}function Su(d,g){return d==="read-write"&&g.default_transaction_read_only==="on"||d==="read-only"&&g.default_transaction_read_only==="off"||d==="primary"&&g.in_hot_standby==="on"||d==="standby"&&g.in_hot_standby==="off"||d==="prefer-standby"&&g.in_hot_standby==="off"&&r.host[he]}function Tu(){let d=new Ue([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],Zr,null,{simple:!0});d.resolve=([[g],[V]])=>{me.default_transaction_read_only=g.transaction_read_only,me.in_hot_standby=V.pg_is_in_recovery?"on":"off"},d.execute()}function xu(d){A&&(A.cursorFn||A.describeFirst)&&Ee(Ot);let g=Ce.postgres(to(d));A&&A.retried?at(A.retried):A&&A.prepared&&pf.has(g.routine)?Cu(A,g):at(g)}function Cu(d,g){delete pe[d.signature],d.retried=g,Zr(d)}function Nu(d){if(!T)return;let g=9;for(;d[g++]!==0;);T(d.toString("utf8",9,g-1),d.toString("utf8",g,d.length-1))}async function Au(){try{let d=await Promise.resolve(A.cursorFn(B));xe=0,d===ur?Ee(qu(A.portal)):(B=new At,Ee(oa("",A.cursorRows)))}catch(d){Ee(Ot),A.reject(d)}}function Ou(){B.count&&A.cursorFn(B),A.resolve(B)}function Eu(){Ae=new qn.default.Writable({autoDestroy:!0,write(d,g,V){S.write(Q().d().raw(d).end(),V)},destroy(d,g){g(d),S.write(Q().f().str(d+Q.N).end()),Ae=null},final(d){S.write(Q().c().end()),Kr=d}}),A.resolve(Ae)}function ku(){Ae=new qn.default.Readable({read(){S.resume()}}),A.resolve(Ae)}function Pu(){Ae=new qn.default.Duplex({autoDestroy:!0,read(){S.resume()},write(d,g,V){S.write(Q().d().raw(d).end(),V)},destroy(d,g){g(d),S.write(Q().f().str(d+Q.N).end()),Ae=null},final(d){S.write(Q().c().end()),Kr=d}}),A.resolve(Ae)}function $u(d){Ae&&(Ae.push(d.subarray(5))||S.pause())}function Iu(){Ae&&Ae.push(null),Ae=null}function Mu(d){v?v(to(d)):console.log(to(d))}function ju(){}function Lu(){at(Ce.notSupported("FunctionCallResponse"))}function Du(){at(Ce.notSupported("NegotiateProtocolVersion"))}function Ru(d){console.error("Postgres.js : Unknown Message:",d[0])}function zu(d,g){console.error("Postgres.js : Unknown Auth:",g)}function Fu(d,g,V="",oe=""){let _e,Le;return Q().B().str(oe+Q.N).str(V+Q.N).i16(0).i16(d.length),d.forEach((Fe,Nt)=>{if(Fe===null)return Q.i32(4294967295);Le=g[Nt],d[Nt]=Fe=Le in r.serializers?r.serializers[Le](Fe):""+Fe,_e=Q.i,Q.inc(4).str(Fe).i32(Q.i-_e-4,_e)}),Q.i16(0),Q.end()}function ia(d,g,V,oe=""){return Q().P().str(oe+Q.N).str(d+Q.N).i16(g.length),g.forEach((_e,Le)=>Q.i32(V[Le]||0)),Q.end()}function Qu(d,g=""){return Q().D().str(d).str(g+Q.N).end()}function oa(d="",g=0){return Buffer.concat([Q().E().str(d+Q.N).i32(g).end(),_a])}function qu(d=""){return Buffer.concat([Q().C().str("P").str(d+Q.N).end(),Q().S().end()])}function Vu(){return G||Q().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:a,database:u,client_encoding:"UTF8"},r.connection)).filter(([,d])=>d).map(([d,g])=>d+Q.N+g).join(Q.N)).z(2).end(0)}}function to(r){let e={},t=5;for(let n=5;n<r.length-1;n++)r[n]===0&&(e[hf[r[t]]]=r.toString("utf8",t+1,n),t=n+1);return e}function Sa(r){return mr.default.createHash("md5").update(r).digest("hex")}function Qn(r,e){return mr.default.createHmac("sha256",r).update(e).digest()}function gf(r){return mr.default.createHash("sha256").update(r).digest()}function yf(r,e){let t=Math.max(r.length,e.length),n=Buffer.allocUnsafe(t);for(let s=0;s<t;s++)n[s]=r[s]^e[s];return n}function ro(r,e){if(e=typeof e=="function"?e():e,!e)return{cancel:dr,start:dr};let t;return{cancel(){t&&(clearTimeout(t),t=null)},start(){t&&clearTimeout(t),t=setTimeout(n,e*1e3,arguments)}};function n(s){r.apply(null,s),t=null}}var Ca=()=>{};function oo(r,e){let t=new Map,n="postgresjs_"+Math.random().toString(36).slice(2),s={},i,o,a=!1,l=y.sql=r({...e,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...e.connection,replication:"database"},onclose:async function(){a||(o=null,s.pid=s.secret=void 0,h(await v(l,n,e.publications)),t.forEach(b=>b.forEach(({onsubscribe:L})=>L())))},no_subscribe:!0}),f=l.end,u=l.close;return l.end=async()=>(a=!0,o&&await new Promise(b=>(o.once("close",b),o.end())),f()),l.close=async()=>(o&&await new Promise(b=>(o.once("close",b),o.end())),u()),y;async function y(b,L,C=Ca,q=Ca){b=vf(b),i||(i=v(l,n,e.publications));let z={fn:L,onsubscribe:C},I=t.has(b)?t.get(b).add(z):t.set(b,new Set([z])).get(b),D=()=>{I.delete(z),I.size===0&&t.delete(b)};return i.then(Y=>(h(Y),C(),o&&o.on("error",q),{unsubscribe:D,state:s,sql:l}))}function h(b){o=b.stream,s.pid=b.state.pid,s.secret=b.state.secret}async function v(b,L,C){if(!C)throw new Error("Missing publication names");let q=await b.unsafe(`CREATE_REPLICATION_SLOT ${L} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[z]=q,I=await b.unsafe(`START_REPLICATION SLOT ${L} LOGICAL ${z.consistent_point} (proto_version '1', publication_names '${C}')`).writable(),D={lsn:Buffer.concat(z.consistent_point.split("/").map(S=>Buffer.from(("00000000"+S).slice(-8),"hex")))};return I.on("data",P),I.on("error",Y),I.on("close",b.close),{stream:I,state:q.state};function Y(S){console.error("Unexpected error during logical streaming - reconnecting",S)}function P(S){S[0]===119?wf(S.subarray(25),D,b.options.parsers,F,e.transform):S[0]===107&&S[17]&&(D.lsn=S.subarray(1,9),Z())}function F(S,G){let B=G.relation.schema+"."+G.relation.table;T("*",S,G),T("*:"+B,S,G),G.relation.keys.length&&T("*:"+B+"="+G.relation.keys.map(W=>S[W.name]),S,G),T(G.command,S,G),T(G.command+":"+B,S,G),G.relation.keys.length&&T(G.command+":"+B+"="+G.relation.keys.map(W=>S[W.name]),S,G)}function Z(){let S=Buffer.alloc(34);S[0]="r".charCodeAt(0),S.fill(D.lsn,1),S.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),I.write(S)}}function T(b,L,C){t.has(b)&&t.get(b).forEach(({fn:q})=>q(L,C,b))}}function bf(r){return new Date(Date.UTC(2e3,0,1)+Number(r/BigInt(1e3)))}function wf(r,e,t,n,s){let i=(o,[a,l])=>(o[a.charCodeAt(0)]=l,o);Object.entries({R:o=>{let a=1,l=e[o.readUInt32BE(a)]={schema:o.toString("utf8",a+=4,a=o.indexOf(0,a))||"pg_catalog",table:o.toString("utf8",a+1,a=o.indexOf(0,a+1)),columns:Array(o.readUInt16BE(a+=2)),keys:[]};a+=2;let f=0,u;for(;a<o.length;)u=l.columns[f++]={key:o[a++],name:s.column.from?s.column.from(o.toString("utf8",a,a=o.indexOf(0,a))):o.toString("utf8",a,a=o.indexOf(0,a)),type:o.readUInt32BE(a+=1),parser:t[o.readUInt32BE(a)],atttypmod:o.readUInt32BE(a+=4)},u.key&&l.keys.push(u),a+=4},Y:()=>{},O:()=>{},B:o=>{e.date=bf(o.readBigInt64BE(9)),e.lsn=o.subarray(1,9)},I:o=>{let a=1,l=e[o.readUInt32BE(a)],{row:f}=Vn(o,l.columns,a+=7,s);n(f,{command:"insert",relation:l})},D:o=>{let a=1,l=e[o.readUInt32BE(a)];a+=4;let f=o[a]===75;n(f||o[a]===79?Vn(o,l.columns,a+=3,s).row:null,{command:"delete",relation:l,key:f})},U:o=>{let a=1,l=e[o.readUInt32BE(a)];a+=4;let f=o[a]===75,u=f||o[a]===79?Vn(o,l.columns,a+=3,s):null;u&&(a=u.i);let{row:y}=Vn(o,l.columns,a+3,s);n(y,{command:"update",relation:l,key:f,old:u&&u.row})},T:()=>{},C:()=>{}}).reduce(i,{})[r[0]](r)}function Vn(r,e,t,n){let s,i,o,a=n.raw?new Array(e.length):{};for(let l=0;l<e.length;l++)s=r[t++],i=e[l],o=s===110?null:s===117?void 0:i.parser===void 0?r.toString("utf8",t+4,t+=4+r.readUInt32BE(t)):i.parser.array===!0?i.parser(r.toString("utf8",t+5,t+=4+r.readUInt32BE(t))):i.parser(r.toString("utf8",t+4,t+=4+r.readUInt32BE(t))),n.raw?a[l]=n.raw===!0?o:n.value.from?n.value.from(o,i):o:a[i.name]=n.value.from?n.value.from(o,i):o;return{i:t,row:n.row.from?n.row.from(a):a}}function vf(r){let e=r.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!e)throw new Error("Malformed subscribe pattern: "+r);let[,t,n,s]=e;return(t||"*")+(n?":"+(n.indexOf(".")===-1?"public."+n:n):"")+(s?"="+s:"")}var ao=ct(require("stream"),1);function co(r,e,t=393216){return new Promise(async(n,s)=>{await r.begin(async i=>{let o;!e&&([{oid:e}]=await i`select lo_creat(-1) as oid`);let[{fd:a}]=await i`select lo_open(${e}, ${t}) as fd`,l={writable:u,readable:f,close:()=>i`select lo_close(${a})`.then(o),tell:()=>i`select lo_tell64(${a})`,read:y=>i`select loread(${a}, ${y}) as data`,write:y=>i`select lowrite(${a}, ${y})`,truncate:y=>i`select lo_truncate64(${a}, ${y})`,seek:(y,h=0)=>i`select lo_lseek64(${a}, ${y}, ${h})`,size:()=>i`
          select
            lo_lseek64(${a}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return n(l),new Promise(async y=>o=y);async function f({highWaterMark:y=2048*8,start:h=0,end:v=1/0}={}){let T=v-h;return h&&await l.seek(h),new ao.default.Readable({highWaterMark:y,async read(b){let L=b>T?b-T:b;T-=b;let[{data:C}]=await l.read(L);this.push(C),C.length<b&&this.push(null)}})}async function u({highWaterMark:y=2048*8,start:h=0}={}){return h&&await l.seek(h),new ao.default.Writable({highWaterMark:y,write(v,T,b){l.write(v).then(()=>b(),b)}})}}).catch(s)})}Object.assign(Bn,{PostgresError:Lt,toPascal:Rt,pascal:Xi,toCamel:Dt,camel:Yi,toKebab:zt,kebab:eo,fromPascal:Xr,fromCamel:Yr,fromKebab:en,BigInt:{to:20,from:[20],parse:r=>BigInt(r),serialize:r=>r.toString()}});var pr=Bn;function Bn(r,e){let t=_f(r,e),n=t.no_subscribe||oo(Bn,{...t}),s=!1,i=Ke(),o=Ke(),a=Ke(),l=Ke(),f=Ke(),u=Ke(),y=Ke(),h=Ke(),v={connecting:o,reserved:a,closed:l,ended:f,open:u,busy:y,full:h},T=[...Array(t.max)].map(()=>io(t,v,{onopen:pe,onend:me,onclose:ze})),b=L(F);return Object.assign(b,{get parameters(){return t.parameters},largeObject:co.bind(null,b),subscribe:n,CLOSE:ur,END:ur,PostgresError:Lt,options:t,reserve:z,listen:C,begin:I,close:B,end:G}),b;function L(_){return _.debug=t.debug,Object.entries(t.types).reduce((X,[ue,xe])=>(X[ue]=we=>new rt(we,xe.to),X),$),Object.assign(se,{types:$,typed:$,unsafe:re,notify:q,array:P,json:Y,file:he}),se;function $(X,ue){return new rt(X,ue)}function se(X,...ue){return X&&Array.isArray(X.raw)?new Ue(X,ue,_,S):typeof X=="string"&&!ue.length?new fr(t.transform.column.to?t.transform.column.to(X):X):new Hr(X,ue)}function re(X,ue=[],xe={}){return arguments.length===2&&!Array.isArray(ue)&&(xe=ue,ue=[]),new Ue([X],ue,_,S,{prepare:!1,...xe,simple:"simple"in xe?xe.simple:ue.length===0})}function he(X,ue=[],xe={}){return arguments.length===2&&!Array.isArray(ue)&&(xe=ue,ue=[]),new Ue([],ue,ge=>{Aa.default.readFile(X,"utf8",(Ie,fe)=>{if(Ie)return ge.reject(Ie);ge.strings=[fe],_(ge)})},S,{...xe,simple:"simple"in xe?xe.simple:ue.length===0})}}async function C(_,$,se){let re={fn:$,onlisten:se},he=C.sql||(C.sql=Bn({...t,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(C.channels).forEach(([ge,{listeners:Ie}])=>{delete C.channels[ge],Promise.all(Ie.map(fe=>C(ge,fe.fn,fe.onlisten).catch(()=>{})))})},onnotify(ge,Ie){ge in C.channels&&C.channels[ge].listeners.forEach(fe=>fe.fn(Ie))}})),X=C.channels||(C.channels={});if(_ in X){X[_].listeners.push(re);let ge=await X[_].result;return re.onlisten&&re.onlisten(),{state:ge.state,unlisten:we}}X[_]={result:he`listen ${he.unsafe('"'+_.replace(/"/g,'""')+'"')}`,listeners:[re]};let xe=await X[_].result;return re.onlisten&&re.onlisten(),{state:xe.state,unlisten:we};async function we(){if(_ in X&&(X[_].listeners=X[_].listeners.filter(ge=>ge!==re),!X[_].listeners.length))return delete X[_],he`unlisten ${he.unsafe('"'+_.replace(/"/g,'""')+'"')}`}}async function q(_,$){return await b`select pg_notify(${_}, ${""+$})`}async function z(){let _=Ke(),$=u.length?u.shift():await new Promise(he=>{i.push({reserve:he}),l.length&&ie(l.shift())});D($,a),$.reserved=()=>_.length?$.execute(_.shift()):D($,a),$.reserved.release=!0;let se=L(re);return se.release=()=>{$.reserved=null,pe($)},se;function re(he){$.queue===h?_.push(he):$.execute(he)||D($,h)}}async function I(_,$){!$&&($=_,_="");let se=Ke(),re=0,he,X=null;try{return await b.unsafe("begin "+_.replace(/[^a-z ]/ig,""),[],{onexecute:xe}).execute(),await Promise.race([ue(he,$),new Promise((we,ge)=>he.onclose=ge)])}catch(we){throw we}async function ue(we,ge,Ie){let fe=L(Ae);fe.savepoint=Ct,fe.prepare=ye=>X=ye.replace(/[^a-z0-9$-_. ]/gi);let et,Me;Ie&&await fe`savepoint ${fe(Ie)}`;try{if(Me=await new Promise((ye,tt)=>{let ot=ge(fe);Promise.resolve(Array.isArray(ot)?Promise.all(ot):ot).then(ye,tt)}),et)throw et}catch(ye){throw await(Ie?fe`rollback to ${fe(Ie)}`:fe`rollback`),ye instanceof Lt&&ye.code==="25P02"&&et||ye}return Ie||(X?await fe`prepare transaction '${fe.unsafe(X)}'`:await fe`commit`),Me;function Ct(ye,tt){return ye&&Array.isArray(ye.raw)?Ct(ot=>ot.apply(ot,arguments)):(arguments.length===1&&(tt=ye,ye=null),ue(we,tt,"s"+re+++(ye?"_"+ye:"")))}function Ae(ye){ye.catch(tt=>et||(et=tt)),we.queue===h?se.push(ye):we.execute(ye)||D(we,h)}}function xe(we){he=we,D(we,a),we.reserved=()=>se.length?we.execute(se.shift()):D(we,a)}}function D(_,$){return _.queue.remove(_),$.push(_),_.queue=$,$===u?_.idleTimer.start():_.idleTimer.cancel(),_}function Y(_){return new rt(_,3802)}function P(_,$){return Array.isArray(_)?new rt(_,$||(_.length?Dn(_)||25:0),t.shared.typeArrayMap):P(Array.from(arguments))}function F(_){if(s)return _.reject(Ce.connection("CONNECTION_ENDED",t,t));if(u.length)return Z(u.shift(),_);if(l.length)return ie(l.shift(),_);y.length?Z(y.shift(),_):i.push(_)}function Z(_,$){return _.execute($)?D(_,y):D(_,h)}function S(_){return new Promise(($,se)=>{_.state?_.active?io(t).cancel(_.state,$,se):_.cancelled={resolve:$,reject:se}:(i.remove(_),_.cancelled=!0,_.reject(Ce.generic("57014","canceling statement due to user request")),$())})}async function G({timeout:_=null}={}){if(s)return s;await 1;let $;return s=Promise.race([new Promise(se=>_!==null&&($=setTimeout(W,_*1e3,se))),Promise.all(T.map(se=>se.end()).concat(C.sql?C.sql.end({timeout:0}):[],n.sql?n.sql.end({timeout:0}):[]))]).then(()=>clearTimeout($))}async function B(){await Promise.all(T.map(_=>_.end()))}async function W(_){for(await Promise.all(T.map($=>$.terminate()));i.length;)i.shift().reject(Ce.connection("CONNECTION_DESTROYED",t));_()}function ie(_,$){return D(_,o),_.connect($),_}function me(_){D(_,f)}function pe(_){if(i.length===0)return D(_,u);let $=Math.ceil(i.length/(o.length+1)),se=!0;for(;se&&i.length&&$-- >0;){let re=i.shift();if(re.reserve)return re.reserve(_);se=_.execute(re)}se?D(_,y):D(_,h)}function ze(_,$){D(_,l),_.reserved=null,_.onclose&&(_.onclose($),_.onclose=null),t.onclose&&t.onclose(_.id),i.length&&ie(_,i.shift())}}function _f(r,e){if(r&&r.shared)return r;let t=process.env,n=(!r||typeof r=="string"?e:r)||{},{url:s,multihost:i}=Nf(r),o=[...s.searchParams].reduce((h,[v,T])=>(h[v]=T,h),{}),a=n.hostname||n.host||i||s.hostname||t.PGHOST||"localhost",l=n.port||s.port||t.PGPORT||5432,f=n.user||n.username||s.username||t.PGUSERNAME||t.PGUSER||Af();n.no_prepare&&(n.prepare=!1),o.sslmode&&(o.ssl=o.sslmode,delete o.sslmode),"timeout"in n&&(console.log("The timeout option is deprecated, use idle_timeout instead"),n.idle_timeout=n.timeout),o.sslrootcert==="system"&&(o.ssl="verify-full");let u=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],y={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:xf,max_pipeline:100,backoff:Tf,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(a)?a:a.split(",").map(h=>h.split(":")[0]),port:Array.isArray(l)?l:a.split(",").map(h=>parseInt(h.split(":")[1]||l)),path:n.path||a.indexOf("/")>-1&&a+"/.s.PGSQL."+l,database:n.database||n.db||(s.pathname||"").slice(1)||t.PGDATABASE||f,user:f,pass:n.pass||n.password||s.password||t.PGPASSWORD||"",...Object.entries(y).reduce((h,[v,T])=>{let b=v in n?n[v]:v in o?o[v]==="disable"||o[v]==="false"?!1:o[v]:t["PG"+v.toUpperCase()]||T;return h[v]=typeof b=="string"&&u.includes(v)?+b:b,h},{}),connection:{application_name:"postgres.js",...n.connection,...Object.entries(o).reduce((h,[v,T])=>(v in y||(h[v]=T),h),{})},types:n.types||{},target_session_attrs:Sf(n,s,t),onnotice:n.onnotice,onnotify:n.onnotify,onclose:n.onclose,onparameter:n.onparameter,socket:n.socket,transform:Cf(n.transform||{undefined:void 0}),parameters:{},shared:{retries:0,typeArrayMap:{}},...ga(n.types)}}function Sf(r,e,t){let n=r.target_session_attrs||e.searchParams.get("target_session_attrs")||t.PGTARGETSESSIONATTRS;if(!n||["read-write","read-only","primary","standby","prefer-standby"].includes(n))return n;throw new Error("target_session_attrs "+n+" is not supported")}function Tf(r){return(.5+Math.random()/2)*Math.min(3**r/100,20)}function xf(){return 60*(30+Math.random()*30)}function Cf(r){return{undefined:r.undefined,column:{from:typeof r.column=="function"?r.column:r.column&&r.column.from,to:r.column&&r.column.to},value:{from:typeof r.value=="function"?r.value:r.value&&r.value.from,to:r.value&&r.value.to},row:{from:typeof r.row=="function"?r.row:r.row&&r.row.from,to:r.row&&r.row.to}}}function Nf(r){if(!r||typeof r!="string")return{url:{searchParams:new Map}};let e=r;e=e.slice(e.indexOf("://")+3).split(/[?/]/)[0],e=decodeURIComponent(e.slice(e.indexOf("@")+1));let t=new URL(r.replace(e,e.split(",")[0]));return{url:{username:decodeURIComponent(t.username),password:decodeURIComponent(t.password),host:t.host,hostname:t.hostname,port:t.port,pathname:t.pathname,searchParams:t.searchParams},multihost:e.indexOf(",")>-1&&e}}function Af(){try{return Na.default.userInfo().username}catch{return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}var m=Symbol.for("drizzle:entityKind"),Ny=Symbol.for("drizzle:hasOwnEntityKind");function w(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,m))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(r).constructor;if(t)for(;t;){if(m in t&&t[m]===e[m])return!0;t=Object.getPrototypeOf(t)}return!1}var Of,Un=class{write(e){console.log(e)}};Of=m,c(Un,Of,"ConsoleLogWriter");var Ef,tn=class{constructor(e){c(this,"writer");this.writer=e?.writer??new Un}logQuery(e,t){let n=t.map(i=>{try{return JSON.stringify(i)}catch{return String(i)}}),s=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${s}`)}};Ef=m,c(tn,Ef,"DefaultLogger");var kf,rn=class{logQuery(){}};kf=m,c(rn,kf,"NoopLogger");var Pf,$f,ke=class{constructor(){c(this,$f,"QueryPromise")}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};Pf=m,$f=Symbol.toStringTag,c(ke,Pf,"QueryPromise");var If,ae=class{constructor(e,t){c(this,"name");c(this,"keyAsName");c(this,"primary");c(this,"notNull");c(this,"default");c(this,"defaultFn");c(this,"onUpdateFn");c(this,"hasDefault");c(this,"isUnique");c(this,"uniqueName");c(this,"uniqueType");c(this,"dataType");c(this,"columnType");c(this,"enumValues");c(this,"generated");c(this,"generatedIdentity");c(this,"config");this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};If=m,c(ae,If,"Column");var Mf,nn=class{constructor(e,t,n){c(this,"config");c(this,"$default",this.$defaultFn);c(this,"$onUpdate",this.$onUpdateFn);this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};Mf=m,c(nn,Mf,"ColumnBuilder");var nt=Symbol.for("drizzle:Name");var jf,sn=class{constructor(e,t){c(this,"reference");c(this,"_onUpdate","no action");c(this,"_onDelete","no action");this.reference=()=>{let{name:n,columns:s,foreignColumns:i}=e();return{name:n,columns:s,foreignTable:i[0].table,foreignColumns:i}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kn(e,this)}};jf=m,c(sn,jf,"PgForeignKeyBuilder");var Lf,Kn=class{constructor(e,t){c(this,"reference");c(this,"onUpdate");c(this,"onDelete");this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}getName(){let{name:e,columns:t,foreignColumns:n}=this.reference(),s=t.map(a=>a.name),i=n.map(a=>a.name),o=[this.table[nt],...s,n[0].table[nt],...i];return e??`${o.join("_")}_fk`}};Lf=m,c(Kn,Lf,"PgForeignKey");function Zn(r,...e){return r(...e)}function uo(r,e){return`${r[nt]}_${e.join("_")}_unique`}var Df,Gn=class{constructor(e,t){c(this,"columns");c(this,"nullsNotDistinctConfig",!1);this.name=t,this.columns=e}nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Wn(e,this.columns,this.nullsNotDistinctConfig,this.name)}};Df=m,c(Gn,Df,"PgUniqueConstraintBuilder");var Rf,lo=class{constructor(e){c(this,"name");this.name=e}on(...e){return new Gn(e,this.name)}};Rf=m,c(lo,Rf,"PgUniqueOnConstraintBuilder");var zf,Wn=class{constructor(e,t,n,s){c(this,"columns");c(this,"name");c(this,"nullsNotDistinct",!1);this.table=e,this.columns=t,this.name=s??uo(this.table,this.columns.map(i=>i.name)),this.nullsNotDistinct=n}getName(){return this.name}};zf=m,c(Wn,zf,"PgUniqueConstraint");function Oa(r,e,t){for(let n=e;n<r.length;n++){let s=r[n];if(s==="\\"){n++;continue}if(s==='"')return[r.slice(e,n).replace(/\\/g,""),n+1];if(!t&&(s===","||s==="}"))return[r.slice(e,n).replace(/\\/g,""),n]}return[r.slice(e).replace(/\\/g,""),r.length]}function Ea(r,e=0){let t=[],n=e,s=!1;for(;n<r.length;){let i=r[n];if(i===","){(s||n===e)&&t.push(""),s=!0,n++;continue}if(s=!1,i==="\\"){n+=2;continue}if(i==='"'){let[l,f]=Oa(r,n+1,!0);t.push(l),n=f;continue}if(i==="}")return[t,n+1];if(i==="{"){let[l,f]=Ea(r,n+1);t.push(l),n=f;continue}let[o,a]=Oa(r,n,!1);t.push(o),n=a}return[t,n]}function ka(r){let[e]=Ea(r,1);return e}function fo(r){return`{${r.map(e=>Array.isArray(e)?fo(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var Ff,M=class extends nn{constructor(){super(...arguments);c(this,"foreignKeyConfigs",[])}array(t){return new Hn(this.config.name,this,t)}references(t,n={}){return this.foreignKeyConfigs.push({ref:t,actions:n}),this}unique(t,n){return this.config.isUnique=!0,this.config.uniqueName=t,this.config.uniqueType=n?.nulls,this}generatedAlwaysAs(t){return this.config.generated={as:t,type:"always",mode:"stored"},this}buildForeignKeys(t,n){return this.foreignKeyConfigs.map(({ref:s,actions:i})=>Zn((o,a)=>{let l=new sn(()=>{let f=o();return{columns:[t],foreignColumns:[f]}});return a.onUpdate&&l.onUpdate(a.onUpdate),a.onDelete&&l.onDelete(a.onDelete),l.build(n)},s,i))}buildExtraConfigColumn(t){return new Jn(t,this.config)}};Ff=m,c(M,Ff,"PgColumnBuilder");var Qf,N=class extends ae{constructor(e,t){t.uniqueName||(t.uniqueName=uo(e,[t.name])),super(e,t),this.table=e}};Qf=m,c(N,Qf,"PgColumn");var qf,Jn=class extends N{constructor(){super(...arguments);c(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});c(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(t){return this.indexConfig.opClass=t,this}};qf=m,c(Jn,qf,"ExtraConfigColumn");var Vf,mo=class{constructor(e,t,n,s){c(this,"name");c(this,"keyAsName");c(this,"type");c(this,"indexConfig");this.name=e,this.keyAsName=t,this.type=n,this.indexConfig=s}};Vf=m,c(mo,Vf,"IndexedColumn");var Bf,Hn=class extends M{constructor(e,t,n){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=n}build(e){let t=this.config.baseBuilder.build(e);return new Yn(e,this.config,t)}};Bf=m,c(Hn,Bf,"PgArrayBuilder");var Uf,po=class extends N{constructor(t,n,s,i){super(t,n);c(this,"size");this.baseColumn=s,this.range=i,this.size=n.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(t){return typeof t=="string"&&(t=ka(t)),t.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(t,n=!1){let s=t.map(i=>i===null?null:w(this.baseColumn,po)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return n?s:fo(s)}},Yn=po;Uf=m,c(Yn,Uf,"PgArray");var Pa=Symbol.for("drizzle:isPgEnum");function $a(r){return!!r&&typeof r=="function"&&Pa in r&&r[Pa]===!0}var Kf,ho=class extends M{constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new Xn(e,this.config)}};Kf=m,c(ho,Kf,"PgEnumColumnBuilder");var Zf,Xn=class extends N{constructor(t,n){super(t,n);c(this,"enum",this.config.enum);c(this,"enumValues",this.config.enum.enumValues);this.enum=n.enum}getSQLType(){return this.enum.enumName}};Zf=m,c(Xn,Zf,"PgEnumColumn");var Gf,Se=class{constructor(e,t,n,s=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:n,isWith:s}}};Gf=m,c(Se,Gf,"Subquery");var Wf,Ft=class extends Se{};Wf=m,c(Ft,Wf,"WithSubquery");var Ia="0.40.0";var go,yo,le={startActiveSpan(r,e){return go?(yo||(yo=go.trace.getTracer("drizzle-orm",Ia)),Zn((t,n)=>n.startActiveSpan(r,s=>{try{return e(s)}catch(i){throw s.setStatus({code:t.SpanStatusCode.ERROR,message:i instanceof Error?i.message:"Unknown error"}),i}finally{s.end()}}),go,yo)):e()}};var de=Symbol.for("drizzle:ViewBaseConfig");var es=Symbol.for("drizzle:Schema"),ts=Symbol.for("drizzle:Columns"),Ma=Symbol.for("drizzle:ExtraConfigColumns"),bo=Symbol.for("drizzle:OriginalName"),wo=Symbol.for("drizzle:BaseName"),on=Symbol.for("drizzle:IsAlias"),ja=Symbol.for("drizzle:ExtraConfigBuilder"),Jf=Symbol.for("drizzle:IsDrizzleTable"),Hf,Yf,Xf,ed,td,rd,nd,sd,id,od,O=class{constructor(e,t,n){c(this,Yf);c(this,Xf);c(this,ed);c(this,td);c(this,rd);c(this,nd);c(this,sd,!1);c(this,id,!0);c(this,od);this[nt]=this[bo]=e,this[es]=t,this[wo]=n}};Hf=m,Yf=nt,Xf=bo,ed=es,td=ts,rd=Ma,nd=wo,sd=on,id=Jf,od=ja,c(O,Hf,"Table"),c(O,"Symbol",{Name:nt,Schema:es,OriginalName:bo,Columns:ts,ExtraConfigColumns:Ma,BaseName:wo,IsAlias:on,ExtraConfigBuilder:ja});function Ve(r){return r[nt]}function Qt(r){return`${r[es]??"public"}.${r[nt]}`}var ld,vo=class{};ld=m,c(vo,ld,"FakePrimitiveParam");function _o(r){return r!=null&&typeof r.getSQL=="function"}function ad(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var ud,Te=class{constructor(e){c(this,"value");this.value=Array.isArray(e)?e:[e]}getSQL(){return new j([this])}};ud=m,c(Te,ud,"StringChunk");var fd,hr=class{constructor(e){c(this,"decoder",Da);c(this,"shouldInlineParams",!1);this.queryChunks=e}append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return le.startActiveSpan("drizzle.buildSQL",t=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,t){let n=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:s,escapeName:i,escapeParam:o,prepareTyping:a,inlineParams:l,paramStartIndex:f}=n;return ad(e.map(u=>{if(w(u,Te))return{sql:u.value.join(""),params:[]};if(w(u,gr))return{sql:i(u.value),params:[]};if(u===void 0)return{sql:"",params:[]};if(Array.isArray(u)){let y=[new Te("(")];for(let[h,v]of u.entries())y.push(v),h<u.length-1&&y.push(new Te(", "));return y.push(new Te(")")),this.buildQueryFromSourceParams(y,n)}if(w(u,hr))return this.buildQueryFromSourceParams(u.queryChunks,{...n,inlineParams:l||u.shouldInlineParams});if(w(u,O)){let y=u[O.Symbol.Schema],h=u[O.Symbol.Name];return{sql:y===void 0||u[on]?i(h):i(y)+"."+i(h),params:[]}}if(w(u,ae)){let y=s.getColumnCasing(u);if(t.invokeSource==="indexes")return{sql:i(y),params:[]};let h=u.table[O.Symbol.Schema];return{sql:u.table[on]||h===void 0?i(u.table[O.Symbol.Name])+"."+i(y):i(h)+"."+i(u.table[O.Symbol.Name])+"."+i(y),params:[]}}if(w(u,Re)){let y=u[de].schema,h=u[de].name;return{sql:y===void 0||u[de].isAlias?i(h):i(y)+"."+i(h),params:[]}}if(w(u,Qe)){if(w(u.value,lt))return{sql:o(f.value++,u),params:[u],typings:["none"]};let y=u.value===null?null:u.encoder.mapToDriverValue(u.value);if(w(y,hr))return this.buildQueryFromSourceParams([y],n);if(l)return{sql:this.mapInlineParam(y,n),params:[]};let h=["none"];return a&&(h=[a(u.encoder)]),{sql:o(f.value++,y),params:[y],typings:h}}return w(u,lt)?{sql:o(f.value++,u),params:[u],typings:["none"]}:w(u,hr.Aliased)&&u.fieldAlias!==void 0?{sql:i(u.fieldAlias),params:[]}:w(u,Se)?u._.isWith?{sql:i(u._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),u._.sql,new Te(") "),new gr(u._.alias)],n):$a(u)?u.schema?{sql:i(u.schema)+"."+i(u.enumName),params:[]}:{sql:i(u.enumName),params:[]}:_o(u)?u.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([u.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),u.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(u,n),params:[]}:{sql:o(f.value++,u),params:[u],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let n=e.toString();return t(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new hr.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},j=hr;fd=m,c(j,fd,"SQL");var dd,gr=class{constructor(e){c(this,"brand");this.value=e}getSQL(){return new j([this])}};dd=m,c(gr,dd,"Name");function La(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var Da={mapFromDriverValue:r=>r},Ra={mapToDriverValue:r=>r},wb={...Da,...Ra},md,Qe=class{constructor(e,t=Ra){c(this,"brand");this.value=e,this.encoder=t}getSQL(){return new j([this])}};md=m,c(Qe,md,"Param");function p(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new Te(r[0]));for(let[n,s]of e.entries())t.push(s,new Te(r[n+1]));return new j(t)}(r=>{function e(){return new j([])}r.empty=e;function t(l){return new j(l)}r.fromList=t;function n(l){return new j([new Te(l)])}r.raw=n;function s(l,f){let u=[];for(let[y,h]of l.entries())y>0&&f!==void 0&&u.push(f),u.push(h);return new j(u)}r.join=s;function i(l){return new gr(l)}r.identifier=i;function o(l){return new lt(l)}r.placeholder=o;function a(l,f){return new Qe(l,f)}r.param=a})(p||(p={}));(r=>{var t;let n=class{constructor(i,o){c(this,"isSelectionField",!1);this.sql=i,this.fieldAlias=o}getSQL(){return this.sql}clone(){return new n(this.sql,this.fieldAlias)}},e=n;t=m,c(e,t,"SQL.Aliased"),r.Aliased=e})(j||(j={}));var pd,lt=class{constructor(e){this.name=e}getSQL(){return new j([this])}};pd=m,c(lt,pd,"Placeholder");function So(r,e){return r.map(t=>{if(w(t,lt)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}if(w(t,Qe)&&w(t.value,lt)){if(!(t.value.name in e))throw new Error(`No value for placeholder "${t.value.name}" was provided`);return t.encoder.mapToDriverValue(e[t.value.name])}return t})}var cd=Symbol.for("drizzle:IsDrizzleView"),hd,gd,yd,Re=class{constructor({name:e,schema:t,selectedFields:n,query:s}){c(this,gd);c(this,yd,!0);this[de]={name:e,originalName:e,schema:t,selectedFields:n,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new j([this])}};hd=m,gd=de,yd=cd,c(Re,hd,"View");ae.prototype.getSQL=function(){return new j([this])};O.prototype.getSQL=function(){return new j([this])};Se.prototype.getSQL=function(){return new j([this])};var bd,Et=class{constructor(e){this.table=e}get(e,t){return t==="table"?this.table:e[t]}};bd=m,c(Et,bd,"ColumnAliasProxyHandler");var wd,qt=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}get(e,t){if(t===O.Symbol.IsAlias)return!0;if(t===O.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===O.Symbol.OriginalName)return this.alias;if(t===de)return{...e[de],name:this.alias,isAlias:!0};if(t===O.Symbol.Columns){let s=e[O.Symbol.Columns];if(!s)return s;let i={};return Object.keys(s).map(o=>{i[o]=new Proxy(s[o],new Et(new Proxy(e,this)))}),i}let n=e[t];return w(n,ae)?new Proxy(n,new Et(new Proxy(e,this))):n}};wd=m,c(qt,wd,"TableAliasProxyHandler");var vd,To=class{constructor(e){this.alias=e}get(e,t){return t==="sourceTable"?an(e.sourceTable,this.alias):e[t]}};vd=m,c(To,vd,"RelationTableAliasProxyHandler");function an(r,e){return new Proxy(r,new qt(e,!1))}function ut(r,e){return new Proxy(r,new Et(new Proxy(r.table,new qt(e,!1))))}function xo(r,e){return new j.Aliased(cn(r.sql,e),r.fieldAlias)}function cn(r,e){return p.join(r.queryChunks.map(t=>w(t,ae)?ut(t,e):w(t,j)?cn(t,e):w(t,j.Aliased)?xo(t,e):t))}var _d,Co=class{constructor(e){c(this,"config");this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===de)return{...e[de],selectedFields:new Proxy(e[de].selectedFields,this)};if(typeof t=="symbol")return e[t];let s=(w(e,Se)?e._.selectedFields:w(e,Re)?e[de].selectedFields:e)[t];if(w(s,j.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!s.isSelectionField)return s.sql;let i=s.clone();return i.isSelectionField=!0,i}if(w(s,j)){if(this.config.sqlBehavior==="sql")return s;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return w(s,ae)?this.config.alias?new Proxy(s,new Et(new Proxy(s.table,new qt(this.config.alias,this.config.replaceOriginalName??!1)))):s:typeof s!="object"||s===null?s:new Proxy(s,new Co(this.config))}},ve=Co;_d=m,c(ve,_d,"SelectionProxyHandler");function za(r,e,t){let n={},s=r.reduce((i,{path:o,field:a},l)=>{let f;w(a,ae)?f=a:w(a,j)?f=a.decoder:f=a.sql.decoder;let u=i;for(let[y,h]of o.entries())if(y<o.length-1)h in u||(u[h]={}),u=u[h];else{let v=e[l],T=u[h]=v===null?null:f.mapFromDriverValue(v);if(t&&w(a,ae)&&o.length===2){let b=o[0];b in n?typeof n[b]=="string"&&n[b]!==Ve(a.table)&&(n[b]=!1):n[b]=T===null?Ve(a.table):!1}}return i},{});if(t&&Object.keys(n).length>0)for(let[i,o]of Object.entries(n))typeof o=="string"&&!t[o]&&(s[i]=null);return s}function Je(r,e){return Object.entries(r).reduce((t,[n,s])=>{if(typeof n!="string")return t;let i=e?[...e,n]:[n];return w(s,ae)||w(s,j)||w(s,j.Aliased)?t.push({path:i,field:s}):w(s,O)?t.push(...Je(s[O.Symbol.Columns],i)):t.push(...Je(s,i)),t},[])}function ln(r,e){let t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(let[s,i]of t.entries())if(i!==n[s])return!1;return!0}function rs(r,e){let t=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,s])=>w(s,j)||w(s,ae)?[n,s]:[n,new Qe(s,r[O.Symbol.Columns][n])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function Fa(r,e){for(let t of e)for(let n of Object.getOwnPropertyNames(t.prototype))n!=="constructor"&&Object.defineProperty(r.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))}function Qa(r){return r[O.Symbol.Columns]}function gt(r){return w(r,Se)?r._.alias:w(r,Re)?r[de].name:w(r,j)?void 0:r[O.Symbol.IsAlias]?r[O.Symbol.Name]:r[O.Symbol.BaseName]}function te(r,e){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:e}}function qa(r){if(typeof r!="object"||r===null||r.constructor.name!=="Object")return!1;if("logger"in r){let e=typeof r.logger;return!(e!=="boolean"&&(e!=="object"||typeof r.logger.logQuery!="function")&&e!=="undefined")}if("schema"in r){let e=typeof r.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in r){let e=typeof r.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in r)return!(r.mode!=="default"||r.mode!=="planetscale"||r.mode!==void 0);if("connection"in r){let e=typeof r.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in r){let e=typeof r.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(r).length===0}var Sd,yr=class extends ke{constructor(t,n,s,i){super();c(this,"config");c(this,"authToken");c(this,"execute",t=>le.startActiveSpan("drizzle.operation",()=>this._prepare().execute(t,this.authToken)));this.session=n,this.dialect=s,this.config={table:t,withList:i}}where(t){return this.config.where=t,this}returning(t=this.config.table[O.Symbol.Columns]){return this.config.returningFields=t,this.config.returning=Je(t),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(t){return le.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,t,!0))}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ve({alias:Ve(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};Sd=m,c(yr,Sd,"PgDelete");function Td(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function xd(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,n,s)=>{let i=s===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return t+i},"")}function Cd(r){return r}var Nd,un=class{constructor(e){c(this,"cache",{});c(this,"cachedTables",{});c(this,"convert");this.convert=e==="snake_case"?Td:e==="camelCase"?xd:Cd}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[O.Symbol.Schema]??"public",n=e.table[O.Symbol.OriginalName],s=`${t}.${n}.${e.name}`;return this.cache[s]||this.cacheTable(e.table),this.cache[s]}cacheTable(e){let t=e[O.Symbol.Schema]??"public",n=e[O.Symbol.OriginalName],s=`${t}.${n}`;if(!this.cachedTables[s]){for(let i of Object.values(e[O.Symbol.Columns])){let o=`${s}.${i.name}`;this.cache[o]=this.convert(i.name)}this.cachedTables[s]=!0}}clearCache(){this.cache={},this.cachedTables={}}};Nd=m,c(un,Nd,"CasingCache");var Ad,br=class extends Error{constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}};Ad=m,c(br,Ad,"DrizzleError");var Od,fn=class extends br{constructor(){super({message:"Rollback"})}};Od=m,c(fn,Od,"TransactionRollbackError");var Ed,ft=class extends M{generatedAlwaysAsIdentity(e){if(e){let{name:t,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};Ed=m,c(ft,Ed,"PgIntColumnBaseBuilder");var kd,ns=class extends ft{constructor(e){super(e,"number","PgBigInt53")}build(e){return new ss(e,this.config)}};kd=m,c(ns,kd,"PgBigInt53Builder");var Pd,ss=class extends N{getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}};Pd=m,c(ss,Pd,"PgBigInt53");var $d,is=class extends ft{constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new os(e,this.config)}};$d=m,c(is,$d,"PgBigInt64Builder");var Id,os=class extends N{getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};Id=m,c(os,Id,"PgBigInt64");function Va(r,e){let{name:t,config:n}=te(r,e);return n.mode==="number"?new ns(t):new is(t)}var Md,as=class extends M{constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new cs(e,this.config)}};Md=m,c(as,Md,"PgBigSerial53Builder");var jd,cs=class extends N{getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}};jd=m,c(cs,jd,"PgBigSerial53");var Ld,ls=class extends M{constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new us(e,this.config)}};Ld=m,c(ls,Ld,"PgBigSerial64Builder");var Dd,us=class extends N{getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};Dd=m,c(us,Dd,"PgBigSerial64");function Ba(r,e){let{name:t,config:n}=te(r,e);return n.mode==="number"?new as(t):new ls(t)}var Rd,fs=class extends M{constructor(e){super(e,"boolean","PgBoolean")}build(e){return new ds(e,this.config)}};Rd=m,c(fs,Rd,"PgBooleanBuilder");var zd,ds=class extends N{getSQLType(){return"boolean"}};zd=m,c(ds,zd,"PgBoolean");function Ua(r){return new fs(r??"")}var Fd,ms=class extends M{constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new ps(e,this.config)}};Fd=m,c(ms,Fd,"PgCharBuilder");var Qd,ps=class extends N{constructor(){super(...arguments);c(this,"length",this.config.length);c(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};Qd=m,c(ps,Qd,"PgChar");function Ka(r,e={}){let{name:t,config:n}=te(r,e);return new ms(t,n)}var qd,hs=class extends M{constructor(e){super(e,"string","PgCidr")}build(e){return new gs(e,this.config)}};qd=m,c(hs,qd,"PgCidrBuilder");var Vd,gs=class extends N{getSQLType(){return"cidr"}};Vd=m,c(gs,Vd,"PgCidr");function Za(r){return new hs(r??"")}var Bd,ys=class extends M{constructor(e,t,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=n}build(e){return new bs(e,this.config)}};Bd=m,c(ys,Bd,"PgCustomColumnBuilder");var Ud,bs=class extends N{constructor(t,n){super(t,n);c(this,"sqlName");c(this,"mapTo");c(this,"mapFrom");this.sqlName=n.customTypeParams.dataType(n.fieldConfig),this.mapTo=n.customTypeParams.toDriver,this.mapFrom=n.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(t){return typeof this.mapFrom=="function"?this.mapFrom(t):t}mapToDriverValue(t){return typeof this.mapTo=="function"?this.mapTo(t):t}};Ud=m,c(bs,Ud,"PgCustomColumn");function Ga(r){return(e,t)=>{let{name:n,config:s}=te(e,t);return new ys(n,s,r)}}var Kd,st=class extends M{defaultNow(){return this.default(p`now()`)}};Kd=m,c(st,Kd,"PgDateColumnBaseBuilder");var Zd,ws=class extends st{constructor(e){super(e,"date","PgDate")}build(e){return new wr(e,this.config)}};Zd=m,c(ws,Zd,"PgDateBuilder");var Gd,wr=class extends N{getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}};Gd=m,c(wr,Gd,"PgDate");var Wd,vs=class extends st{constructor(e){super(e,"string","PgDateString")}build(e){return new vr(e,this.config)}};Wd=m,c(vs,Wd,"PgDateStringBuilder");var Jd,vr=class extends N{getSQLType(){return"date"}};Jd=m,c(vr,Jd,"PgDateString");function Wa(r,e){let{name:t,config:n}=te(r,e);return n?.mode==="date"?new ws(t):new vs(t)}var Hd,_s=class extends M{constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Ss(e,this.config)}};Hd=m,c(_s,Hd,"PgDoublePrecisionBuilder");var Yd,Ss=class extends N{getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};Yd=m,c(Ss,Yd,"PgDoublePrecision");function Ja(r){return new _s(r??"")}var Xd,Ts=class extends M{constructor(e){super(e,"string","PgInet")}build(e){return new xs(e,this.config)}};Xd=m,c(Ts,Xd,"PgInetBuilder");var em,xs=class extends N{getSQLType(){return"inet"}};em=m,c(xs,em,"PgInet");function Ha(r){return new Ts(r??"")}var tm,Cs=class extends ft{constructor(e){super(e,"number","PgInteger")}build(e){return new Ns(e,this.config)}};tm=m,c(Cs,tm,"PgIntegerBuilder");var rm,Ns=class extends N{getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};rm=m,c(Ns,rm,"PgInteger");function Ya(r){return new Cs(r??"")}var nm,As=class extends M{constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new Os(e,this.config)}};nm=m,c(As,nm,"PgIntervalBuilder");var sm,Os=class extends N{constructor(){super(...arguments);c(this,"fields",this.config.intervalConfig.fields);c(this,"precision",this.config.intervalConfig.precision)}getSQLType(){let t=this.fields?` ${this.fields}`:"",n=this.precision?`(${this.precision})`:"";return`interval${t}${n}`}};sm=m,c(Os,sm,"PgInterval");function Xa(r,e={}){let{name:t,config:n}=te(r,e);return new As(t,n)}var im,Es=class extends M{constructor(e){super(e,"json","PgJson")}build(e){return new _r(e,this.config)}};im=m,c(Es,im,"PgJsonBuilder");var om,_r=class extends N{constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};om=m,c(_r,om,"PgJson");function ec(r){return new Es(r??"")}var am,ks=class extends M{constructor(e){super(e,"json","PgJsonb")}build(e){return new Sr(e,this.config)}};am=m,c(ks,am,"PgJsonbBuilder");var cm,Sr=class extends N{constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};cm=m,c(Sr,cm,"PgJsonb");function tc(r){return new ks(r??"")}var lm,Ps=class extends M{constructor(e){super(e,"array","PgLine")}build(e){return new $s(e,this.config)}};lm=m,c(Ps,lm,"PgLineBuilder");var um,$s=class extends N{getSQLType(){return"line"}mapFromDriverValue(e){let[t,n,s]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(n),Number.parseFloat(s)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}};um=m,c($s,um,"PgLine");var fm,Is=class extends M{constructor(e){super(e,"json","PgLineABC")}build(e){return new Ms(e,this.config)}};fm=m,c(Is,fm,"PgLineABCBuilder");var dm,Ms=class extends N{getSQLType(){return"line"}mapFromDriverValue(e){let[t,n,s]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(n),c:Number.parseFloat(s)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};dm=m,c(Ms,dm,"PgLineABC");function rc(r,e){let{name:t,config:n}=te(r,e);return!n?.mode||n.mode==="tuple"?new Ps(t):new Is(t)}var mm,js=class extends M{constructor(e){super(e,"string","PgMacaddr")}build(e){return new Ls(e,this.config)}};mm=m,c(js,mm,"PgMacaddrBuilder");var pm,Ls=class extends N{getSQLType(){return"macaddr"}};pm=m,c(Ls,pm,"PgMacaddr");function nc(r){return new js(r??"")}var hm,Ds=class extends M{constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Rs(e,this.config)}};hm=m,c(Ds,hm,"PgMacaddr8Builder");var gm,Rs=class extends N{getSQLType(){return"macaddr8"}};gm=m,c(Rs,gm,"PgMacaddr8");function sc(r){return new Ds(r??"")}var ym,zs=class extends M{constructor(e,t,n){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=n}build(e){return new Tr(e,this.config)}};ym=m,c(zs,ym,"PgNumericBuilder");var bm,Tr=class extends N{constructor(t,n){super(t,n);c(this,"precision");c(this,"scale");this.precision=n.precision,this.scale=n.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};bm=m,c(Tr,bm,"PgNumeric");function No(r,e){let{name:t,config:n}=te(r,e);return new zs(t,n?.precision,n?.scale)}var ic=No;var wm,Fs=class extends M{constructor(e){super(e,"array","PgPointTuple")}build(e){return new Qs(e,this.config)}};wm=m,c(Fs,wm,"PgPointTupleBuilder");var vm,Qs=class extends N{getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,n]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}};vm=m,c(Qs,vm,"PgPointTuple");var _m,qs=class extends M{constructor(e){super(e,"json","PgPointObject")}build(e){return new Vs(e,this.config)}};_m=m,c(qs,_m,"PgPointObjectBuilder");var Sm,Vs=class extends N{getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};Sm=m,c(Vs,Sm,"PgPointObject");function oc(r,e){let{name:t,config:n}=te(r,e);return!n?.mode||n.mode==="tuple"?new Fs(t):new qs(t)}function Tm(r){let e=[];for(let t=0;t<r.length;t+=2)e.push(Number.parseInt(r.slice(t,t+2),16));return new Uint8Array(e)}function ac(r,e){let t=new ArrayBuffer(8),n=new DataView(t);for(let s=0;s<8;s++)n.setUint8(s,r[e+s]);return n.getFloat64(0,!0)}function Ao(r){let e=Tm(r),t=0,n=e[t];t+=1;let s=new DataView(e.buffer),i=s.getUint32(t,n===1);t+=4;let o;if(i&536870912&&(o=s.getUint32(t,n===1),t+=4),(i&65535)===1){let a=ac(e,t);t+=8;let l=ac(e,t);return t+=8,[a,l]}throw new Error("Unsupported geometry type")}var xm,Bs=class extends M{constructor(e){super(e,"array","PgGeometry")}build(e){return new Us(e,this.config)}};xm=m,c(Bs,xm,"PgGeometryBuilder");var Cm,Us=class extends N{getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Ao(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}};Cm=m,c(Us,Cm,"PgGeometry");var Nm,Ks=class extends M{constructor(e){super(e,"json","PgGeometryObject")}build(e){return new Zs(e,this.config)}};Nm=m,c(Ks,Nm,"PgGeometryObjectBuilder");var Am,Zs=class extends N{getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=Ao(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};Am=m,c(Zs,Am,"PgGeometryObject");function cc(r,e){let{name:t,config:n}=te(r,e);return!n?.mode||n.mode==="tuple"?new Bs(t):new Ks(t)}var Om,Gs=class extends M{constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new Ws(e,this.config)}};Om=m,c(Gs,Om,"PgRealBuilder");var Em,Ws=class extends N{constructor(t,n){super(t,n);c(this,"mapFromDriverValue",t=>typeof t=="string"?Number.parseFloat(t):t)}getSQLType(){return"real"}};Em=m,c(Ws,Em,"PgReal");function lc(r){return new Gs(r??"")}var km,Js=class extends M{constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Hs(e,this.config)}};km=m,c(Js,km,"PgSerialBuilder");var Pm,Hs=class extends N{getSQLType(){return"serial"}};Pm=m,c(Hs,Pm,"PgSerial");function uc(r){return new Js(r??"")}var $m,Ys=class extends ft{constructor(e){super(e,"number","PgSmallInt")}build(e){return new Xs(e,this.config)}};$m=m,c(Ys,$m,"PgSmallIntBuilder");var Im,Xs=class extends N{constructor(){super(...arguments);c(this,"mapFromDriverValue",t=>typeof t=="string"?Number(t):t)}getSQLType(){return"smallint"}};Im=m,c(Xs,Im,"PgSmallInt");function fc(r){return new Ys(r??"")}var Mm,ei=class extends M{constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new ti(e,this.config)}};Mm=m,c(ei,Mm,"PgSmallSerialBuilder");var jm,ti=class extends N{getSQLType(){return"smallserial"}};jm=m,c(ti,jm,"PgSmallSerial");function dc(r){return new ei(r??"")}var Lm,ri=class extends M{constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new ni(e,this.config)}};Lm=m,c(ri,Lm,"PgTextBuilder");var Dm,ni=class extends N{constructor(){super(...arguments);c(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}};Dm=m,c(ni,Dm,"PgText");function mc(r,e={}){let{name:t,config:n}=te(r,e);return new ri(t,n)}var Rm,si=class extends st{constructor(e,t,n){super(e,"string","PgTime"),this.withTimezone=t,this.precision=n,this.config.withTimezone=t,this.config.precision=n}build(e){return new xr(e,this.config)}};Rm=m,c(si,Rm,"PgTimeBuilder");var zm,xr=class extends N{constructor(t,n){super(t,n);c(this,"withTimezone");c(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};zm=m,c(xr,zm,"PgTime");function pc(r,e={}){let{name:t,config:n}=te(r,e);return new si(t,n.withTimezone??!1,n.precision)}var Fm,ii=class extends st{constructor(e,t,n){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=n}build(e){return new Cr(e,this.config)}};Fm=m,c(ii,Fm,"PgTimestampBuilder");var Qm,Cr=class extends N{constructor(t,n){super(t,n);c(this,"withTimezone");c(this,"precision");c(this,"mapFromDriverValue",t=>new Date(this.withTimezone?t:t+"+0000"));c(this,"mapToDriverValue",t=>t.toISOString());this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}};Qm=m,c(Cr,Qm,"PgTimestamp");var qm,oi=class extends st{constructor(e,t,n){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=n}build(e){return new Nr(e,this.config)}};qm=m,c(oi,qm,"PgTimestampStringBuilder");var Vm,Nr=class extends N{constructor(t,n){super(t,n);c(this,"withTimezone");c(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};Vm=m,c(Nr,Vm,"PgTimestampString");function hc(r,e={}){let{name:t,config:n}=te(r,e);return n?.mode==="string"?new oi(t,n.withTimezone??!1,n.precision):new ii(t,n?.withTimezone??!1,n?.precision)}var Bm,ai=class extends M{constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(p`gen_random_uuid()`)}build(e){return new Ar(e,this.config)}};Bm=m,c(ai,Bm,"PgUUIDBuilder");var Um,Ar=class extends N{getSQLType(){return"uuid"}};Um=m,c(Ar,Um,"PgUUID");function dn(r){return new ai(r??"")}var Km,ci=class extends M{constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new li(e,this.config)}};Km=m,c(ci,Km,"PgVarcharBuilder");var Zm,li=class extends N{constructor(){super(...arguments);c(this,"length",this.config.length);c(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};Zm=m,c(li,Zm,"PgVarchar");function mn(r,e={}){let{name:t,config:n}=te(r,e);return new ci(t,n)}var Gm,ui=class extends M{constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new fi(e,this.config)}};Gm=m,c(ui,Gm,"PgBinaryVectorBuilder");var Wm,fi=class extends N{constructor(){super(...arguments);c(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}};Wm=m,c(fi,Wm,"PgBinaryVector");function gc(r,e){let{name:t,config:n}=te(r,e);return new ui(t,n)}var Jm,di=class extends M{constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new mi(e,this.config)}};Jm=m,c(di,Jm,"PgHalfVectorBuilder");var Hm,mi=class extends N{constructor(){super(...arguments);c(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(t){return JSON.stringify(t)}mapFromDriverValue(t){return t.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};Hm=m,c(mi,Hm,"PgHalfVector");function yc(r,e){let{name:t,config:n}=te(r,e);return new di(t,n)}var Ym,pi=class extends M{constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new hi(e,this.config)}};Ym=m,c(pi,Ym,"PgSparseVectorBuilder");var Xm,hi=class extends N{constructor(){super(...arguments);c(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}};Xm=m,c(hi,Xm,"PgSparseVector");function bc(r,e){let{name:t,config:n}=te(r,e);return new pi(t,n)}var ep,gi=class extends M{constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new yi(e,this.config)}};ep=m,c(gi,ep,"PgVectorBuilder");var tp,yi=class extends N{constructor(){super(...arguments);c(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(t){return JSON.stringify(t)}mapFromDriverValue(t){return t.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};tp=m,c(yi,tp,"PgVector");function wc(r,e){let{name:t,config:n}=te(r,e);return new gi(t,n)}function vc(){return{bigint:Va,bigserial:Ba,boolean:Ua,char:Ka,cidr:Za,customType:Ga,date:Wa,doublePrecision:Ja,inet:Ha,integer:Ya,interval:Xa,json:ec,jsonb:tc,line:rc,macaddr:nc,macaddr8:sc,numeric:No,point:oc,geometry:cc,real:lc,serial:uc,smallint:fc,smallserial:dc,text:mc,time:pc,timestamp:hc,uuid:dn,varchar:mn,bit:gc,halfvec:yc,sparsevec:bc,vector:wc}}var Oo=Symbol.for("drizzle:PgInlineForeignKeys"),_c=Symbol.for("drizzle:EnableRLS"),np,sp,ip,op,ap,Ne=class extends O{constructor(){super(...arguments);c(this,sp,[]);c(this,ip,!1);c(this,op);c(this,ap,{})}};np=m,sp=Oo,ip=_c,op=O.Symbol.ExtraConfigBuilder,ap=O.Symbol.ExtraConfigColumns,c(Ne,np,"PgTable"),c(Ne,"Symbol",Object.assign({},O.Symbol,{InlineForeignKeys:Oo,EnableRLS:_c}));function rp(r,e,t,n,s=r){let i=new Ne(r,n,s),o=typeof e=="function"?e(vc()):e,a=Object.fromEntries(Object.entries(o).map(([u,y])=>{let h=y;h.setName(u);let v=h.build(i);return i[Oo].push(...h.buildForeignKeys(v,i)),[u,v]})),l=Object.fromEntries(Object.entries(o).map(([u,y])=>{let h=y;h.setName(u);let v=h.buildExtraConfigColumn(i);return[u,v]})),f=Object.assign(i,a);return f[O.Symbol.Columns]=a,f[O.Symbol.ExtraConfigColumns]=l,t&&(f[Ne.Symbol.ExtraConfigBuilder]=t),Object.assign(f,{enableRLS:()=>(f[Ne.Symbol.EnableRLS]=!0,f)})}var Sc=(r,e,t)=>rp(r,e,t,void 0);var cp,pn=class{constructor(e,t){c(this,"columns");c(this,"name");this.columns=e,this.name=t}build(e){return new bi(e,this.columns,this.name)}};cp=m,c(pn,cp,"PgPrimaryKeyBuilder");var lp,bi=class{constructor(e,t,n){c(this,"columns");c(this,"name");this.table=e,this.columns=t,this.name=n}getName(){return this.name??`${this.table[Ne.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};lp=m,c(bi,lp,"PgPrimaryKey");function Be(r,e){return La(e)&&!_o(r)&&!w(r,Qe)&&!w(r,lt)&&!w(r,ae)&&!w(r,O)&&!w(r,Re)?new Qe(r,e):r}var wi=(r,e)=>p`${r} = ${Be(e,r)}`,Tc=(r,e)=>p`${r} <> ${Be(e,r)}`;function hn(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new j(e):new j([new Te("("),p.join(e,new Te(" and ")),new Te(")")])}function xc(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new j(e):new j([new Te("("),p.join(e,new Te(" or ")),new Te(")")])}function Cc(r){return p`not ${r}`}var Nc=(r,e)=>p`${r} > ${Be(e,r)}`,Ac=(r,e)=>p`${r} >= ${Be(e,r)}`,Oc=(r,e)=>p`${r} < ${Be(e,r)}`,Ec=(r,e)=>p`${r} <= ${Be(e,r)}`;function kc(r,e){return Array.isArray(e)?e.length===0?p`false`:p`${r} in ${e.map(t=>Be(t,r))}`:p`${r} in ${Be(e,r)}`}function Pc(r,e){return Array.isArray(e)?e.length===0?p`true`:p`${r} not in ${e.map(t=>Be(t,r))}`:p`${r} not in ${Be(e,r)}`}function $c(r){return p`${r} is null`}function Ic(r){return p`${r} is not null`}function Mc(r){return p`exists ${r}`}function jc(r){return p`not exists ${r}`}function Lc(r,e,t){return p`${r} between ${Be(e,r)} and ${Be(t,r)}`}function Dc(r,e,t){return p`${r} not between ${Be(e,r)} and ${Be(t,r)}`}function Rc(r,e){return p`${r} like ${e}`}function zc(r,e){return p`${r} not like ${e}`}function Fc(r,e){return p`${r} ilike ${e}`}function Qc(r,e){return p`${r} not ilike ${e}`}function qc(r){return p`${r} asc`}function Vc(r){return p`${r} desc`}var dp,gn=class{constructor(e,t,n){c(this,"referencedTableName");c(this,"fieldName");this.sourceTable=e,this.referencedTable=t,this.relationName=n,this.referencedTableName=t[O.Symbol.Name]}};dp=m,c(gn,dp,"Relation");var mp,vi=class{constructor(e,t){this.table=e,this.config=t}};mp=m,c(vi,mp,"Relations");var pp,Eo=class extends gn{constructor(e,t,n,s){super(e,t,n?.relationName),this.config=n,this.isNullable=s}withFieldName(e){let t=new Eo(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},yt=Eo;pp=m,c(yt,pp,"One");var hp,ko=class extends gn{constructor(e,t,n){super(e,t,n?.relationName),this.config=n}withFieldName(e){let t=new ko(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}},Or=ko;hp=m,c(Or,hp,"Many");function Bc(){return{and:hn,between:Lc,eq:wi,exists:Mc,gt:Nc,gte:Ac,ilike:Fc,inArray:kc,isNull:$c,isNotNull:Ic,like:Rc,lt:Oc,lte:Ec,ne:Tc,not:Cc,notBetween:Dc,notExists:jc,notLike:zc,notIlike:Qc,notInArray:Pc,or:xc,sql:p}}function Uc(){return{sql:p,asc:qc,desc:Vc}}function Kc(r,e){Object.keys(r).length===1&&"default"in r&&!w(r.default,O)&&(r=r.default);let t={},n={},s={};for(let[i,o]of Object.entries(r))if(w(o,O)){let a=Qt(o),l=n[a];t[a]=i,s[i]={tsName:i,dbName:o[O.Symbol.Name],schema:o[O.Symbol.Schema],columns:o[O.Symbol.Columns],relations:l?.relations??{},primaryKey:l?.primaryKey??[]};for(let u of Object.values(o[O.Symbol.Columns]))u.primary&&s[i].primaryKey.push(u);let f=o[O.Symbol.ExtraConfigBuilder]?.(o[O.Symbol.ExtraConfigColumns]);if(f)for(let u of Object.values(f))w(u,pn)&&s[i].primaryKey.push(...u.columns)}else if(w(o,vi)){let a=Qt(o.table),l=t[a],f=o.config(e(o.table)),u;for(let[y,h]of Object.entries(f))if(l){let v=s[l];v.relations[y]=h,u&&v.primaryKey.push(...u)}else a in n||(n[a]={relations:{},primaryKey:u}),n[a].relations[y]=h}return{tables:s,tableNamesMap:t}}function up(r){return function(t,n){return new yt(r,t,n,n?.fields.reduce((s,i)=>s&&i.notNull,!0)??!1)}}function fp(r){return function(t,n){return new Or(r,t,n)}}function Zc(r,e,t){if(w(t,yt)&&t.config)return{fields:t.config.fields,references:t.config.references};let n=e[Qt(t.referencedTable)];if(!n)throw new Error(`Table "${t.referencedTable[O.Symbol.Name]}" not found in schema`);let s=r[n];if(!s)throw new Error(`Table "${n}" not found in schema`);let i=t.sourceTable,o=e[Qt(i)];if(!o)throw new Error(`Table "${i[O.Symbol.Name]}" not found in schema`);let a=[];for(let l of Object.values(s.relations))(t.relationName&&t!==l&&l.relationName===t.relationName||!t.relationName&&l.referencedTable===t.sourceTable)&&a.push(l);if(a.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${n}"`):new Error(`There are multiple relations between "${n}" and "${t.sourceTable[O.Symbol.Name]}". Please specify relation name`);if(a[0]&&w(a[0],yt)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${t.fieldName}"`)}function Gc(r){return{one:up(r),many:fp(r)}}function _i(r,e,t,n,s=i=>i){let i={};for(let[o,a]of n.entries())if(a.isJson){let l=e.relations[a.tsKey],f=t[o],u=typeof f=="string"?JSON.parse(f):f;i[a.tsKey]=w(l,yt)?u&&_i(r,r[a.relationTableTsKey],u,a.selection,s):u.map(y=>_i(r,r[a.relationTableTsKey],y,a.selection,s))}else{let l=s(t[o]),f=a.field,u;w(f,ae)?u=f:w(f,j)?u=f.decoder:u=f.sql.decoder,i[a.tsKey]=l===null?null:u.mapFromDriverValue(l)}return i}var gp,Vt=class extends Re{};gp=m,c(Vt,gp,"PgViewBase");var yp,bt=class{constructor(e){c(this,"casing");this.casing=new un(e?.casing)}async migrate(e,t,n){let s=typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",i=typeof n=="string"?"drizzle":n.migrationsSchema??"drizzle",o=p`
			CREATE TABLE IF NOT EXISTS ${p.identifier(i)}.${p.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(p`CREATE SCHEMA IF NOT EXISTS ${p.identifier(i)}`),await t.execute(o);let l=(await t.all(p`select id, hash, created_at from ${p.identifier(i)}.${p.identifier(s)} order by created_at desc limit 1`))[0];await t.transaction(async f=>{for await(let u of e)if(!l||Number(l.created_at)<u.folderMillis){for(let y of u.sql)await f.execute(p.raw(y));await f.execute(p`insert into ${p.identifier(i)}.${p.identifier(s)} ("hash", "created_at") values(${u.hash}, ${u.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[p`with `];for(let[n,s]of e.entries())t.push(p`${p.identifier(s._.alias)} as (${s._.sql})`),n<e.length-1&&t.push(p`, `);return t.push(p` `),p.join(t)}buildDeleteQuery({table:e,where:t,returning:n,withList:s}){let i=this.buildWithCTE(s),o=n?p` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,a=t?p` where ${t}`:void 0;return p`${i}delete from ${e}${a}${o}`}buildUpdateSet(e,t){let n=e[O.Symbol.Columns],s=Object.keys(n).filter(o=>t[o]!==void 0||n[o]?.onUpdateFn!==void 0),i=s.length;return p.join(s.flatMap((o,a)=>{let l=n[o],f=t[o]??p.param(l.onUpdateFn(),l),u=p`${p.identifier(this.casing.getColumnCasing(l))} = ${f}`;return a<i-1?[u,p.raw(", ")]:[u]}))}buildUpdateQuery({table:e,set:t,where:n,returning:s,withList:i,from:o,joins:a}){let l=this.buildWithCTE(i),f=e[Ne.Symbol.Name],u=e[Ne.Symbol.Schema],y=e[Ne.Symbol.OriginalName],h=f===y?void 0:f,v=p`${u?p`${p.identifier(u)}.`:void 0}${p.identifier(y)}${h&&p` ${p.identifier(h)}`}`,T=this.buildUpdateSet(e,t),b=o&&p.join([p.raw(" from "),this.buildFromTable(o)]),L=this.buildJoins(a),C=s?p` returning ${this.buildSelection(s,{isSingleTable:!o})}`:void 0,q=n?p` where ${n}`:void 0;return p`${l}update ${v} set ${T}${b}${L}${q}${C}`}buildSelection(e,{isSingleTable:t=!1}={}){let n=e.length,s=e.flatMap(({field:i},o)=>{let a=[];if(w(i,j.Aliased)&&i.isSelectionField)a.push(p.identifier(i.fieldAlias));else if(w(i,j.Aliased)||w(i,j)){let l=w(i,j.Aliased)?i.sql:i;t?a.push(new j(l.queryChunks.map(f=>w(f,N)?p.identifier(this.casing.getColumnCasing(f)):f))):a.push(l),w(i,j.Aliased)&&a.push(p` as ${p.identifier(i.fieldAlias)}`)}else w(i,ae)&&(t?a.push(p.identifier(this.casing.getColumnCasing(i))):a.push(i));return o<n-1&&a.push(p`, `),a});return p.join(s)}buildJoins(e){if(!e||e.length===0)return;let t=[];for(let[n,s]of e.entries()){n===0&&t.push(p` `);let i=s.table,o=s.lateral?p` lateral`:void 0;if(w(i,Ne)){let a=i[Ne.Symbol.Name],l=i[Ne.Symbol.Schema],f=i[Ne.Symbol.OriginalName],u=a===f?void 0:s.alias;t.push(p`${p.raw(s.joinType)} join${o} ${l?p`${p.identifier(l)}.`:void 0}${p.identifier(f)}${u&&p` ${p.identifier(u)}`} on ${s.on}`)}else if(w(i,Re)){let a=i[de].name,l=i[de].schema,f=i[de].originalName,u=a===f?void 0:s.alias;t.push(p`${p.raw(s.joinType)} join${o} ${l?p`${p.identifier(l)}.`:void 0}${p.identifier(f)}${u&&p` ${p.identifier(u)}`} on ${s.on}`)}else t.push(p`${p.raw(s.joinType)} join${o} ${i} on ${s.on}`);n<e.length-1&&t.push(p` `)}return p.join(t)}buildFromTable(e){if(w(e,O)&&e[O.Symbol.OriginalName]!==e[O.Symbol.Name]){let t=p`${p.identifier(e[O.Symbol.OriginalName])}`;return e[O.Symbol.Schema]&&(t=p`${p.identifier(e[O.Symbol.Schema])}.${t}`),p`${t} ${p.identifier(e[O.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:n,where:s,having:i,table:o,joins:a,orderBy:l,groupBy:f,limit:u,offset:y,lockingClause:h,distinct:v,setOperators:T}){let b=n??Je(t);for(let ie of b)if(w(ie.field,ae)&&Ve(ie.field.table)!==(w(o,Se)?o._.alias:w(o,Vt)?o[de].name:w(o,j)?void 0:Ve(o))&&!(me=>a?.some(({alias:pe})=>pe===(me[O.Symbol.IsAlias]?Ve(me):me[O.Symbol.BaseName])))(ie.field.table)){let me=Ve(ie.field.table);throw new Error(`Your "${ie.path.join("->")}" field references a column "${me}"."${ie.field.name}", but the table "${me}" is not part of the query! Did you forget to join it?`)}let L=!a||a.length===0,C=this.buildWithCTE(e),q;v&&(q=v===!0?p` distinct`:p` distinct on (${p.join(v.on,p`, `)})`);let z=this.buildSelection(b,{isSingleTable:L}),I=this.buildFromTable(o),D=this.buildJoins(a),Y=s?p` where ${s}`:void 0,P=i?p` having ${i}`:void 0,F;l&&l.length>0&&(F=p` order by ${p.join(l,p`, `)}`);let Z;f&&f.length>0&&(Z=p` group by ${p.join(f,p`, `)}`);let S=typeof u=="object"||typeof u=="number"&&u>=0?p` limit ${u}`:void 0,G=y?p` offset ${y}`:void 0,B=p.empty();if(h){let ie=p` for ${p.raw(h.strength)}`;h.config.of&&ie.append(p` of ${p.join(Array.isArray(h.config.of)?h.config.of:[h.config.of],p`, `)}`),h.config.noWait?ie.append(p` no wait`):h.config.skipLocked&&ie.append(p` skip locked`),B.append(ie)}let W=p`${C}select${q} ${z} from ${I}${D}${Y}${Z}${P}${F}${S}${G}${B}`;return T.length>0?this.buildSetOperations(W,T):W}buildSetOperations(e,t){let[n,...s]=t;if(!n)throw new Error("Cannot pass undefined values to any set operator");return s.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:n,rightSelect:s,limit:i,orderBy:o,offset:a}}){let l=p`(${e.getSQL()}) `,f=p`(${s.getSQL()})`,u;if(o&&o.length>0){let T=[];for(let b of o)if(w(b,N))T.push(p.identifier(b.name));else if(w(b,j)){for(let L=0;L<b.queryChunks.length;L++){let C=b.queryChunks[L];w(C,N)&&(b.queryChunks[L]=p.identifier(C.name))}T.push(p`${b}`)}else T.push(p`${b}`);u=p` order by ${p.join(T,p`, `)} `}let y=typeof i=="object"||typeof i=="number"&&i>=0?p` limit ${i}`:void 0,h=p.raw(`${t} ${n?"all ":""}`),v=a?p` offset ${a}`:void 0;return p`${l}${h}${f}${u}${y}${v}`}buildInsertQuery({table:e,values:t,onConflict:n,returning:s,withList:i,select:o,overridingSystemValue_:a}){let l=[],f=e[O.Symbol.Columns],u=Object.entries(f).filter(([C,q])=>!q.shouldDisableInsert()),y=u.map(([,C])=>p.identifier(this.casing.getColumnCasing(C)));if(o){let C=t;w(C,j)?l.push(C):l.push(C.getSQL())}else{let C=t;l.push(p.raw("values "));for(let[q,z]of C.entries()){let I=[];for(let[D,Y]of u){let P=z[D];if(P===void 0||w(P,Qe)&&P.value===void 0)if(Y.defaultFn!==void 0){let F=Y.defaultFn(),Z=w(F,j)?F:p.param(F,Y);I.push(Z)}else if(!Y.default&&Y.onUpdateFn!==void 0){let F=Y.onUpdateFn(),Z=w(F,j)?F:p.param(F,Y);I.push(Z)}else I.push(p`default`);else I.push(P)}l.push(I),q<C.length-1&&l.push(p`, `)}}let h=this.buildWithCTE(i),v=p.join(l),T=s?p` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,b=n?p` on conflict ${n}`:void 0,L=a===!0?p`overriding system value `:void 0;return p`${h}insert into ${e} ${y} ${L}${v}${b}${T}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:n}){let s=t?p` concurrently`:void 0,i=n?p` with no data`:void 0;return p`refresh materialized view${s} ${e}${i}`}prepareTyping(e){return w(e,Sr)||w(e,_r)?"json":w(e,Tr)?"decimal":w(e,xr)?"time":w(e,Cr)||w(e,Nr)?"timestamp":w(e,wr)||w(e,vr)?"date":w(e,Ar)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:n,table:s,tableConfig:i,queryConfig:o,tableAlias:a,nestedQueryRelation:l,joinOn:f}){let u=[],y,h,v=[],T,b=[];if(o===!0)u=Object.entries(i.columns).map(([q,z])=>({dbKey:z.name,tsKey:q,field:ut(z,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let C=Object.fromEntries(Object.entries(i.columns).map(([P,F])=>[P,ut(F,a)]));if(o.where){let P=typeof o.where=="function"?o.where(C,Bc()):o.where;T=P&&cn(P,a)}let q=[],z=[];if(o.columns){let P=!1;for(let[F,Z]of Object.entries(o.columns))Z!==void 0&&F in i.columns&&(!P&&Z===!0&&(P=!0),z.push(F));z.length>0&&(z=P?z.filter(F=>o.columns?.[F]===!0):Object.keys(i.columns).filter(F=>!z.includes(F)))}else z=Object.keys(i.columns);for(let P of z){let F=i.columns[P];q.push({tsKey:P,value:F})}let I=[];o.with&&(I=Object.entries(o.with).filter(P=>!!P[1]).map(([P,F])=>({tsKey:P,queryConfig:F,relation:i.relations[P]})));let D;if(o.extras){D=typeof o.extras=="function"?o.extras(C,{sql:p}):o.extras;for(let[P,F]of Object.entries(D))q.push({tsKey:P,value:xo(F,a)})}for(let{tsKey:P,value:F}of q)u.push({dbKey:w(F,j.Aliased)?F.fieldAlias:i.columns[P].name,tsKey:P,field:w(F,ae)?ut(F,a):F,relationTableTsKey:void 0,isJson:!1,selection:[]});let Y=typeof o.orderBy=="function"?o.orderBy(C,Uc()):o.orderBy??[];Array.isArray(Y)||(Y=[Y]),v=Y.map(P=>w(P,ae)?ut(P,a):cn(P,a)),y=o.limit,h=o.offset;for(let{tsKey:P,queryConfig:F,relation:Z}of I){let S=Zc(t,n,Z),G=Qt(Z.referencedTable),B=n[G],W=`${a}_${P}`,ie=hn(...S.fields.map((ze,_)=>wi(ut(S.references[_],W),ut(ze,a)))),me=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:n,table:e[B],tableConfig:t[B],queryConfig:w(Z,yt)?F===!0?{limit:1}:{...F,limit:1}:F,tableAlias:W,joinOn:ie,nestedQueryRelation:Z}),pe=p`${p.identifier(W)}.${p.identifier("data")}`.as(P);b.push({on:p`true`,table:new Se(me.sql,{},W),alias:W,joinType:"left",lateral:!0}),u.push({dbKey:P,tsKey:P,field:pe,relationTableTsKey:B,isJson:!0,selection:me.selection})}}if(u.length===0)throw new br({message:`No fields selected for table "${i.tsName}" ("${a}")`});let L;if(T=hn(f,T),l){let C=p`json_build_array(${p.join(u.map(({field:I,tsKey:D,isJson:Y})=>Y?p`${p.identifier(`${a}_${D}`)}.${p.identifier("data")}`:w(I,j.Aliased)?I.sql:I),p`, `)})`;w(l,Or)&&(C=p`coalesce(json_agg(${C}${v.length>0?p` order by ${p.join(v,p`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:C.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:u}];y!==void 0||h!==void 0||v.length>0?(L=this.buildSelectQuery({table:an(s,a),fields:{},fieldsFlat:[{path:[],field:p.raw("*")}],where:T,limit:y,offset:h,orderBy:v,setOperators:[]}),T=void 0,y=void 0,h=void 0,v=[]):L=an(s,a),L=this.buildSelectQuery({table:w(L,Ne)?L:new Se(L,{},a),fields:{},fieldsFlat:q.map(({field:I})=>({path:[],field:w(I,ae)?ut(I,a):I})),joins:b,where:T,limit:y,offset:h,orderBy:v,setOperators:[]})}else L=this.buildSelectQuery({table:an(s,a),fields:{},fieldsFlat:u.map(({field:C})=>({path:[],field:w(C,ae)?ut(C,a):C})),joins:b,where:T,limit:y,offset:h,orderBy:v,setOperators:[]});return{tableTsKey:i.tsName,sql:L,selection:u}}};yp=m,c(bt,yp,"PgDialect");var bp,yn=class{getSelectedFields(){return this._.selectedFields}};bp=m,c(yn,bp,"TypedQueryBuilder");var Np,Pe=class{constructor(e){c(this,"fields");c(this,"session");c(this,"dialect");c(this,"withList",[]);c(this,"distinct");c(this,"authToken");this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}setToken(e){return this.authToken=e,this}from(e){let t=!!this.fields,n=e,s;return this.fields?s=this.fields:w(n,Se)?s=Object.fromEntries(Object.keys(n._.selectedFields).map(i=>[i,n[i]])):w(n,Vt)?s=n[de].selectedFields:w(n,j)?s={}:s=Qa(n),new bn({table:n,fields:s,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}};Np=m,c(Pe,Np,"PgSelectBuilder");var Ap,Si=class extends yn{constructor({table:t,fields:n,isPartialSelect:s,session:i,dialect:o,withList:a,distinct:l}){super();c(this,"_");c(this,"config");c(this,"joinsNotNullableMap");c(this,"tableName");c(this,"isPartialSelect");c(this,"session");c(this,"dialect");c(this,"leftJoin",this.createJoin("left"));c(this,"rightJoin",this.createJoin("right"));c(this,"innerJoin",this.createJoin("inner"));c(this,"fullJoin",this.createJoin("full"));c(this,"union",this.createSetOperator("union",!1));c(this,"unionAll",this.createSetOperator("union",!0));c(this,"intersect",this.createSetOperator("intersect",!1));c(this,"intersectAll",this.createSetOperator("intersect",!0));c(this,"except",this.createSetOperator("except",!1));c(this,"exceptAll",this.createSetOperator("except",!0));this.config={withList:a,table:t,fields:{...n},distinct:l,setOperators:[]},this.isPartialSelect=s,this.session=i,this.dialect=o,this._={selectedFields:n},this.tableName=gt(t),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(t){return(n,s)=>{let i=this.tableName,o=gt(n);if(typeof o=="string"&&this.config.joins?.some(a=>a.alias===o))throw new Error(`Alias "${o}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof o=="string"&&!w(n,j))){let a=w(n,Se)?n._.selectedFields:w(n,Re)?n[de].selectedFields:n[O.Symbol.Columns];this.config.fields[o]=a}if(typeof s=="function"&&(s=s(new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:s,table:n,joinType:t,alias:o}),typeof o=="string")switch(t){case"left":{this.joinsNotNullableMap[o]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[o]=!0;break}case"inner":{this.joinsNotNullableMap[o]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[o]=!1;break}}return this}}createSetOperator(t,n){return s=>{let i=typeof s=="function"?s(wp()):s;if(!ln(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:t,isAll:n,rightSelect:i}),this}}addSetOperators(t){return this.config.setOperators.push(...t),this}where(t){return typeof t=="function"&&(t=t(new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=t,this}having(t){return typeof t=="function"&&(t=t(new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=t,this}groupBy(...t){if(typeof t[0]=="function"){let n=t[0](new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(n)?n:[n]}else this.config.groupBy=t;return this}orderBy(...t){if(typeof t[0]=="function"){let n=t[0](new Proxy(this.config.fields,new ve({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(n)?n:[n];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}else{let n=t;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}return this}limit(t){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=t:this.config.limit=t,this}offset(t){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=t:this.config.offset=t,this}for(t,n={}){return this.config.lockingClause={strength:t,config:n},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}as(t){return new Proxy(new Se(this.getSQL(),this.config.fields,t),new ve({alias:t,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new ve({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}};Ap=m,c(Si,Ap,"PgSelectQueryBuilder");var Op,bn=class extends Si{constructor(){super(...arguments);c(this,"authToken");c(this,"execute",t=>le.startActiveSpan("drizzle.operation",()=>this._prepare().execute(t,this.authToken)))}_prepare(t){let{session:n,config:s,dialect:i,joinsNotNullableMap:o,authToken:a}=this;if(!n)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return le.startActiveSpan("drizzle.prepareQuery",()=>{let l=Je(s.fields),f=n.prepareQuery(i.sqlToQuery(this.getSQL()),l,t,!0);return f.joinsNotNullableMap=o,f.setToken(a)})}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}};Op=m,c(bn,Op,"PgSelect");Fa(bn,[ke]);function Er(r,e){return(t,n,...s)=>{let i=[n,...s].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of i)if(!ln(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(i)}}var wp=()=>({union:vp,unionAll:_p,intersect:Sp,intersectAll:Tp,except:xp,exceptAll:Cp}),vp=Er("union",!1),_p=Er("union",!0),Sp=Er("intersect",!1),Tp=Er("intersect",!0),xp=Er("except",!1),Cp=Er("except",!0);var Ep,Bt=class{constructor(e){c(this,"dialect");c(this,"dialectConfig");c(this,"$with",(e,t)=>{let n=this;return{as:i=>(typeof i=="function"&&(i=i(n)),new Proxy(new Ft(i.getSQL(),t??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new ve({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}});this.dialect=w(e,bt)?e:void 0,this.dialectConfig=w(e,bt)?void 0:e}with(...e){let t=this;function n(o){return new Pe({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function s(o){return new Pe({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function i(o,a){return new Pe({fields:a??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:o}})}return{select:n,selectDistinct:s,selectDistinctOn:i}}select(e){return new Pe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Pe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new Pe({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new bt(this.dialectConfig)),this.dialect}};Ep=m,c(Bt,Ep,"PgQueryBuilder");var kp,kr=class{constructor(e,t,n,s,i){c(this,"authToken");this.table=e,this.session=t,this.dialect=n,this.withList=s,this.overridingSystemValue_=i}setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(n=>{let s={},i=this.table[O.Symbol.Columns];for(let o of Object.keys(n)){let a=n[o];s[o]=w(a,j)?a:new Qe(a,i[o])}return s});return new wn(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t=typeof e=="function"?e(new Bt):e;if(!w(t,j)&&!ln(this.table[ts],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new wn(this.table,t,this.session,this.dialect,this.withList,!0)}};kp=m,c(kr,kp,"PgInsertBuilder");var Pp,wn=class extends ke{constructor(t,n,s,i,o,a,l){super();c(this,"config");c(this,"authToken");c(this,"execute",t=>le.startActiveSpan("drizzle.operation",()=>this._prepare().execute(t,this.authToken)));this.session=s,this.dialect=i,this.config={table:t,values:n,withList:o,select:a,overridingSystemValue_:l}}returning(t=this.config.table[O.Symbol.Columns]){return this.config.returningFields=t,this.config.returning=Je(t),this}onConflictDoNothing(t={}){if(t.target===void 0)this.config.onConflict=p`do nothing`;else{let n="";n=Array.isArray(t.target)?t.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(t.target));let s=t.where?p` where ${t.where}`:void 0;this.config.onConflict=p`(${p.raw(n)})${s} do nothing`}return this}onConflictDoUpdate(t){if(t.where&&(t.targetWhere||t.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let n=t.where?p` where ${t.where}`:void 0,s=t.targetWhere?p` where ${t.targetWhere}`:void 0,i=t.setWhere?p` where ${t.setWhere}`:void 0,o=this.dialect.buildUpdateSet(this.config.table,rs(this.config.table,t.set)),a="";return a=Array.isArray(t.target)?t.target.map(l=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(l))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(t.target)),this.config.onConflict=p`(${p.raw(a)})${s} do update set ${o}${n}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(t){return le.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,t,!0))}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ve({alias:Ve(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};Pp=m,c(wn,Pp,"PgInsert");var $p,vn=class extends ke{constructor(t,n,s){super();c(this,"config");c(this,"authToken");c(this,"execute",t=>le.startActiveSpan("drizzle.operation",()=>this._prepare().execute(t,this.authToken)));this.session=n,this.dialect=s,this.config={view:t}}concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(t){return le.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,t,!0))}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}};$p=m,c(vn,$p,"PgRefreshMaterializedView");var Ip,Pr=class{constructor(e,t,n,s){c(this,"authToken");this.table=e,this.session=t,this.dialect=n,this.withList=s}setToken(e){return this.authToken=e,this}set(e){return new Ti(this.table,rs(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}};Ip=m,c(Pr,Ip,"PgUpdateBuilder");var Mp,Ti=class extends ke{constructor(t,n,s,i,o){super();c(this,"config");c(this,"tableName");c(this,"joinsNotNullableMap");c(this,"leftJoin",this.createJoin("left"));c(this,"rightJoin",this.createJoin("right"));c(this,"innerJoin",this.createJoin("inner"));c(this,"fullJoin",this.createJoin("full"));c(this,"authToken");c(this,"execute",t=>this._prepare().execute(t,this.authToken));this.session=s,this.dialect=i,this.config={set:n,table:t,withList:o,joins:[]},this.tableName=gt(t),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}from(t){let n=t,s=gt(n);return typeof s=="string"&&(this.joinsNotNullableMap[s]=!0),this.config.from=n,this}getTableLikeFields(t){return w(t,Ne)?t[O.Symbol.Columns]:w(t,Se)?t._.selectedFields:t[de].selectedFields}createJoin(t){return(n,s)=>{let i=gt(n);if(typeof i=="string"&&this.config.joins.some(o=>o.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof s=="function"){let o=this.config.from&&!w(this.config.from,j)?this.getTableLikeFields(this.config.from):void 0;s=s(new Proxy(this.config.table[O.Symbol.Columns],new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),o&&new Proxy(o,new ve({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:s,table:n,joinType:t,alias:i}),typeof i=="string")switch(t){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}where(t){return this.config.where=t,this}returning(t){if(!t&&(t=Object.assign({},this.config.table[O.Symbol.Columns]),this.config.from)){let n=gt(this.config.from);if(typeof n=="string"&&this.config.from&&!w(this.config.from,j)){let s=this.getTableLikeFields(this.config.from);t[n]=s}for(let s of this.config.joins){let i=gt(s.table);if(typeof i=="string"&&!w(s.table,j)){let o=this.getTableLikeFields(s.table);t[i]=o}}}return this.config.returningFields=t,this.config.returning=Je(t),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(t){let n=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,t,!0);return n.joinsNotNullableMap=this.joinsNotNullableMap,n}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ve({alias:Ve(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};Mp=m,c(Ti,Mp,"PgUpdate");var jp,Lp,xi=class extends j{constructor(t){super(xi.buildEmbeddedCount(t.source,t.filters).queryChunks);c(this,"sql");c(this,"token");c(this,Lp,"PgCountBuilder");c(this,"session");this.params=t,this.mapWith(Number),this.session=t.session,this.sql=xi.buildCount(t.source,t.filters)}static buildEmbeddedCount(t,n){return p`(select count(*) from ${t}${p.raw(" where ").if(n)}${n})`}static buildCount(t,n){return p`select count(*) as count from ${t}${p.raw(" where ").if(n)}${n};`}setToken(t){return this.token=t,this}then(t,n){return Promise.resolve(this.session.count(this.sql,this.token)).then(t,n)}catch(t){return this.then(void 0,t)}finally(t){return this.then(n=>(t?.(),n),n=>{throw t?.(),n})}},_n=xi;jp=m,Lp=Symbol.toStringTag,c(_n,jp,"PgCountBuilder");var Dp,Sn=class{constructor(e,t,n,s,i,o,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=s,this.tableConfig=i,this.dialect=o,this.session=a}findMany(e){return new Tn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new Tn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}};Dp=m,c(Sn,Dp,"PgRelationalQueryBuilder");var Rp,Tn=class extends ke{constructor(t,n,s,i,o,a,l,f,u){super();c(this,"authToken");this.fullSchema=t,this.schema=n,this.tableNamesMap=s,this.table=i,this.tableConfig=o,this.dialect=a,this.session=l,this.config=f,this.mode=u}_prepare(t){return le.startActiveSpan("drizzle.prepareQuery",()=>{let{query:n,builtQuery:s}=this._toSQL();return this.session.prepareQuery(s,void 0,t,!0,(i,o)=>{let a=i.map(l=>_i(this.schema,this.tableConfig,l,n.selection,o));return this.mode==="first"?a[0]:a})})}prepare(t){return this._prepare(t)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let t=this._getQuery(),n=this.dialect.sqlToQuery(t.sql);return{query:t,builtQuery:n}}toSQL(){return this._toSQL().builtQuery}setToken(t){return this.authToken=t,this}execute(){return le.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};Rp=m,c(Tn,Rp,"PgRelationalQuery");var zp,xn=class extends ke{constructor(e,t,n,s){super(),this.execute=e,this.sql=t,this.query=n,this.mapBatchResult=s}getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};zp=m,c(xn,zp,"PgRaw");var Fp,Ut=class{constructor(e,t,n){c(this,"query");c(this,"$with",(e,t)=>{let n=this;return{as:i=>(typeof i=="function"&&(i=i(new Bt(n.dialect))),new Proxy(new Ft(i.getSQL(),t??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new ve({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}});c(this,"authToken");if(this.dialect=e,this.session=t,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[s,i]of Object.entries(this._.schema))this.query[s]=new Sn(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[s],i,e,t)}$count(e,t){return new _n({source:e,filters:t,session:this.session})}with(...e){let t=this;function n(f){return new Pe({fields:f??void 0,session:t.session,dialect:t.dialect,withList:e})}function s(f){return new Pe({fields:f??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function i(f,u){return new Pe({fields:u??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:f}})}function o(f){return new Pr(f,t.session,t.dialect,e)}function a(f){return new kr(f,t.session,t.dialect,e)}function l(f){return new yr(f,t.session,t.dialect,e)}return{select:n,selectDistinct:s,selectDistinctOn:i,update:o,insert:a,delete:l}}select(e){return new Pe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Pe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new Pe({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Pr(e,this.session,this.dialect)}insert(e){return new kr(e,this.session,this.dialect)}delete(e){return new yr(e,this.session,this.dialect)}refreshMaterializedView(e){return new vn(e,this.session,this.dialect)}execute(e){let t=typeof e=="string"?p.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(t),s=this.session.prepareQuery(n,void 0,void 0,!1);return new xn(()=>s.execute(void 0,this.authToken),t,n,i=>s.mapResult(i,!0))}transaction(e,t){return this.session.transaction(e,t)}};Fp=m,c(Ut,Fp,"PgDatabase");var Qp,Cn=class{constructor(e){c(this,"authToken");c(this,"joinsNotNullableMap");this.query=e}getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}};Qp=m,c(Cn,Qp,"PgPreparedQuery");var qp,Nn=class{constructor(e){this.dialect=e}execute(e,t){return le.startActiveSpan("drizzle.operation",()=>le.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){let n=await this.execute(e,t);return Number(n[0].count)}};qp=m,c(Nn,qp,"PgSession");var Vp,An=class extends Ut{constructor(e,t,n,s=0){super(e,t,n),this.schema=n,this.nestedIndex=s}rollback(){throw new fn}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),p.raw(t.join(" "))}setTransaction(e){return this.session.execute(p`set transaction ${this.getTransactionConfigSQL(e)}`)}};Vp=m,c(An,Vp,"PgTransaction");var Bp,Ci=class extends Cn{constructor(e,t,n,s,i,o,a){super({sql:t,params:n}),this.client=e,this.queryString=t,this.params=n,this.logger=s,this.fields=i,this._isResponseInArrayMode=o,this.customResultMapper=a}async execute(e={}){return le.startActiveSpan("drizzle.execute",async t=>{let n=So(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(n)}),this.logger.logQuery(this.queryString,n);let{fields:s,queryString:i,client:o,joinsNotNullableMap:a,customResultMapper:l}=this;if(!s&&!l)return le.startActiveSpan("drizzle.driver.execute",()=>o.unsafe(i,n));let f=await le.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":i,"drizzle.query.params":JSON.stringify(n)}),o.unsafe(i,n).values()));return le.startActiveSpan("drizzle.mapResponse",()=>l?l(f):f.map(u=>za(s,u,a)))})}all(e={}){return le.startActiveSpan("drizzle.execute",async t=>{let n=So(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(n)}),this.logger.logQuery(this.queryString,n),le.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(n)}),this.client.unsafe(this.queryString,n)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}};Bp=m,c(Ci,Bp,"PostgresJsPreparedQuery");var Up,Po=class extends Nn{constructor(t,n,s,i={}){super(n);c(this,"logger");this.client=t,this.schema=s,this.options=i,this.logger=i.logger??new rn}prepareQuery(t,n,s,i,o){return new Ci(this.client,t.sql,t.params,this.logger,n,i,o)}query(t,n){return this.logger.logQuery(t,n),this.client.unsafe(t,n).values()}queryObjects(t,n){return this.client.unsafe(t,n)}transaction(t,n){return this.client.begin(async s=>{let i=new Po(s,this.dialect,this.schema,this.options),o=new Ni(this.dialect,i,this.schema);return n&&await o.setTransaction(n),t(o)})}},$r=Po;Up=m,c($r,Up,"PostgresJsSession");var Kp,$o=class extends An{constructor(e,t,n,s=0){super(e,t,n,s),this.session=t}transaction(e){return this.session.client.savepoint(t=>{let n=new $r(t,this.dialect,this.schema,this.session.options),s=new $o(this.dialect,n,this.schema);return e(s)})}},Ni=$o;Kp=m,c(Ni,Kp,"PostgresJsTransaction");var Zp,Ai=class extends Ut{};Zp=m,c(Ai,Zp,"PostgresJsDatabase");function Ir(r,e={}){let t=l=>l;for(let l of["1184","1082","1083","1114"])r.options.parsers[l]=t,r.options.serializers[l]=t;r.options.serializers[114]=t,r.options.serializers[3802]=t;let n=new bt({casing:e.casing}),s;e.logger===!0?s=new tn:e.logger!==!1&&(s=e.logger);let i;if(e.schema){let l=Kc(e.schema,Gc);i={fullSchema:e.schema,schema:l.tables,tableNamesMap:l.tableNamesMap}}let o=new $r(r,n,i,{logger:s}),a=new Ai(n,o,i);return a.$client=r,a}function Oi(...r){if(typeof r[0]=="string"){let e=pr(r[0]);return Ir(e,r[1])}if(qa(r[0])){let{connection:e,client:t,...n}=r[0];if(t)return Ir(t,n);if(typeof e=="object"&&e.url!==void 0){let{url:i,...o}=e,a=pr(i,o);return Ir(a,n)}let s=pr(e);return Ir(s,n)}return Ir(r[0],r[1])}(r=>{function e(t){return Ir({options:{parsers:{},serializers:{}}},t)}r.mock=e})(Oi||(Oi={}));var Lr=ct(Bo(),1),Zt=ct(El(),1);function Ih(){Zt.PojosMetadataMap.create("Listing",{id:String,title:String,price:Number,purchaseType:String,sellerId:String}),Zt.PojosMetadataMap.create("ListingOutputDto",{id:String,title:String,price:Number,purchaseType:String,sellerId:String}),Zt.PojosMetadataMap.create("ListingInputDto",{title:String,price:Number,purchaseType:String,sellerId:String}),Zt.PojosMetadataMap.create("ListingTable",{id:String,title:String,price:Number,purchaseType:String,sellerId:String})}Ih();var $t=(0,Lr.createMapper)({strategyInitializer:(0,Zt.pojos)()});(0,Lr.createMap)($t,"Listing","ListingOutputDto");(0,Lr.createMap)($t,"ListingInputDto","Listing");(0,Lr.createMap)($t,"ListingTable","Listing");var Pl=Sc("Listings",{title:mn().notNull(),sellerId:dn().notNull(),purchaseType:mn().default("SALE"),id:dn("id").defaultRandom(),price:ic().notNull()});var ji=class{constructor(e,t){this._dbClient=e;this._mapper=t}async create(e){console.log({message:e});let t=await this._dbClient.insert(Pl).values(e).returning();return this._mapper.map(t[0],"ListingTable","Listing")}};var ne;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let o of s)i[o]=o;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(a=>typeof s[s[a]]!="number"),o={};for(let a of i)o[a]=s[a];return r.objectValues(o)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.push(o);return i},r.find=(s,i)=>{for(let o of s)if(i(o))return o},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(ne||(ne={}));var Ko;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Ko||(Ko={}));var k=ne.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_t=r=>{switch(typeof r){case"undefined":return k.undefined;case"string":return k.string;case"number":return isNaN(r)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(r)?k.array:r===null?k.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?k.promise:typeof Map<"u"&&r instanceof Map?k.map:typeof Set<"u"&&r instanceof Set?k.set:typeof Date<"u"&&r instanceof Date?k.date:k.object;default:return k.unknown}},x=ne.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Mh=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),$e=class extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)n._errors.push(t(o));else{let a=n,l=0;for(;l<o.path.length;){let f=o.path[l];l===o.path.length-1?(a[f]=a[f]||{_errors:[]},a[f]._errors.push(t(o))):a[f]=a[f]||{_errors:[]},a=a[f],l++}}};return s(this),n}static assert(e){if(!(e instanceof $e))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ne.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};$e.create=r=>new $e(r);var zr=(r,e)=>{let t;switch(r.code){case x.invalid_type:r.received===k.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case x.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,ne.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:t=`Unrecognized key(s) in object: ${ne.joinValues(r.keys,", ")}`;break;case x.invalid_union:t="Invalid input";break;case x.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ne.joinValues(r.options)}`;break;case x.invalid_enum_value:t=`Invalid enum value. Expected ${ne.joinValues(r.options)}, received '${r.received}'`;break;case x.invalid_arguments:t="Invalid function arguments";break;case x.invalid_return_type:t="Invalid function return type";break;case x.invalid_date:t="Invalid date";break;case x.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:ne.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case x.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case x.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case x.custom:t="Invalid input";break;case x.invalid_intersection_types:t="Intersection results could not be merged";break;case x.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case x.not_finite:t="Number must be finite";break;default:t=e.defaultError,ne.assertNever(r)}return{message:t}},jl=zr;function jh(r){jl=r}function Li(){return jl}var Di=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],o={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let a="",l=n.filter(f=>!!f).slice().reverse();for(let f of l)a=f(o,{data:e,defaultError:a}).message;return{...s,path:i,message:a}},Lh=[];function E(r,e){let t=Li(),n=Di({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===zr?void 0:zr].filter(s=>!!s)});r.common.issues.push(n)}var Oe=class{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return K;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t){let i=await s.key,o=await s.value;n.push({key:i,value:o})}return Oe.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:o}=s;if(i.status==="aborted"||o.status==="aborted")return K;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(n[i.value]=o.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Rr=r=>({status:"dirty",value:r}),qe=r=>({status:"valid",value:r}),Zo=r=>r.status==="aborted",Go=r=>r.status==="dirty",Gt=r=>r.status==="valid",Pn=r=>typeof Promise<"u"&&r instanceof Promise;function Ri(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}function Ll(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t}var R;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(R||(R={}));var En,kn,Ye=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},$l=(r,e)=>{if(Gt(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new $e(r.common.issues);return this._error=t,this._error}}};function J(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,a)=>{var l,f;let{message:u}=r;return o.code==="invalid_enum_value"?{message:u??a.defaultError}:typeof a.data>"u"?{message:(l=u??n)!==null&&l!==void 0?l:a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:(f=u??t)!==null&&f!==void 0?f:a.defaultError}},description:s}}var H=class{get description(){return this._def.description}_getType(e){return _t(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:_t(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Oe,ctx:{common:e.parent.common,data:e.data,parsedType:_t(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Pn(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;let s={common:{issues:[],async:(n=t?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)},i=this._parseSync({data:e,path:s.path,parent:s});return $l(s,i)}"~validate"(e){var t,n;let s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:s});return Gt(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((n=(t=i?.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>Gt(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_t(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(Pn(s)?s:Promise.resolve(s));return $l(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let o=e(s),a=()=>i.addIssue({code:x.custom,...n(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new We({schema:this,typeName:U.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return He.create(this,this._def)}nullable(){return ht.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ge.create(this)}promise(){return jt.create(this,this._def)}or(e){return Yt.create([this,e],this._def)}and(e){return Xt.create(this,e,this._def)}transform(e){return new We({...J(this._def),schema:this,typeName:U.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new sr({...J(this._def),innerType:this,defaultValue:t,typeName:U.ZodDefault})}brand(){return new $n({typeName:U.ZodBranded,type:this,...J(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new ir({...J(this._def),innerType:this,catchValue:t,typeName:U.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return or.create(this,e)}readonly(){return ar.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Dh=/^c[^\s-]{8,}$/i,Rh=/^[0-9a-z]+$/,zh=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Fh=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Qh=/^[a-z0-9_-]{21}$/i,qh=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Vh=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Bh=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Uh="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Uo,Kh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Zh=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Gh=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Wh=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Jh=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Hh=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Dl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yh=new RegExp(`^${Dl}$`);function Rl(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Xh(r){return new RegExp(`^${Rl(r)}$`)}function zl(r){let e=`${Dl}T${Rl(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function eg(r,e){return!!((e==="v4"||!e)&&Kh.test(r)||(e==="v6"||!e)&&Gh.test(r))}function tg(r,e){if(!qh.test(r))return!1;try{let[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function rg(r,e){return!!((e==="v4"||!e)&&Zh.test(r)||(e==="v6"||!e)&&Wh.test(r))}var Ze=class extends H{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){let i=this._getOrReturnCtx(e);return E(i,{code:x.invalid_type,expected:k.string,received:i.parsedType}),K}let n=new Oe,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(s=this._getOrReturnCtx(e,s),o?E(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&E(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")Bh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"email",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Uo||(Uo=new RegExp(Uh,"u")),Uo.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"emoji",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")Fh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"uuid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")Qh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"nanoid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")Dh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cuid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")Rh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cuid2",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")zh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"ulid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),E(s,{validation:"url",code:x.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"regex",code:x.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?zl(i).test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?Yh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Xh(i).test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?Vh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"duration",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?eg(e.data,i.version)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"ip",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?tg(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"jwt",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?rg(e.data,i.version)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cidr",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Jh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"base64",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?Hh.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"base64url",code:x.invalid_string,message:i.message}),n.dirty()):ne.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:x.invalid_string,...R.errToObj(n)})}_addCheck(e){return new Ze({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...R.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...R.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...R.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...R.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...R.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...R.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...R.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...R.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...R.errToObj(t)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new Ze({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ze({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ze({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Ze.create=r=>{var e;return new Ze({checks:[],typeName:U.ZodString,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...J(r)})};function ng(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),o=parseInt(e.toFixed(s).replace(".",""));return i%o/Math.pow(10,s)}var dt=class extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){let i=this._getOrReturnCtx(e);return E(i,{code:x.invalid_type,expected:k.number,received:i.parsedType}),K}let n,s=new Oe;for(let i of this._def.checks)i.kind==="int"?ne.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:x.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?ng(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:x.not_finite,message:i.message}),s.dirty()):ne.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,R.toString(t))}gt(e,t){return this.setLimit("min",e,!1,R.toString(t))}lte(e,t){return this.setLimit("max",e,!0,R.toString(t))}lt(e,t){return this.setLimit("max",e,!1,R.toString(t))}setLimit(e,t,n,s){return new dt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:R.toString(s)}]})}_addCheck(e){return new dt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ne.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};dt.create=r=>new dt({checks:[],typeName:U.ZodNumber,coerce:r?.coerce||!1,...J(r)});var mt=class extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let n,s=new Oe;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):ne.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return E(t,{code:x.invalid_type,expected:k.bigint,received:t.parsedType}),K}gte(e,t){return this.setLimit("min",e,!0,R.toString(t))}gt(e,t){return this.setLimit("min",e,!1,R.toString(t))}lte(e,t){return this.setLimit("max",e,!0,R.toString(t))}lt(e,t){return this.setLimit("max",e,!1,R.toString(t))}setLimit(e,t,n,s){return new mt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:R.toString(s)}]})}_addCheck(e){return new mt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};mt.create=r=>{var e;return new mt({checks:[],typeName:U.ZodBigInt,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...J(r)})};var Wt=class extends H{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==k.boolean){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.boolean,received:n.parsedType}),K}return qe(e.data)}};Wt.create=r=>new Wt({typeName:U.ZodBoolean,coerce:r?.coerce||!1,...J(r)});var Tt=class extends H{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){let i=this._getOrReturnCtx(e);return E(i,{code:x.invalid_type,expected:k.date,received:i.parsedType}),K}if(isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return E(i,{code:x.invalid_date}),K}let n=new Oe,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:x.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:x.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):ne.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Tt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Tt.create=r=>new Tt({checks:[],coerce:r?.coerce||!1,typeName:U.ZodDate,...J(r)});var Fr=class extends H{_parse(e){if(this._getType(e)!==k.symbol){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.symbol,received:n.parsedType}),K}return qe(e.data)}};Fr.create=r=>new Fr({typeName:U.ZodSymbol,...J(r)});var Jt=class extends H{_parse(e){if(this._getType(e)!==k.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.undefined,received:n.parsedType}),K}return qe(e.data)}};Jt.create=r=>new Jt({typeName:U.ZodUndefined,...J(r)});var Ht=class extends H{_parse(e){if(this._getType(e)!==k.null){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.null,received:n.parsedType}),K}return qe(e.data)}};Ht.create=r=>new Ht({typeName:U.ZodNull,...J(r)});var Mt=class extends H{constructor(){super(...arguments),this._any=!0}_parse(e){return qe(e.data)}};Mt.create=r=>new Mt({typeName:U.ZodAny,...J(r)});var St=class extends H{constructor(){super(...arguments),this._unknown=!0}_parse(e){return qe(e.data)}};St.create=r=>new St({typeName:U.ZodUnknown,...J(r)});var it=class extends H{_parse(e){let t=this._getOrReturnCtx(e);return E(t,{code:x.invalid_type,expected:k.never,received:t.parsedType}),K}};it.create=r=>new it({typeName:U.ZodNever,...J(r)});var Qr=class extends H{_parse(e){if(this._getType(e)!==k.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.void,received:n.parsedType}),K}return qe(e.data)}};Qr.create=r=>new Qr({typeName:U.ZodVoid,...J(r)});var Ge=class extends H{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==k.array)return E(t,{code:x.invalid_type,expected:k.array,received:t.parsedType}),K;if(s.exactLength!==null){let o=t.data.length>s.exactLength.value,a=t.data.length<s.exactLength.value;(o||a)&&(E(t,{code:o?x.too_big:x.too_small,minimum:a?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(E(t,{code:x.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(E(t,{code:x.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>s.type._parseAsync(new Ye(t,o,t.path,a)))).then(o=>Oe.mergeArray(n,o));let i=[...t.data].map((o,a)=>s.type._parseSync(new Ye(t,o,t.path,a)));return Oe.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new Ge({...this._def,minLength:{value:e,message:R.toString(t)}})}max(e,t){return new Ge({...this._def,maxLength:{value:e,message:R.toString(t)}})}length(e,t){return new Ge({...this._def,exactLength:{value:e,message:R.toString(t)}})}nonempty(e){return this.min(1,e)}};Ge.create=(r,e)=>new Ge({type:r,minLength:null,maxLength:null,exactLength:null,typeName:U.ZodArray,...J(e)});function Dr(r){if(r instanceof be){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=He.create(Dr(n))}return new be({...r._def,shape:()=>e})}else return r instanceof Ge?new Ge({...r._def,type:Dr(r.element)}):r instanceof He?He.create(Dr(r.unwrap())):r instanceof ht?ht.create(Dr(r.unwrap())):r instanceof Xe?Xe.create(r.items.map(e=>Dr(e))):r}var be=class extends H{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=ne.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==k.object){let f=this._getOrReturnCtx(e);return E(f,{code:x.invalid_type,expected:k.object,received:f.parsedType}),K}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof it&&this._def.unknownKeys==="strip"))for(let f in s.data)o.includes(f)||a.push(f);let l=[];for(let f of o){let u=i[f],y=s.data[f];l.push({key:{status:"valid",value:f},value:u._parse(new Ye(s,y,s.path,f)),alwaysSet:f in s.data})}if(this._def.catchall instanceof it){let f=this._def.unknownKeys;if(f==="passthrough")for(let u of a)l.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(f==="strict")a.length>0&&(E(s,{code:x.unrecognized_keys,keys:a}),n.dirty());else if(f!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let f=this._def.catchall;for(let u of a){let y=s.data[u];l.push({key:{status:"valid",value:u},value:f._parse(new Ye(s,y,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let f=[];for(let u of l){let y=await u.key,h=await u.value;f.push({key:y,value:h,alwaysSet:u.alwaysSet})}return f}).then(f=>Oe.mergeObjectSync(n,f)):Oe.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new be({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,o,a;let l=(o=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&o!==void 0?o:n.defaultError;return t.code==="unrecognized_keys"?{message:(a=R.errToObj(e).message)!==null&&a!==void 0?a:l}:{message:l}}}:{}})}strip(){return new be({...this._def,unknownKeys:"strip"})}passthrough(){return new be({...this._def,unknownKeys:"passthrough"})}extend(e){return new be({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new be({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:U.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new be({...this._def,catchall:e})}pick(e){let t={};return ne.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new be({...this._def,shape:()=>t})}omit(e){let t={};return ne.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new be({...this._def,shape:()=>t})}deepPartial(){return Dr(this)}partial(e){let t={};return ne.objectKeys(this.shape).forEach(n=>{let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new be({...this._def,shape:()=>t})}required(e){let t={};return ne.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof He;)i=i._def.innerType;t[n]=i}}),new be({...this._def,shape:()=>t})}keyof(){return Fl(ne.objectKeys(this.shape))}};be.create=(r,e)=>new be({shape:()=>r,unknownKeys:"strip",catchall:it.create(),typeName:U.ZodObject,...J(e)});be.strictCreate=(r,e)=>new be({shape:()=>r,unknownKeys:"strict",catchall:it.create(),typeName:U.ZodObject,...J(e)});be.lazycreate=(r,e)=>new be({shape:r,unknownKeys:"strip",catchall:it.create(),typeName:U.ZodObject,...J(e)});var Yt=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(a=>new $e(a.ctx.common.issues));return E(t,{code:x.invalid_union,unionErrors:o}),K}if(t.common.async)return Promise.all(n.map(async i=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(s);{let i,o=[];for(let l of n){let f={...t,common:{...t.common,issues:[]},parent:null},u=l._parseSync({data:t.data,path:t.path,parent:f});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:f}),f.common.issues.length&&o.push(f.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let a=o.map(l=>new $e(l));return E(t,{code:x.invalid_union,unionErrors:a}),K}}get options(){return this._def.options}};Yt.create=(r,e)=>new Yt({options:r,typeName:U.ZodUnion,...J(e)});var vt=r=>r instanceof tr?vt(r.schema):r instanceof We?vt(r.innerType()):r instanceof rr?[r.value]:r instanceof pt?r.options:r instanceof nr?ne.objectValues(r.enum):r instanceof sr?vt(r._def.innerType):r instanceof Jt?[void 0]:r instanceof Ht?[null]:r instanceof He?[void 0,...vt(r.unwrap())]:r instanceof ht?[null,...vt(r.unwrap())]:r instanceof $n||r instanceof ar?vt(r.unwrap()):r instanceof ir?vt(r._def.innerType):[],qr=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.object)return E(t,{code:x.invalid_type,expected:k.object,received:t.parsedType}),K;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(E(t,{code:x.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),K)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let o=vt(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(s.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);s.set(a,i)}}return new qr({typeName:U.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...J(n)})}};function Wo(r,e){let t=_t(r),n=_t(e);if(r===e)return{valid:!0,data:r};if(t===k.object&&n===k.object){let s=ne.objectKeys(e),i=ne.objectKeys(r).filter(a=>s.indexOf(a)!==-1),o={...r,...e};for(let a of i){let l=Wo(r[a],e[a]);if(!l.valid)return{valid:!1};o[a]=l.data}return{valid:!0,data:o}}else if(t===k.array&&n===k.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let o=r[i],a=e[i],l=Wo(o,a);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===k.date&&n===k.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Xt=class extends H{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,o)=>{if(Zo(i)||Zo(o))return K;let a=Wo(i.value,o.value);return a.valid?((Go(i)||Go(o))&&t.dirty(),{status:t.value,value:a.data}):(E(n,{code:x.invalid_intersection_types}),K)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,o])=>s(i,o)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Xt.create=(r,e,t)=>new Xt({left:r,right:e,typeName:U.ZodIntersection,...J(t)});var Xe=class extends H{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.array)return E(n,{code:x.invalid_type,expected:k.array,received:n.parsedType}),K;if(n.data.length<this._def.items.length)return E(n,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),K;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((o,a)=>{let l=this._def.items[a]||this._def.rest;return l?l._parse(new Ye(n,o,n.path,a)):null}).filter(o=>!!o);return n.common.async?Promise.all(i).then(o=>Oe.mergeArray(t,o)):Oe.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Xe({...this._def,rest:e})}};Xe.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Xe({items:r,typeName:U.ZodTuple,rest:null,...J(e)})};var er=class extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.object)return E(n,{code:x.invalid_type,expected:k.object,received:n.parsedType}),K;let s=[],i=this._def.keyType,o=this._def.valueType;for(let a in n.data)s.push({key:i._parse(new Ye(n,a,n.path,a)),value:o._parse(new Ye(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?Oe.mergeObjectAsync(t,s):Oe.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof H?new er({keyType:e,valueType:t,typeName:U.ZodRecord,...J(n)}):new er({keyType:Ze.create(),valueType:e,typeName:U.ZodRecord,...J(t)})}},Vr=class extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.map)return E(n,{code:x.invalid_type,expected:k.map,received:n.parsedType}),K;let s=this._def.keyType,i=this._def.valueType,o=[...n.data.entries()].map(([a,l],f)=>({key:s._parse(new Ye(n,a,n.path,[f,"key"])),value:i._parse(new Ye(n,l,n.path,[f,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let l of o){let f=await l.key,u=await l.value;if(f.status==="aborted"||u.status==="aborted")return K;(f.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(f.value,u.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let l of o){let f=l.key,u=l.value;if(f.status==="aborted"||u.status==="aborted")return K;(f.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(f.value,u.value)}return{status:t.value,value:a}}}};Vr.create=(r,e,t)=>new Vr({valueType:e,keyType:r,typeName:U.ZodMap,...J(t)});var xt=class extends H{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.set)return E(n,{code:x.invalid_type,expected:k.set,received:n.parsedType}),K;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(E(n,{code:x.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(E(n,{code:x.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function o(l){let f=new Set;for(let u of l){if(u.status==="aborted")return K;u.status==="dirty"&&t.dirty(),f.add(u.value)}return{status:t.value,value:f}}let a=[...n.data.values()].map((l,f)=>i._parse(new Ye(n,l,n.path,f)));return n.common.async?Promise.all(a).then(l=>o(l)):o(a)}min(e,t){return new xt({...this._def,minSize:{value:e,message:R.toString(t)}})}max(e,t){return new xt({...this._def,maxSize:{value:e,message:R.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};xt.create=(r,e)=>new xt({valueType:r,minSize:null,maxSize:null,typeName:U.ZodSet,...J(e)});var It=class extends H{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.function)return E(t,{code:x.invalid_type,expected:k.function,received:t.parsedType}),K;function n(a,l){return Di({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Li(),zr].filter(f=>!!f),issueData:{code:x.invalid_arguments,argumentsError:l}})}function s(a,l){return Di({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Li(),zr].filter(f=>!!f),issueData:{code:x.invalid_return_type,returnTypeError:l}})}let i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof jt){let a=this;return qe(async function(...l){let f=new $e([]),u=await a._def.args.parseAsync(l,i).catch(v=>{throw f.addIssue(n(l,v)),f}),y=await Reflect.apply(o,this,u);return await a._def.returns._def.type.parseAsync(y,i).catch(v=>{throw f.addIssue(s(y,v)),f})})}else{let a=this;return qe(function(...l){let f=a._def.args.safeParse(l,i);if(!f.success)throw new $e([n(l,f.error)]);let u=Reflect.apply(o,this,f.data),y=a._def.returns.safeParse(u,i);if(!y.success)throw new $e([s(u,y.error)]);return y.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new It({...this._def,args:Xe.create(e).rest(St.create())})}returns(e){return new It({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new It({args:e||Xe.create([]).rest(St.create()),returns:t||St.create(),typeName:U.ZodFunction,...J(n)})}},tr=class extends H{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};tr.create=(r,e)=>new tr({getter:r,typeName:U.ZodLazy,...J(e)});var rr=class extends H{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return E(t,{received:t.data,code:x.invalid_literal,expected:this._def.value}),K}return{status:"valid",value:e.data}}get value(){return this._def.value}};rr.create=(r,e)=>new rr({value:r,typeName:U.ZodLiteral,...J(e)});function Fl(r,e){return new pt({values:r,typeName:U.ZodEnum,...J(e)})}var pt=class extends H{constructor(){super(...arguments),En.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return E(t,{expected:ne.joinValues(n),received:t.parsedType,code:x.invalid_type}),K}if(Ri(this,En,"f")||Ll(this,En,new Set(this._def.values),"f"),!Ri(this,En,"f").has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return E(t,{received:t.data,code:x.invalid_enum_value,options:n}),K}return qe(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return pt.create(e,{...this._def,...t})}exclude(e,t=this._def){return pt.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};En=new WeakMap;pt.create=Fl;var nr=class extends H{constructor(){super(...arguments),kn.set(this,void 0)}_parse(e){let t=ne.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==k.string&&n.parsedType!==k.number){let s=ne.objectValues(t);return E(n,{expected:ne.joinValues(s),received:n.parsedType,code:x.invalid_type}),K}if(Ri(this,kn,"f")||Ll(this,kn,new Set(ne.getValidEnumValues(this._def.values)),"f"),!Ri(this,kn,"f").has(e.data)){let s=ne.objectValues(t);return E(n,{received:n.data,code:x.invalid_enum_value,options:s}),K}return qe(e.data)}get enum(){return this._def.values}};kn=new WeakMap;nr.create=(r,e)=>new nr({values:r,typeName:U.ZodNativeEnum,...J(e)});var jt=class extends H{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.promise&&t.common.async===!1)return E(t,{code:x.invalid_type,expected:k.promise,received:t.parsedType}),K;let n=t.parsedType===k.promise?t.data:Promise.resolve(t.data);return qe(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};jt.create=(r,e)=>new jt({type:r,typeName:U.ZodPromise,...J(e)});var We=class extends H{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===U.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:o=>{E(n,o),o.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let o=s.transform(n.data,i);if(n.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return K;let l=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return l.status==="aborted"?K:l.status==="dirty"||t.value==="dirty"?Rr(l.value):l});{if(t.value==="aborted")return K;let a=this._def.schema._parseSync({data:o,path:n.path,parent:n});return a.status==="aborted"?K:a.status==="dirty"||t.value==="dirty"?Rr(a.value):a}}if(s.type==="refinement"){let o=a=>{let l=s.refinement(a,i);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?K:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?K:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(s.type==="transform")if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Gt(o))return o;let a=s.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>Gt(o)?Promise.resolve(s.transform(o.value,i)).then(a=>({status:t.value,value:a})):o);ne.assertNever(s)}};We.create=(r,e,t)=>new We({schema:r,typeName:U.ZodEffects,effect:e,...J(t)});We.createWithPreprocess=(r,e,t)=>new We({schema:e,effect:{type:"preprocess",transform:r},typeName:U.ZodEffects,...J(t)});var He=class extends H{_parse(e){return this._getType(e)===k.undefined?qe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};He.create=(r,e)=>new He({innerType:r,typeName:U.ZodOptional,...J(e)});var ht=class extends H{_parse(e){return this._getType(e)===k.null?qe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ht.create=(r,e)=>new ht({innerType:r,typeName:U.ZodNullable,...J(e)});var sr=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===k.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};sr.create=(r,e)=>new sr({innerType:r,typeName:U.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...J(e)});var ir=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Pn(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new $e(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new $e(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};ir.create=(r,e)=>new ir({innerType:r,typeName:U.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...J(e)});var Br=class extends H{_parse(e){if(this._getType(e)!==k.nan){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.nan,received:n.parsedType}),K}return{status:"valid",value:e.data}}};Br.create=r=>new Br({typeName:U.ZodNaN,...J(r)});var sg=Symbol("zod_brand"),$n=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},or=class extends H{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?K:i.status==="dirty"?(t.dirty(),Rr(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?K:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new or({in:e,out:t,typeName:U.ZodPipeline})}},ar=class extends H{_parse(e){let t=this._def.innerType._parse(e),n=s=>(Gt(s)&&(s.value=Object.freeze(s.value)),s);return Pn(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}};ar.create=(r,e)=>new ar({innerType:r,typeName:U.ZodReadonly,...J(e)});function Il(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Ql(r,e={},t){return r?Mt.create().superRefine((n,s)=>{var i,o;let a=r(n);if(a instanceof Promise)return a.then(l=>{var f,u;if(!l){let y=Il(e,n),h=(u=(f=y.fatal)!==null&&f!==void 0?f:t)!==null&&u!==void 0?u:!0;s.addIssue({code:"custom",...y,fatal:h})}});if(!a){let l=Il(e,n),f=(o=(i=l.fatal)!==null&&i!==void 0?i:t)!==null&&o!==void 0?o:!0;s.addIssue({code:"custom",...l,fatal:f})}}):Mt.create()}var ig={object:be.lazycreate},U;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(U||(U={}));var og=(r,e={message:`Input not instance of ${r.name}`})=>Ql(t=>t instanceof r,e),ql=Ze.create,Vl=dt.create,ag=Br.create,cg=mt.create,Bl=Wt.create,lg=Tt.create,ug=Fr.create,fg=Jt.create,dg=Ht.create,mg=Mt.create,pg=St.create,hg=it.create,gg=Qr.create,yg=Ge.create,bg=be.create,wg=be.strictCreate,vg=Yt.create,_g=qr.create,Sg=Xt.create,Tg=Xe.create,xg=er.create,Cg=Vr.create,Ng=xt.create,Ag=It.create,Og=tr.create,Eg=rr.create,kg=pt.create,Pg=nr.create,$g=jt.create,Ml=We.create,Ig=He.create,Mg=ht.create,jg=We.createWithPreprocess,Lg=or.create,Dg=()=>ql().optional(),Rg=()=>Vl().optional(),zg=()=>Bl().optional(),Fg={string:r=>Ze.create({...r,coerce:!0}),number:r=>dt.create({...r,coerce:!0}),boolean:r=>Wt.create({...r,coerce:!0}),bigint:r=>mt.create({...r,coerce:!0}),date:r=>Tt.create({...r,coerce:!0})},Qg=K,Ur=Object.freeze({__proto__:null,defaultErrorMap:zr,setErrorMap:jh,getErrorMap:Li,makeIssue:Di,EMPTY_PATH:Lh,addIssueToContext:E,ParseStatus:Oe,INVALID:K,DIRTY:Rr,OK:qe,isAborted:Zo,isDirty:Go,isValid:Gt,isAsync:Pn,get util(){return ne},get objectUtil(){return Ko},ZodParsedType:k,getParsedType:_t,ZodType:H,datetimeRegex:zl,ZodString:Ze,ZodNumber:dt,ZodBigInt:mt,ZodBoolean:Wt,ZodDate:Tt,ZodSymbol:Fr,ZodUndefined:Jt,ZodNull:Ht,ZodAny:Mt,ZodUnknown:St,ZodNever:it,ZodVoid:Qr,ZodArray:Ge,ZodObject:be,ZodUnion:Yt,ZodDiscriminatedUnion:qr,ZodIntersection:Xt,ZodTuple:Xe,ZodRecord:er,ZodMap:Vr,ZodSet:xt,ZodFunction:It,ZodLazy:tr,ZodLiteral:rr,ZodEnum:pt,ZodNativeEnum:nr,ZodPromise:jt,ZodEffects:We,ZodTransformer:We,ZodOptional:He,ZodNullable:ht,ZodDefault:sr,ZodCatch:ir,ZodNaN:Br,BRAND:sg,ZodBranded:$n,ZodPipeline:or,ZodReadonly:ar,custom:Ql,Schema:H,ZodSchema:H,late:ig,get ZodFirstPartyTypeKind(){return U},coerce:Fg,any:mg,array:yg,bigint:cg,boolean:Bl,date:lg,discriminatedUnion:_g,effect:Ml,enum:kg,function:Ag,instanceof:og,intersection:Sg,lazy:Og,literal:Eg,map:Cg,nan:ag,nativeEnum:Pg,never:hg,null:dg,nullable:Mg,number:Vl,object:bg,oboolean:zg,onumber:Rg,optional:Ig,ostring:Dg,pipeline:Lg,preprocess:jg,promise:$g,record:xg,set:Ng,strictObject:wg,string:ql,symbol:ug,transformer:Ml,tuple:Tg,undefined:fg,union:vg,unknown:pg,void:gg,NEVER:Qg,ZodIssueCode:x,quotelessJson:Mh,ZodError:$e});var Ul=Ur.object({title:Ur.string(),sellerId:Ur.string().uuid(),purchaseType:Ur.enum(["BUY","RENT"]).optional(),price:Ur.number()});var Wl=ct(Gl(),1);var Jl=async(r,e)=>{try{let t=JSON.parse(r.body??"{}"),n=Ul.parse(t),s=$t.map(n,"ListingInputDto","Listing"),i=await e.create(s),o=$t.map(i,"Listing","ListingOutputDto");return{statusCode:201,body:JSON.stringify(o)}}catch(t){throw t instanceof $e?new Wl.BadRequestError(t.message,{context:t.errors}):t}};function Hl(){let r=pr(process.env.DATABASE_URL,{prepare:!1}),e=Oi({client:r,casing:"snake_case"});return{service:new ji(e,$t),routes:[{method:"POST",path:"/listings",handler:Jl}]}}var{routes:Jg,service:Hg}=Hl(),Yg=async r=>{console.log("Incoming request:",r.httpMethod,r.path);let e=Jg.find(t=>t.method===r.httpMethod&&t.path===r.path);if(!e)return{statusCode:404,body:JSON.stringify({error:"Route not found"})};try{return await e.handler(r,Hg)}catch(t){return console.error("Error handling request:",t),{statusCode:t.statusCode??500,body:t?.errors?JSON.stringify(t.errors):"Internal Server Error"}}};0&&(module.exports={lambdaHandler});
//# sourceMappingURL=app.js.map

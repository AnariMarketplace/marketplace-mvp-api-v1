"use strict";var Hu=Object.create;var Vr=Object.defineProperty;var Yu=Object.getOwnPropertyDescriptor;var Xu=Object.getOwnPropertyNames;var ef=Object.getPrototypeOf,tf=Object.prototype.hasOwnProperty;var rf=(r,e,t)=>e in r?Vr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Xi=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),nf=(r,e)=>{for(var t in e)Vr(r,t,{get:e[t],enumerable:!0})},va=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Xu(e))!tf.call(r,s)&&s!==t&&Vr(r,s,{get:()=>e[s],enumerable:!(n=Yu(e,s))||n.enumerable});return r};var at=(r,e,t)=>(t=r!=null?Hu(ef(r)):{},va(e||!r||!r.__esModule?Vr(t,"default",{value:r,enumerable:!0}):t,r)),sf=r=>va(Vr({},"__esModule",{value:!0}),r);var c=(r,e,t)=>(rf(r,typeof e!="symbol"?e+"":e,t),t);var sa=Xi(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});function ml(r){return"source"in r&&"destination"in r?[r.source,r.destination]:[r,r]}var hl=Symbol.for("__strategy__"),pl=Symbol.for("__mappings__"),gl=Symbol.for("__metadata_map__"),yl=Symbol.for("__metadata_object_map__"),bl=Symbol.for("__error_handler__"),wl=Symbol.for("__naming_conventions__"),vl=Symbol.for("__recursive_depth__"),_l=Symbol.for("__recursive_count__"),Sl=Symbol.for("__profile_configuration_context__"),dp=Symbol.for("nodejs.util.inspect.custom");function Xo(r){return r[bl]}function Tl(r){return r[pl]}function Bi(r){return r[gl]}function xl(r){return r[yl]}function mp(r){let e=r[wl];if(!!e)return ml(e)}function Nl(r){return r[vl]}function hp(r){return r[_l]}function ea(r){return r[hl]}function Zo(r){return r[Sl]}function pp(r,e,t,n,s,i){let o=Object.keys(e).reduce((f,u)=>{let y=u in r,p=t.some(T=>T===u),v=Object.getOwnPropertyDescriptor(e,u)?.writable===!0;return!p&&!y&&v&&r[u]===void 0&&f.push(u),f},[]),a=ul(n),l=ul(s);if(o.length){let f=`${a} -> ${l}`;i.handle(`
Unmapped properties for ${f}:
-------------------
${o.join(`,
`)}
`)}}function ul(r){let e=r.toString();return r.name&&(e=r.name),e}function xr(r,e=[]){if(!e.length)return;let t,n=e.length;for(t=0;t<n&&r!=null;t++)r=r[e[t]];return t&&t==n?r:void 0}function At(r,e,t,n=!1){let s=typeof e=="string"?Symbol.for(e):e,i=typeof t=="string"?Symbol.for(t):t,o=Tl(r).get(s)?.get(i);if(o==null&&!n){let a=typeof e=="function"&&e.name||String(e),l=typeof t=="function"&&t.name||String(t),f=Xo(r),u=`Mapping is not found for ${a} and ${l}`;throw f.handle(u),new Error(u)}return o}function Tr(r){return Object.getPrototypeOf(r)===Date||r===Date}function ta(r){return Array.isArray(r)?!r.length:typeof r!="object"&&typeof r!="function"?!r:!Object.keys(r).length}function Vi(r,e){return r.length!==e.length?!1:r.every((t,n)=>e[n]===t)}function Bt(r){if(r==null)return!0;let e=Object.getPrototypeOf(r);return e===String||e===Number||e===Boolean||r===String||r===Number||r===Boolean}function ra(r,e,t){let{decomposedPath:n,base:s}=Cl(e);return s===void 0?r:(Al(r,s),t=n.length<=1?t:ra(r[s],n.slice(1),t),Object.assign(r,{[s]:t}))}function yt(r,e,t){let{decomposedPath:n,base:s}=Cl(e);s!==void 0&&(Al(r,s),n.length<=1?r[s]=t:yt(r[s],n.slice(1),t))}function Cl(r){if(r.length<1)return{base:"",decomposedPath:[]};let e=r;return{base:r[0],decomposedPath:e}}function Al(r,e){r.hasOwnProperty(e)||(r[e]={})}function Pl(r,e,t,n,s,i,o,a){let l,f=r[0],u=r[1],y=!(Bt(o)||Bt(a)||Tr(o)||Tr(a));switch(f){case 1:l=u(e);break;case 3:l=u();break;case 4:l=u(e,i,s?{extraArgs:()=>s}:void 0);break;case 5:l=u(e);break;case 2:case 7:case 8:l=u(e,n),y&&l!=null&&(l=Array.isArray(l)?i.mapArray(l,o,a):i.map(l,o,a));break;case 9:l=u(e,s||{});break;case 10:l=Pl(u(e),e,t,n,s,i,o,a);break}return l}function El(r,e){return t=>{e&&(e=ra(e,r,t))}}function Wo(r,e,t,n=!1){return Qi({mapping:r,sourceObject:e,options:t,setMemberFn:El,isMapArray:n})}function Ol(r){return e=>t=>{t!==void 0&&yt(r,e,t)}}function kl(r){return e=>xr(r,e)}function fl(r,e,t,n,s=!1){Qi({sourceObject:e,mapping:r,setMemberFn:Ol(t),getMemberFn:kl(t),options:n,isMapArray:s})}function Qi({mapping:r,sourceObject:e,options:t,setMemberFn:n,getMemberFn:s,isMapArray:i=!1}){let[[o,a],[,l],f,,u,y,,[p,v]=[]]=r,{beforeMap:T,afterMap:w,destinationConstructor:L=y,extraArgs:N}=t??{},q=Xo(u),z=Bi(u),I=L(e,a),D=N?.(r,I),H=[];if(!i){let O=T??p;O&&O(e,I,D)}for(let O=0,F=f.length;O<F;O++){let[Z,[,[S,[W,V=void 0]=[]]],[G,ie]=[]]=f[O],he=!Bt(G)&&!Tr(G)&&!Bt(ie)&&!Tr(ie)&&ie===G;he&&(he=!At(u,ie,G,!0));let pe=ze=>{try{return n(Z,I)(ze())}catch(_){let $=`
Error at "${Z}" on ${a.prototype?.constructor?.name||a.toString()} (${JSON.stringify(I)})
---------------------------------------------------------------------
Original error: ${_}`;throw q.handle($),new Error($)}};if(H.push(Z[0]),W&&!W(e)){pe(()=>V);continue}if(S[0]===6){let ze=z.get(a),_=ze&&ze.find(re=>Vi(re[0],Z))===null,$=S[1](e),ne=S[2];if($==null||$ instanceof Date||Object.prototype.toString.call($).slice(8,-1)==="File"||_||he||ne){pe(()=>$);continue}if(Array.isArray($)){let[re]=$;if(typeof re!="object"||re instanceof Date||Object.prototype.toString.call(re).slice(8,-1)==="File"){pe(()=>$.slice());continue}if(ta(re)){pe(()=>[]);continue}if(Bt(G))continue;pe(()=>$.map(ge=>Wo(At(u,ie,G),ge,{extraArgs:N})));continue}if(typeof $=="object"){let re=At(u,ie,G);if(s){let ge=s(Z);ge!==void 0&&Qi({sourceObject:$,mapping:re,options:{extraArgs:N},setMemberFn:Ol(ge),getMemberFn:kl(ge)});continue}pe(()=>Qi({mapping:re,sourceObject:$,options:{extraArgs:N},setMemberFn:El}));continue}pe(()=>$);continue}pe(()=>Pl(S,e,I,Z,D,u,ie,G))}if(!i){let O=w??v;O&&O(e,I,D)}return pp(I,l,H,o,a,q),I}var Pt=class{static configure(e={}){this.configured||(this.configured=!0,Object.entries(e).forEach(([t,n])=>{n!==void 0&&(this[t]=n)}))}static log(e){console.log.bind(console,this.AUTOMAPPER_PREFIX,e)}static warn(e){console.warn.bind(console,this.AUTOMAPPER_PREFIX,e)}static error(e){console.error.bind(console,this.AUTOMAPPER_PREFIX,e)}static info(e){console.info.bind(console,this.AUTOMAPPER_PREFIX,e)}};Pt.AUTOMAPPER_PREFIX="[AutoMapper]: ";Pt.configured=!1;function gp({strategyInitializer:r,errorHandler:e,namingConventions:t}){let n,s,i,o,a,l,f;function u(y,p,v){if(p&&v)return{destinationIdentifier:p,mapOptions:v};let T=y;if(p&&!v){let w=typeof p;w==="string"||w==="function"?T=p:v=p}return{destinationIdentifier:T,mapOptions:v}}return new Proxy({[dp](){return`
Mapper {} is an empty Object as a Proxy. The following methods are available to use with a Mapper:
- Mapper#map(Array)(Async), Mapper#mutate(Array)(Async)
- createMap()
- addProfile()
- getMapping()
- getMappings()
        `}},{get(y,p,v){return p===hl?(n||(n=r(v)),n):p===Sl?(f||(f=new Set),f):p===pl?(s||(s=new Map),s):p===gl?(i||(i=new Map),i):p===yl?(o||(o=new Map),o):p===bl?(e||(e={handle:Pt.error?Pt.error.bind(Pt):()=>{}}),e):p===wl?t:p===vl?(a||(a=new Map),a):p===_l?(l||(l=new Map),l):p==="dispose"?()=>{s?.clear(),o?.clear(),a?.clear(),l?.clear(),f?.clear()}:p==="map"?(T,w,L,N)=>{if(T==null)return T;let{destinationIdentifier:q,mapOptions:z}=u(w,L,N),I=At(v,w,q);T=n.preMap(T,I);let D=Wo(I,T,z||{});return n.postMap(T,D,I)}:p==="mapAsync"?(T,w,L,N)=>{let q=v.map(T,w,L,N);return new Promise(z=>{setTimeout(z,0,q)})}:p==="mapArray"?(T,w,L,N)=>{if(!T.length)return[];let{destinationIdentifier:q,mapOptions:z}=u(w,L,N),I=At(v,w,q),{beforeMap:D,afterMap:H,extraArgs:O}=z||{};D&&D(T,[]);let F=[];for(let Z=0,S=T.length;Z<S;Z++){let W=T[Z];W=n.preMap(W,I);let V=Wo(I,W,{extraArgs:O},!0);F.push(n.postMap(W,V,I))}return H&&H(T,F),F}:p==="mapArrayAsync"?(T,w,L,N)=>{let q=v.mapArray(T,w,L,N);return new Promise(z=>{setTimeout(z,0,q)})}:p==="mutate"?(T,w,L,N,q)=>{if(T==null)return;let{destinationIdentifier:z,mapOptions:I}=u(L,N,q),D=At(v,L,z);T=n.preMap(T,D),fl(D,T,w,I||{}),n.postMap(T,w,D)}:p==="mutateAsync"?(T,w,L,N,q)=>new Promise(z=>{v.mutate(T,w,L,N,q),setTimeout(z,0)}):p==="mutateArray"?(T,w,L,N,q)=>{if(!T.length)return;let{destinationIdentifier:z,mapOptions:I}=u(L,N,q),D=At(v,L,z),{beforeMap:H,afterMap:O,extraArgs:F}=I||{};H&&H(T,w);for(let Z=0,S=T.length;Z<S;Z++){let W=T[Z];W=n.preMap(W,D),fl(D,W,w[Z]||{},{extraArgs:F},!0),n.postMap(W,w[Z],D)}O&&O(T,w)}:p==="mutateArrayAsync"?(T,w,L,N,q)=>new Promise(z=>{v.mutateArray(T,w,L,N,q),setTimeout(z,0)}):Reflect.get(y,p,v)}})}var na=Symbol("__recursive_data__");function Go(r,e,t){let n=r.get(e);return n?bp(n,t):void 0}function qi(r,e,t,n){if(!r.has(e)){r.set(e,dl(new Map,t,n));return}let s=r.get(e);yp(s,t)||dl(s,t,n)}function dl(r,e,t){let n=r;for(let s of e){let i=n.get(s);i||(i=new Map,n.set(s,i)),n=i}return n.set(na,t),r}function yp(r,e){let t=r;for(let n of e){let s=t.get(n);if(s)t=s;else return!1}return t.has(na)}function bp(r,e){let t=r;for(let n of e)if(t=t.get(n),!t)return;return t.get(na)}function wp(r){let e=r.mapper,t=Bi(e),n=xl(e),s=hp(e),i=Nl(e);function o(a,l,f=!0,u=!1){let y=t.get(a),p={};if(ta(y)||!y)return p;for(let v=0,T=y.length;v<T;v++){let w=y[v][0],L=y[v][1],N=y[v][2];if(y[v][3]&&l===1)continue;let z=L();if(N){yt(p,w,[]);continue}if(Bt(z)||z===null){yt(p,w,void 0);continue}if(Tr(z)){yt(p,w,new Date);continue}let I=Go(i,a,w),D=Go(s,a,w)||0;if(I===0){yt(p,w,{});continue}if(I===D){(f||!u)&&qi(s,a,w,0),yt(p,w,{});continue}qi(s,a,w,D+1);let O=n.get(z)?.[l]||o(z,l,!1,z===a);yt(p,w,O)}return(f||!u)&&s.get(a)?.clear(),p}return o}var vp={applyMetadata:wp,preMap(r){return r},postMap(r,e){return e}};function _p(r,e=!1){return e?r!==void 0:r!=null}function $l(r,e,t){if(!_p(t))return;let n=Bi(r);if(!n.has(e))for(let[s,{isGetterOnly:i,type:o,depth:a,isArray:l}]of t)n.set(e,[...n.get(e)||[],[[s],o,l,i]]),a!=null&&qi(Nl(r),e,[s],a)}function Sp(r){return[6,e=>xr(e,r)]}function Il(r,[e,t]){let n=r.map(s=>s.split(t.splittingExpression).filter(Boolean)).filter(s=>s.length>0);return n.length?n.map(s=>e.transformPropertyName(s)):r}function Ml(r,e,t){let[n]=t,s=[].concat(...e.map(p=>p.split(n.splittingExpression).filter(Boolean))),[i,...o]=s.slice(0,s.length-1),a=i,l=0,f=Fi(r,a);if(!f){for(let p=0,v=o.length;p<v;p++)if(a=n.transformPropertyName([a,o[p]]),Fi(r,a)){l=p+1,f=!0;break}}if(!f)return e;let u=s.slice(l+1,s.length+1),y=n.transformPropertyName(u);return u.length>1&&!Fi(r[a],y)&&Fi(r[a],n.transformPropertyName([u[0]]))?[a,...Ml(r[a],Il([y],t),t)]:[a,n.transformPropertyName(s.slice(l+1,s.length+1))]}function Fi(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function jl(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function Tp(r){let e=[];for(let t=0,n=r.length;t<n;t++){let s=r[t];e.some(i=>jl(i,s))||e.push(s)}return e}var xp=["constructor","__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","toString","valueOf","__proto__","toLocaleString"];function Ll(r,e=[],t=[]){let n=t,s=!1,i=Array.from(new Set([...Object.getOwnPropertyNames(r)].filter(o=>!xp.includes(o))));for(let o=0,a=i.length;o<a;o++){let l=i[o],f=[...e,l],u=r[l];if(typeof u!="function"&&(n.push(f),typeof u=="object")){let y=Array.isArray(u)?u:[u];for(let p of y){let v=Ll(p,f);v&&(s=!0,n.push(...v))}}}return s?Tp(n):n}function Dl(r,e,t,n=[]){let s=ea(r),i=s.applyMetadata.bind(s),o=s.destinationConstructor.bind(s),a=xl(r),l=a.get(e),f=a.get(t),u=f?.[1]||i(t,1);f?f[1]=u:a.set(t,[void 0,u]);let y=l?.[0]||i(e,0);l?l[0]=y:a.set(e,[y]);let p=[[e,t],[y,u],[],[],r,o];p[8]=mp(r);for(let D=0,H=n.length;D<H;D++)n[D](p);let v=Ll(u),T=p[2],w=p[3],L=w.length>0,N=p[8],{processSourcePath:q,getMetadataAtMember:z,getNestedMappingPair:I}=Rl(r,e,t);for(let D=0,H=v.length;D<H;D++){let O=v[D];if(L&&w.some(G=>Vi(G[0],O)))continue;let F=q(y,N,O);if(!(F[0]in y))continue;let Z=z(O,"destination"),S=z(F,"source");if(!S&&!Z)continue;let W=I(S,Z),V=[Sp(F)];if(W){let G,ie=S[2],he=Z[2],pe=p[6];if(pe){let[ze,_]=pe.get(W[1])||[],[$,ne]=(ie?_?.get(W[0]):ze?.get(W[0]))||[];G=he?ne:$}if(G){let ze=V[0][1];V[0][1]=_=>G(ze(_)),V[0][2]=!0}}T.push([O,[O,V],W])}for(let D of w)T.push(D);return p}function Rl(r,e,t){let n=Bi(r),s=n.get(t)||[],i=n.get(e)||[];return{getMetadataAtMember:(o,a)=>(a==="source"?i:s).find(l=>Vi(l[0],o)),processSourcePath:(o,a,l)=>{let f=l;return a&&(f=Ml(o,Il(l,a),a)),f},getNestedMappingPair:(o,a)=>{if(o&&a)return[a[1](),o[1]()]}}}function Np(r,e,...t){let n=typeof e=="string"?Symbol.for(e):e,s=n,[i,...o]=t||[];i&&(typeof i=="string"?s=Symbol.for(i):typeof i=="function"&&i.prototype!==void 0?s=i:(o||[]).push(i));let a=Tl(r),l=a.get(n)?.get(s);return l?(Xo(r).handle(`Mapping for source ${String(e)} and destination ${String(i)} already exists`),l):(ea(r).retrieveMetadata(n,s).forEach((y,p)=>{$l(r,p,y)}),l=Dl(r,n,s,(o||[]).concat(...Zo(r).values()).filter(y=>y!=null)),a.has(n)?a.get(n).set(s,l):a.set(n,new Map([[s,l]])),l)}function Cp(r,e,...t){t.forEach(n=>{Zo(r).add(n)}),e.apply({profileName:e.name},[r]),Zo(r).clear()}var zl=()=>{},Ap=Fl(zl);function Pp(r){let e=r(Ap);if(typeof e!="function")return null;let t=e();return t.length===0||t.some(n=>typeof n!="string")?null:t}function Ep(r){let e=Pp(r);return e||[]}function Fl(r,e=[]){let t={get(n,s){let i=e.slice();return i.push(s),Fl(zl,i)},apply(){return e}};return new Proxy(r,t)}function Ql(r,...e){let[t,n]=e,s=Ep(r);n==null&&(n=t,t=void 0);let i=[s,[n,t]];return o=>{let[a,l]=o[0],f=o[4],u=o[8],[y]=o[1],{getNestedMappingPair:p,getMetadataAtMember:v,processSourcePath:T}=Rl(f,a,l),w=T(y,u,s);if(!(w[0]in y)){o[3].push([s,i,void 0]);return}let L=v(s,"destination"),N=v(w,"source"),q=p(N,L);o[3].push([s,i,q])}}function Op(r,e){let t=Array.isArray(r)?r:void 0;return n=>{if(t==null){let[,i]=n[0],o=n[4],a=ea(o),l=typeof r=="string"?Symbol.for(r):r;a.retrieveMetadata(l).forEach((u,y)=>{$l(o,y,u)}),t=Dl(o,l,i)}let s=t[2];for(let i=0,o=s.length;i<o;i++){let a=s[i];if(n[2].some(f=>Vi(f[0],a[0])))continue;let l=a[1][1];l[0][1]=f=>xr(e(f),a[0]),n[2].push([a[0],[a[0],l],a[2]])}}}function kp(r){return"convert"in r?r.convert.bind(r):r}function $p(r,e,t){return n=>{let s=Array.isArray(r),i=Array.isArray(e),o=s?r[0]:r,a=i?e[0]:e,l=kp(t),f=n[6]||(n[6]=new Map),u,[y,p]=f.get(o)||[];if(y||p){u=s?p:y;let[v,T]=u.get(a)||[];u.set(a,i?[v,l]:[l,T]);return}u=new Map([[a,i?[void 0,l]:[l,void 0]]]),f.set(o,s?[new Map,u]:[u,new Map])}}var Ip=r=>e=>{e[5]=r};function Mp(r){return e=>{e[7]==null&&(e[7]=[]),e[7][0]=r}}function jp(r){return e=>{e[7]==null&&(e[7]=[]),e[7][1]=r}}function Lp(r,e){return t=>{let n;if(Array.isArray(r))n=r;else{let i=t[4];n=At(i,r,e)}let s=n[2];for(let i=0,o=s.length;i<o;i++){let[a,l,f]=s[i];t[3].find(([y])=>jl(y,a))||t[3].push([a,l,f])}}}var Dp=r=>e=>{e[8]=ml(r)};function ql(r){return"resolve"in r}function Bl(r){return ql(r)?[1,r.resolve.bind(r)]:[1,r]}function Rp(r){return Ql(e=>e[r],Bl(e=>e[r]))}function zp(r,e,t){return[4,(n,s,i)=>{let o=t(n);return Array.isArray(o)?s.mapArray(o,e,r,i):s.map(o,e,r,i)}]}function Fp(r,e){return[5,t=>r.convert(e(t))]}function Qp(){return[0]}function qp(r){return[7,(e,t)=>{let n=xr(e,t);return n===null?r:n}]}function Bp(r,e){return[r,e]}function Vp(r,e){return[2,(t,n)=>r(t)?xr(t,n):e]}function Up(r){return[3,()=>r]}function Kp(r){return ql(r)?[9,r.resolve.bind(r)]:[9,r]}function Zp(r){return[10,r]}function Wp(r){return[8,(e,t)=>{let n=xr(e,t);return n===void 0?r:n}]}var Jo=class{constructor(){this.separatorCharacter="",this.splittingExpression=/(^[a-z]+(?=$|[A-Z][a-z0-9]+)|[A-Z]?[a-z0-9]+)/}transformPropertyName(e){let t="";for(let n=0,s=e.length;n<s;n++)n===0?t+=e[n].charAt(0).toLowerCase():t+=e[n].charAt(0).toUpperCase(),t+=e[n].substring(1);return t}},Ho=class{constructor(){this.separatorCharacter="",this.splittingExpression=/(^[A-Z]+(?=$|[A-Z][a-z0-9]+)|[A-Z]?[a-z0-9]+)/}transformPropertyName(e){let t="";for(let n=0,s=e.length;n<s;n++)t+=e[n].charAt(0).toUpperCase()+e[n].substring(1);return t}},Yo=class{constructor(){this.separatorCharacter="_",this.splittingExpression=/_/}transformPropertyName(e){return e.length<=1?e[0].toLowerCase()||"":e.map(n=>n.toLowerCase()).join(this.separatorCharacter)}};ee.AutoMapperLogger=Pt;ee.CamelCaseNamingConvention=Jo;ee.PascalCaseNamingConvention=Ho;ee.SnakeCaseNamingConvention=Yo;ee.addProfile=Cp;ee.afterMap=jp;ee.autoMap=Rp;ee.beforeMap=Mp;ee.condition=Vp;ee.constructUsing=Ip;ee.convertUsing=Fp;ee.createMap=Np;ee.createMapper=gp;ee.defaultStrategyInitializerOptions=vp;ee.extend=Lp;ee.forMember=Ql;ee.forSelf=Op;ee.fromValue=Up;ee.getRecursiveValue=Go;ee.ignore=Qp;ee.isDateConstructor=Tr;ee.isEmpty=ta;ee.isPrimitiveConstructor=Bt;ee.mapDefer=Zp;ee.mapFrom=Bl;ee.mapWith=zp;ee.mapWithArguments=Kp;ee.namingConventions=Dp;ee.nullSubstitution=qp;ee.preCondition=Bp;ee.set=ra;ee.setMutate=yt;ee.setRecursiveValue=qi;ee.typeConverter=$p;ee.undefinedSubstitution=Wp});var Vl=Xi(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});var Gp=sa(),Nn=class{static reset(){this.metadataStorage=new Map}static create(e,t={}){let n=typeof e=="string"?Symbol.for(e):e,s=Object.entries(t);if(!!s.length)for(let i=0,o=s.length;i<o;i++){let[a,l]=s[i],f=this.normalizePojoMetadata(l);this.metadataStorage.has(n)||this.metadataStorage.set(n,[]),this.metadataStorage.get(n)?.push([a,f])}}static retrieve(e){let t=this.metadataStorage.get(e);return t?t.map(([n,{type:s,depth:i}])=>{let o=s(),a=Array.isArray(o);return[n,{type:a?()=>o[0]:()=>o,isArray:a,depth:i}]}):[]}static normalizePojoMetadata(e){if(typeof e=="string"||typeof e=="symbol"||typeof e=="function"||Array.isArray(e))return{type:()=>this.toSymbol(e),depth:1};let t=e;return t.type=this.toSymbol(t.type),{type:()=>t.type,depth:t.depth}}static toSymbol(e){return typeof e=="string"?Symbol.for(e):Array.isArray(e)&&typeof e[0]=="string"?Symbol.for(e[0]):e}};Nn.metadataStorage=new Map;function Jp(r={}){let{destinationConstructor:e=()=>({}),applyMetadata:t,postMap:n,preMap:s}={...Gp.defaultStrategyInitializerOptions,...r};return i=>({destinationConstructor:e,mapper:i,get applyMetadata(){return t(this)},retrieveMetadata(...o){let a=new Map;for(let l=0,f=o.length;l<f;l++){let u=o[l];a.set(u,Nn.retrieve(u))}return a},preMap:s,postMap:n})}Ui.PojosMetadataMap=Nn;Ui.pojos=Jp});var Zl=Xi((IT,Kl)=>{"use strict";var ia=Object.defineProperty,eg=Object.getOwnPropertyDescriptor,tg=Object.getOwnPropertyNames,rg=Object.prototype.hasOwnProperty,ng=(r,e)=>{for(var t in e)ia(r,t,{get:e[t],enumerable:!0})},sg=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of tg(e))!rg.call(r,s)&&s!==t&&ia(r,s,{get:()=>e[s],enumerable:!(n=eg(e,s))||n.enumerable});return r},ig=r=>sg(ia({},"__esModule",{value:!0}),r),Ul={};ng(Ul,{BadRequestError:()=>ag});Kl.exports=ig(Ul);var og=class extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}},ag=class extends og{constructor(e,t={}){super(e);c(this,"statusCode",400);c(this,"logging",!1);c(this,"errors");this.errors=[{message:e,context:t}]}}});var Mg={};nf(Mg,{lambdaHandler:()=>Ig});module.exports=sf(Mg);var za=at(require("os"),1),Fa=at(require("fs"),1);var zn=new Map,eo=new Map,to=Symbol("OriginError"),Jt={},Ue=class extends Promise{constructor(e,t,n,s,i={}){let o,a;super((l,f)=>{o=l,a=f}),this.tagged=Array.isArray(e.raw),this.strings=e,this.args=t,this.handler=n,this.canceller=s,this.options=i,this.state=null,this.statement=null,this.resolve=l=>(this.active=!1,o(l)),this.reject=l=>(this.active=!1,a(l)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[to]=this.handler.debug?new Error:this.tagged&&of(this.strings)}get origin(){return(this.handler.debug?this[to].stack:this.tagged&&eo.has(this.strings)?eo.get(this.strings):eo.set(this.strings,this[to].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(e=1,t){if(this.options.simple=!1,typeof e=="function"&&(t=e,e=1),this.cursorRows=e,typeof t=="function")return this.cursorFn=t,this;let n;return{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};n&&n();let s=new Promise((i,o)=>{this.cursorFn=a=>(i({value:a,done:!1}),new Promise(l=>n=l)),this.resolve=()=>(this.active=!1,i({done:!0})),this.reject=a=>(this.active=!1,o(a))});return this.execute(),s},return(){return n&&n(Jt),{done:!0}}})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw new Error(".stream has been renamed to .forEach")}forEach(e){return this.forEachFn=e,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}};function of(r){if(zn.has(r))return zn.get(r);let e=Error.stackTraceLimit;return Error.stackTraceLimit=4,zn.set(r,new Error),Error.stackTraceLimit=e,zn.get(r)}var Mt=class extends Error{constructor(e){super(e.message),this.name=this.constructor.name,Object.assign(this,e)}},Ne={connection:_a,postgres:Sa,generic:Ta,notSupported:xa};function _a(r,e,t){let{host:n,port:s}=t||e,i=Object.assign(new Error("write "+r+" "+(e.path||n+":"+s)),{code:r,errno:r,address:e.path||n},e.path?{}:{port:s});return Error.captureStackTrace(i,_a),i}function Sa(r){let e=new Mt(r);return Error.captureStackTrace(e,Sa),e}function Ta(r,e){let t=Object.assign(new Error(r+": "+e),{code:r});return Error.captureStackTrace(t,Ta),t}function xa(r){let e=Object.assign(new Error(r+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:r});return Error.captureStackTrace(e,xa),e}var af={string:{to:25,from:null,serialize:r=>""+r},number:{to:0,from:[21,23,26,700,701],serialize:r=>""+r,parse:r=>+r},json:{to:114,from:[114,3802],serialize:r=>JSON.stringify(r),parse:r=>JSON.parse(r)},boolean:{to:16,from:16,serialize:r=>r===!0?"t":"f",parse:r=>r==="t"},date:{to:1184,from:[1082,1114,1184],serialize:r=>(r instanceof Date?r:new Date(r)).toISOString(),parse:r=>new Date(r)},bytea:{to:17,from:17,serialize:r=>"\\x"+Buffer.from(r).toString("hex"),parse:r=>Buffer.from(r.slice(2),"hex")}},Ur=class{then(){ro()}catch(){ro()}finally(){ro()}},Ht=class extends Ur{constructor(e){super(),this.value=Bn(e)}},Ye=class extends Ur{constructor(e,t,n){super(),this.value=e,this.type=t,this.array=n}},Kr=class extends Ur{constructor(e,t){super(),this.first=e,this.rest=t}build(e,t,n,s){let i=cf.map(([o,a])=>({fn:a,i:e.search(o)})).sort((o,a)=>o.i-a.i).pop();return i.i===-1?ao(this.first,s):i.fn(this.first,this.rest,t,n,s)}};function qn(r,e,t,n){let s=r instanceof Ye?r.value:r;if(s===void 0&&(r instanceof Ye?r.value=n.transform.undefined:s=r=n.transform.undefined,s===void 0))throw Ne.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+t.push(r instanceof Ye?(e.push(r.value),r.array?r.array[r.type||Qn(r.value)]||r.type||Pa(r.value):r.type):(e.push(r),Qn(r)))}var Ca=Oa(af);function io(r,e,t,n,s,i){for(let o=1;o<r.strings.length;o++)e+=oo(e,t,n,s,i)+r.strings[o],t=r.args[o];return e}function oo(r,e,t,n,s){return e instanceof Kr?e.build(r,t,n,s):e instanceof Ue?so(e,t,n,s):e instanceof Ht?e.value:e&&e[0]instanceof Ue?e.reduce((i,o)=>i+" "+so(o,t,n,s),""):qn(e,t,n,s)}function so(r,e,t,n){return r.fragment=!0,io(r,r.strings[0],r.args[0],e,t,n)}function Aa(r,e,t,n,s){return r.map(i=>"("+n.map(o=>oo("values",i[o],e,t,s)).join(",")+")").join(",")}function Na(r,e,t,n,s){let i=Array.isArray(r[0]),o=e.length?e.flat():Object.keys(i?r[0]:r);return Aa(i?r:[r],t,n,o,s)}function Fn(r,e,t,n,s){if(typeof r=="string"&&(r=[r].concat(e)),Array.isArray(r))return ao(r,s);let i;return(e.length?e.flat():Object.keys(r)).map(a=>(i=r[a],(i instanceof Ue?so(i,t,n,s):i instanceof Ht?i.value:qn(i,t,n,s))+" as "+Bn(s.transform.column.to?s.transform.column.to(a):a))).join(",")}var cf=Object.entries({values:Na,in:(...r)=>{let e=Na(...r);return e==="()"?"(null)":e},select:Fn,as:Fn,returning:Fn,"\\(":Fn,update(r,e,t,n,s){return(e.length?e.flat():Object.keys(r)).map(i=>Bn(s.transform.column.to?s.transform.column.to(i):i)+"="+oo("values",r[i],t,n,s))},insert(r,e,t,n,s){let i=e.length?e.flat():Object.keys(Array.isArray(r)?r[0]:r);return"("+ao(i,s)+")values"+Aa(Array.isArray(r)?r:[r],t,n,i,s)}}).map(([r,e])=>[new RegExp("((?:^|[\\s(])"+r+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),e]);function ro(){throw Ne.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}var lf=Ca.serializers,uf=Ca.parsers;function Pa(r){return Array.isArray(r)?Pa(r[0]):typeof r=="string"?1009:0}var Ea=function(r){let e=Oa(r||{});return{serializers:Object.assign({},lf,e.serializers),parsers:Object.assign({},uf,e.parsers)}};function Oa(r){return Object.keys(r).reduce((e,t)=>(r[t].from&&[].concat(r[t].from).forEach(n=>e.parsers[n]=r[t].parse),r[t].serialize&&(e.serializers[r[t].to]=r[t].serialize,r[t].from&&[].concat(r[t].from).forEach(n=>e.serializers[n]=r[t].serialize)),e),{parsers:{},serializers:{}})}function ao(r,{transform:{column:e}}){return r.map(t=>Bn(e.to?e.to(t):t)).join(",")}var Bn=function(e){return'"'+e.replace(/"/g,'""').replace(/\./g,'"."')+'"'},Qn=function r(e){return e instanceof Ye?e.type:e instanceof Date?1184:e instanceof Uint8Array?17:e===!0||e===!1?16:typeof e=="bigint"?20:Array.isArray(e)?r(e[0]):0},ff=/\\/g,df=/"/g;function mf(r){return r.replace(ff,"\\\\").replace(df,'\\"')}var ka=function r(e,t,n,s){if(Array.isArray(e)===!1)return e;if(!e.length)return"{}";let i=e[0],o=s===1020?";":",";return Array.isArray(i)&&!i.type?"{"+e.map(a=>r(a,t,n,s)).join(o)+"}":"{"+e.map(a=>{if(a===void 0&&(a=n.transform.undefined,a===void 0))throw Ne.generic("UNDEFINED_VALUE","Undefined values are not allowed");return a===null?"null":'"'+mf(t?t(a.type?a.value:a):""+a)+'"'}).join(o)+"}"},no={i:0,char:null,str:"",quoted:!1,last:0},$a=function(e,t,n){return no.i=no.last=0,Ia(no,e,t,n)};function Ia(r,e,t,n){let s=[],i=n===1020?";":",";for(;r.i<e.length;r.i++){if(r.char=e[r.i],r.quoted)r.char==="\\"?r.str+=e[++r.i]:r.char==='"'?(s.push(t?t(r.str):r.str),r.str="",r.quoted=e[r.i+1]==='"',r.last=r.i+2):r.str+=r.char;else if(r.char==='"')r.quoted=!0;else if(r.char==="{")r.last=++r.i,s.push(Ia(r,e,t,n));else if(r.char==="}"){r.quoted=!1,r.last<r.i&&s.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1;break}else r.char===i&&r.p!=="}"&&r.p!=='"'&&(s.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1);r.p=r.char}return r.last<r.i&&s.push(t?t(e.slice(r.last,r.i+1)):e.slice(r.last,r.i+1)),s}var jt=r=>{let e=r[0];for(let t=1;t<r.length;t++)e+=r[t]==="_"?r[++t].toUpperCase():r[t];return e},Lt=r=>{let e=r[0].toUpperCase();for(let t=1;t<r.length;t++)e+=r[t]==="_"?r[++t].toUpperCase():r[t];return e},Dt=r=>r.replace(/_/g,"-"),Zr=r=>r.replace(/([A-Z])/g,"_$1").toLowerCase(),Wr=r=>(r.slice(0,1)+r.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),Gr=r=>r.replace(/-/g,"_");function co(r){return function e(t,n){return typeof t=="object"&&t!==null&&(n.type===114||n.type===3802)?Array.isArray(t)?t.map(s=>e(s,n)):Object.entries(t).reduce((s,[i,o])=>Object.assign(s,{[r(i)]:e(o,n)}),{}):t}}jt.column={from:jt};jt.value={from:co(jt)};Zr.column={to:Zr};var lo={...jt};lo.column.to=Zr;Lt.column={from:Lt};Lt.value={from:co(Lt)};Wr.column={to:Wr};var uo={...Lt};uo.column.to=Wr;Dt.column={from:Dt};Dt.value={from:co(Dt)};Gr.column={to:Gr};var fo={...Dt};fo.column.to=Gr;var po=at(require("net"),1),La=at(require("tls"),1),Xt=at(require("crypto"),1),Kn=at(require("stream"),1),go=require("perf_hooks");var xt=class extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}};var Ke=hf;function hf(r=[]){let e=r.slice(),t=0;return{get length(){return e.length-t},remove:n=>{let s=e.indexOf(n);return s===-1?null:(e.splice(s,1),n)},push:n=>(e.push(n),n),shift:()=>{let n=e[t++];return t===e.length?(t=0,e=[]):e[t-1]=void 0,n}}}var Le=Buffer.allocUnsafe(256),pf="BCcDdEFfHPpQSX".split("").reduce((r,e)=>{let t=e.charCodeAt(0);return r[e]=()=>(Le[0]=t,le.i=5,le),r},{}),le=Object.assign(gf,pf,{N:String.fromCharCode(0),i:0,inc(r){return le.i+=r,le},str(r){let e=Buffer.byteLength(r);return Vn(e),le.i+=Le.write(r,le.i,e,"utf8"),le},i16(r){return Vn(2),Le.writeUInt16BE(r,le.i),le.i+=2,le},i32(r,e){return e||e===0?(Le.writeUInt32BE(r,e),le):(Vn(4),Le.writeUInt32BE(r,le.i),le.i+=4,le)},z(r){return Vn(r),Le.fill(0,le.i,le.i+r),le.i+=r,le},raw(r){return Le=Buffer.concat([Le.subarray(0,le.i),r]),le.i=Le.length,le},end(r=1){Le.writeUInt32BE(le.i-r,r);let e=Le.subarray(0,le.i);return le.i=0,Le=Buffer.allocUnsafe(256),e}}),Q=le;function Vn(r){if(Le.length-le.i<r){let e=Le,t=e.length;Le=Buffer.allocUnsafe(t+(t>>1)+r),e.copy(Le)}}function gf(){return le.i=0,le}var yo=Da,yf=1,Nt=Q().S().end(),Ma=Q().H().end(),bf=Q().i32(8).i32(80877103).end(8),wf=Buffer.concat([Q().E().str(Q.N).i32(0).end(),Nt]),vf=Q().D().str("S").str(Q.N).end(),Yt=()=>{},_f=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),Sf={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function Da(r,e={},{onopen:t=Yt,onend:n=Yt,onclose:s=Yt}={}){let{ssl:i,max:o,user:a,host:l,port:f,database:u,parsers:y,transform:p,onnotice:v,onnotify:T,onparameter:w,max_pipeline:L,keep_alive:N,backoff:q,target_session_attrs:z}=r,I=Ke(),D=yf++,H={pid:null,secret:null},O=ho(Hi,r.idle_timeout),F=ho(Hi,r.max_lifetime),Z=ho(uu,r.connect_timeout),S=null,W,V=new xt,G=Buffer.alloc(0),ie=r.fetch_types,he={},pe={},ze=Math.random().toString(36).slice(2),_=1,$=0,ne=0,re=0,ge=0,X=0,fe=0,xe=0,ve=null,ye=null,$e=!1,de=null,Je=null,Ie=null,St=null,Ae=null,be=null,He=null,it=null,A=null,Qr=null,Me={queue:e.closed,idleTimer:O,connect(m){Ie=m||!0,pa()},terminate:Br,execute:qr,cancel:ou,end:Hi,count:0,id:D};return e.closed&&e.closed.push(Me),Me;async function iu(){let m;try{m=r.socket?await Promise.resolve(r.socket(r)):new po.default.Socket}catch(g){Gt(g);return}return m.on("error",Gt),m.on("close",ga),m.on("drain",ma),m}async function ou({pid:m,secret:g},B,oe){try{W=Q().i32(16).i32(80877102).i32(m).i32(g).end(16),await ha(),S.once("error",oe),S.once("close",B)}catch(_e){oe(_e)}}function qr(m){if($e)return Rn(m,Ne.connection("CONNECTION_DESTROYED",r));if(!m.cancelled)try{return m.state=H,A?I.push(m):(A=m,A.active=!0),lu(m),Pe(au(m))&&!m.describeFirst&&!m.cursorFn&&I.length<L&&(!m.options.onexecute||m.options.onexecute(Me))}catch(g){return I.length===0&&Pe(Nt),ot(g),!0}}function au(m){if(m.parameters.length>=65534)throw Ne.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return m.options.simple?Q().Q().str(m.statement.string+Q.N).end():m.describeFirst?Buffer.concat([ua(m),Ma]):m.prepare?m.prepared?Dn(m):Buffer.concat([ua(m),Dn(m)]):cu(m)}function ua(m){return Buffer.concat([ba(m.statement.string,m.parameters,m.statement.types,m.statement.name),Wu("S",m.statement.name)])}function Dn(m){return Buffer.concat([Zu(m.parameters,m.statement.types,m.statement.name,m.cursorName),m.cursorFn?wa("",m.cursorRows):wf])}function cu(m){return Buffer.concat([ba(m.statement.string,m.parameters,m.statement.types),vf,Dn(m)])}function lu(m){let g=[],B=[],oe=io(m,m.strings[0],m.args[0],g,B,r);!m.tagged&&m.args.forEach(_e=>qn(_e,g,B,r)),m.prepare=r.prepare&&("prepare"in m.options?m.options.prepare:!0),m.string=oe,m.signature=m.prepare&&B+oe,m.onlyDescribe&&delete pe[m.signature],m.parameters=m.parameters||g,m.prepared=m.prepare&&m.signature in pe,m.describeFirst=m.onlyDescribe||g.length&&!m.prepared,m.statement=m.prepared?pe[m.signature]:{string:oe,types:B,name:m.prepare?ze+_++:""},typeof r.debug=="function"&&r.debug(D,oe,g,B)}function Pe(m,g){return be=be?Buffer.concat([be,m]):Buffer.from(m),g||be.length>=1024?fa(g):(ye===null&&(ye=setImmediate(fa)),!0)}function fa(m){let g=S.write(be,m);return ye!==null&&clearImmediate(ye),be=ye=null,g}function uu(){ot(Ne.connection("CONNECT_TIMEOUT",r,S)),S.destroy()}async function da(){if(Pe(bf),!await new Promise(g=>S.once("data",B=>g(B[0]===83)))&&i==="prefer")return Wt();S.removeAllListeners(),S=La.default.connect({socket:S,servername:po.default.isIP(S.host)?void 0:S.host,...i==="require"||i==="allow"||i==="prefer"?{rejectUnauthorized:!1}:i==="verify-full"?{}:typeof i=="object"?i:{}}),S.on("secureConnect",Wt),S.on("error",Gt),S.on("close",ga),S.on("drain",ma)}function ma(){!A&&t(Me)}function Ji(m){if(!(de&&(de.push(m),ne-=m.length,ne>=0)))for(G=de?Buffer.concat(de,X-ne):G.length===0?m:Buffer.concat([G,m],G.length+m.length);G.length>4;){if(X=G.readUInt32BE(1),X>=G.length){ne=X-G.length,de=[G];break}try{fu(G.subarray(0,X+1))}catch(g){A&&(A.cursorFn||A.describeFirst)&&Pe(Nt),ot(g)}G=G.subarray(X+1),ne=0,de=null}}async function ha(){if($e=!1,he={},S||(S=await iu()),!!S){if(Z.start(),r.socket)return i?da():Wt();if(S.on("connect",i?da:Wt),r.path)return S.connect(r.path);S.ssl=i,S.connect(f[re],l[re]),S.host=l[re],S.port=f[re],re=(re+1)%f.length}}function pa(){setTimeout(ha,$?$+fe-go.performance.now():0)}function Wt(){try{pe={},ie=r.fetch_types,ze=Math.random().toString(36).slice(2),_=1,F.start(),S.on("data",Ji),N&&S.setKeepAlive&&S.setKeepAlive(!0,1e3*N);let m=Ju();Pe(m)}catch(m){Gt(m)}}function Gt(m){if(!(Me.queue===e.connecting&&r.host[ge+1]))for(ot(m);I.length;)Rn(I.shift(),m)}function ot(m){Ae&&(Ae.destroy(m),Ae=null),A&&Rn(A,m),Ie&&(Rn(Ie,m),Ie=null)}function Rn(m,g){"query"in g||"parameters"in g||Object.defineProperties(g,{stack:{value:g.stack+m.origin.replace(/.*\n/,`
`),enumerable:r.debug},query:{value:m.string,enumerable:r.debug},parameters:{value:m.parameters,enumerable:r.debug},args:{value:m.args,enumerable:r.debug},types:{value:m.statement&&m.statement.types,enumerable:r.debug}}),m.reject(g)}function Hi(){return St||(!Me.reserved&&n(Me),!Me.reserved&&!Ie&&!A&&I.length===0?(Br(),new Promise(m=>S&&S.readyState!=="closed"?S.once("close",m):m())):St=new Promise(m=>He=m))}function Br(){$e=!0,(Ae||A||Ie||I.length)&&Gt(Ne.connection("CONNECTION_DESTROYED",r)),clearImmediate(ye),S&&(S.removeListener("data",Ji),S.removeListener("connect",Wt),S.readyState==="open"&&S.end(Q().X().end())),He&&(He(),St=He=null)}async function ga(m){if(G=Buffer.alloc(0),ne=0,de=null,clearImmediate(ye),S.removeListener("data",Ji),S.removeListener("connect",Wt),O.cancel(),F.cancel(),Z.cancel(),S.removeAllListeners(),S=null,Ie)return pa();!m&&(A||I.length)&&Gt(Ne.connection("CONNECTION_CLOSED",r,S)),$=go.performance.now(),m&&r.shared.retries++,fe=(typeof q=="function"?q(r.shared.retries):q)*1e3,s(Me,Ne.connection("CONNECTION_CLOSED",r,S))}function fu(m,g=m[0]){(g===68?du:g===100?zu:g===65?Iu:g===83?mu:g===90?hu:g===67?pu:g===50?ya:g===49?gu:g===116?yu:g===84?bu:g===82?wu:g===110?Nu:g===75?Cu:g===69?ku:g===115?Mu:g===51?ju:g===71?Lu:g===78?Qu:g===72?Du:g===99?Fu:g===73?qu:g===86?Bu:g===118?Vu:g===87?Ru:Uu)(m)}function du(m){let g=7,B,oe,_e,je=A.isRaw?new Array(A.statement.columns.length):{};for(let Fe=0;Fe<A.statement.columns.length;Fe++)oe=A.statement.columns[Fe],B=m.readInt32BE(g),g+=4,_e=B===-1?null:A.isRaw===!0?m.subarray(g,g+=B):oe.parser===void 0?m.toString("utf8",g,g+=B):oe.parser.array===!0?oe.parser(m.toString("utf8",g+1,g+=B)):oe.parser(m.toString("utf8",g,g+=B)),A.isRaw?je[Fe]=A.isRaw===!0?_e:p.value.from?p.value.from(_e,oe):_e:je[oe.name]=p.value.from?p.value.from(_e,oe):_e;A.forEachFn?A.forEachFn(p.row.from?p.row.from(je):je,V):V[xe++]=p.row.from?p.row.from(je):je}function mu(m){let[g,B]=m.toString("utf8",5,m.length-1).split(Q.N);he[g]=B,r.parameters[g]!==B&&(r.parameters[g]=B,w&&w(g,B))}function hu(m){if(A&&A.options.simple&&A.resolve(Je||V),A=Je=null,V=new xt,Z.cancel(),Ie){if(z){if(!he.in_hot_standby||!he.default_transaction_read_only)return Ou();if(Eu(z,he))return Br()}if(ie)return Ie===!0&&(Ie=null),Au();Ie!==!0&&qr(Ie),r.shared.retries=ge=0,Ie=null;return}for(;I.length&&(A=I.shift())&&(A.active=!0,A.cancelled);)Da(r).cancel(A.state,A.cancelled.resolve,A.cancelled.reject);A||(Me.reserved?!Me.reserved.release&&m[5]===73?St?Br():(Me.reserved=null,t(Me)):Me.reserved():St?Br():t(Me))}function pu(m){xe=0;for(let g=m.length-1;g>0;g--)if(m[g]===32&&m[g+1]<58&&V.count===null&&(V.count=+m.toString("utf8",g+1,m.length-1)),m[g-1]>=65){V.command=m.toString("utf8",5,g),V.state=H;break}if(Qr&&(Qr(),Qr=null),V.command==="BEGIN"&&o!==1&&!Me.reserved)return ot(Ne.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"));if(A.options.simple)return ya();A.cursorFn&&(V.count&&A.cursorFn(V),Pe(Nt)),A.resolve(V)}function gu(){A.parsing=!1}function ya(){!V.statement&&(V.statement=A.statement),V.columns=A.statement.columns}function yu(m){let g=m.readUInt16BE(5);for(let B=0;B<g;++B)!A.statement.types[B]&&(A.statement.types[B]=m.readUInt32BE(7+B*4));A.prepare&&(pe[A.signature]=A.statement),A.describeFirst&&!A.onlyDescribe&&(Pe(Dn(A)),A.describeFirst=!1)}function bu(m){V.command&&(Je=Je||[V],Je.push(V=new xt),V.count=null,A.statement.columns=null);let g=m.readUInt16BE(5),B=7,oe;A.statement.columns=Array(g);for(let _e=0;_e<g;++_e){for(oe=B;m[B++]!==0;);let je=m.readUInt32BE(B),Fe=m.readUInt16BE(B+4),Tt=m.readUInt32BE(B+6);A.statement.columns[_e]={name:p.column.from?p.column.from(m.toString("utf8",oe,B-1)):m.toString("utf8",oe,B-1),parser:y[Tt],table:je,number:Fe,type:Tt},B+=18}if(V.statement=A.statement,A.onlyDescribe)return A.resolve(A.statement),Pe(Nt)}async function wu(m,g=m.readUInt32BE(5)){(g===3?vu:g===5?_u:g===10?Su:g===11?Tu:g===12?xu:g!==0?Ku:Yt)(m,g)}async function vu(){let m=await Yi();Pe(Q().p().str(m).z(1).end())}async function _u(m){let g="md5"+await ja(Buffer.concat([Buffer.from(await ja(await Yi()+a)),m.subarray(9)]));Pe(Q().p().str(g).z(1).end())}async function Su(){it=(await Xt.default.randomBytes(18)).toString("base64"),Q().p().str("SCRAM-SHA-256"+Q.N);let m=Q.i;Pe(Q.inc(4).str("n,,n=*,r="+it).i32(Q.i-m-4,m).end())}async function Tu(m){let g=m.toString("utf8",9).split(",").reduce((Fe,Tt)=>(Fe[Tt[0]]=Tt.slice(2),Fe),{}),B=await Xt.default.pbkdf2Sync(await Yi(),Buffer.from(g.s,"base64"),parseInt(g.i),32,"sha256"),oe=await Un(B,"Client Key"),_e="n=*,r="+it+",r="+g.r+",s="+g.s+",i="+g.i+",c=biws,r="+g.r;ve=(await Un(await Un(B,"Server Key"),_e)).toString("base64");let je="c=biws,r="+g.r+",p="+xf(oe,Buffer.from(await Un(await Tf(oe),_e))).toString("base64");Pe(Q().p().str(je).end())}function xu(m){m.toString("utf8",9).split(Q.N,1)[0].slice(2)!==ve&&(ot(Ne.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),S.destroy())}function Yi(){return Promise.resolve(typeof r.pass=="function"?r.pass():r.pass)}function Nu(){if(V.statement=A.statement,V.statement.columns=[],A.onlyDescribe)return A.resolve(A.statement),Pe(Nt)}function Cu(m){H.pid=m.readUInt32BE(5),H.secret=m.readUInt32BE(9)}async function Au(){ie=!1,(await new Ue([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],qr)).forEach(({oid:g,typarray:B})=>Pu(g,B))}function Pu(m,g){if(!!r.parsers[g]&&!!r.serializers[g])return;let B=r.parsers[m];r.shared.typeArrayMap[m]=g,r.parsers[g]=oe=>$a(oe,B,g),r.parsers[g].array=!0,r.serializers[g]=oe=>ka(oe,r.serializers[m],r,g)}function Eu(m,g){return m==="read-write"&&g.default_transaction_read_only==="on"||m==="read-only"&&g.default_transaction_read_only==="off"||m==="primary"&&g.in_hot_standby==="on"||m==="standby"&&g.in_hot_standby==="off"||m==="prefer-standby"&&g.in_hot_standby==="off"&&r.host[ge]}function Ou(){let m=new Ue([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],qr,null,{simple:!0});m.resolve=([[g],[B]])=>{he.default_transaction_read_only=g.transaction_read_only,he.in_hot_standby=B.pg_is_in_recovery?"on":"off"},m.execute()}function ku(m){A&&(A.cursorFn||A.describeFirst)&&Pe(Nt);let g=Ne.postgres(mo(m));A&&A.retried?ot(A.retried):A&&A.prepared&&_f.has(g.routine)?$u(A,g):ot(g)}function $u(m,g){delete pe[m.signature],m.retried=g,qr(m)}function Iu(m){if(!T)return;let g=9;for(;m[g++]!==0;);T(m.toString("utf8",9,g-1),m.toString("utf8",g,m.length-1))}async function Mu(){try{let m=await Promise.resolve(A.cursorFn(V));xe=0,m===Jt?Pe(Gu(A.portal)):(V=new xt,Pe(wa("",A.cursorRows)))}catch(m){Pe(Nt),A.reject(m)}}function ju(){V.count&&A.cursorFn(V),A.resolve(V)}function Lu(){Ae=new Kn.default.Writable({autoDestroy:!0,write(m,g,B){S.write(Q().d().raw(m).end(),B)},destroy(m,g){g(m),S.write(Q().f().str(m+Q.N).end()),Ae=null},final(m){S.write(Q().c().end()),Qr=m}}),A.resolve(Ae)}function Du(){Ae=new Kn.default.Readable({read(){S.resume()}}),A.resolve(Ae)}function Ru(){Ae=new Kn.default.Duplex({autoDestroy:!0,read(){S.resume()},write(m,g,B){S.write(Q().d().raw(m).end(),B)},destroy(m,g){g(m),S.write(Q().f().str(m+Q.N).end()),Ae=null},final(m){S.write(Q().c().end()),Qr=m}}),A.resolve(Ae)}function zu(m){Ae&&(Ae.push(m.subarray(5))||S.pause())}function Fu(){Ae&&Ae.push(null),Ae=null}function Qu(m){v?v(mo(m)):console.log(mo(m))}function qu(){}function Bu(){ot(Ne.notSupported("FunctionCallResponse"))}function Vu(){ot(Ne.notSupported("NegotiateProtocolVersion"))}function Uu(m){console.error("Postgres.js : Unknown Message:",m[0])}function Ku(m,g){console.error("Postgres.js : Unknown Auth:",g)}function Zu(m,g,B="",oe=""){let _e,je;return Q().B().str(oe+Q.N).str(B+Q.N).i16(0).i16(m.length),m.forEach((Fe,Tt)=>{if(Fe===null)return Q.i32(4294967295);je=g[Tt],m[Tt]=Fe=je in r.serializers?r.serializers[je](Fe):""+Fe,_e=Q.i,Q.inc(4).str(Fe).i32(Q.i-_e-4,_e)}),Q.i16(0),Q.end()}function ba(m,g,B,oe=""){return Q().P().str(oe+Q.N).str(m+Q.N).i16(g.length),g.forEach((_e,je)=>Q.i32(B[je]||0)),Q.end()}function Wu(m,g=""){return Q().D().str(m).str(g+Q.N).end()}function wa(m="",g=0){return Buffer.concat([Q().E().str(m+Q.N).i32(g).end(),Ma])}function Gu(m=""){return Buffer.concat([Q().C().str("P").str(m+Q.N).end(),Q().S().end()])}function Ju(){return W||Q().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:a,database:u,client_encoding:"UTF8"},r.connection)).filter(([,m])=>m).map(([m,g])=>m+Q.N+g).join(Q.N)).z(2).end(0)}}function mo(r){let e={},t=5;for(let n=5;n<r.length-1;n++)r[n]===0&&(e[Sf[r[t]]]=r.toString("utf8",t+1,n),t=n+1);return e}function ja(r){return Xt.default.createHash("md5").update(r).digest("hex")}function Un(r,e){return Xt.default.createHmac("sha256",r).update(e).digest()}function Tf(r){return Xt.default.createHash("sha256").update(r).digest()}function xf(r,e){let t=Math.max(r.length,e.length),n=Buffer.allocUnsafe(t);for(let s=0;s<t;s++)n[s]=r[s]^e[s];return n}function ho(r,e){if(e=typeof e=="function"?e():e,!e)return{cancel:Yt,start:Yt};let t;return{cancel(){t&&(clearTimeout(t),t=null)},start(){t&&clearTimeout(t),t=setTimeout(n,e*1e3,arguments)}};function n(s){r.apply(null,s),t=null}}var Ra=()=>{};function bo(r,e){let t=new Map,n="postgresjs_"+Math.random().toString(36).slice(2),s={},i,o,a=!1,l=y.sql=r({...e,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...e.connection,replication:"database"},onclose:async function(){a||(o=null,s.pid=s.secret=void 0,p(await v(l,n,e.publications)),t.forEach(w=>w.forEach(({onsubscribe:L})=>L())))},no_subscribe:!0}),f=l.end,u=l.close;return l.end=async()=>(a=!0,o&&await new Promise(w=>(o.once("close",w),o.end())),f()),l.close=async()=>(o&&await new Promise(w=>(o.once("close",w),o.end())),u()),y;async function y(w,L,N=Ra,q=Ra){w=Af(w),i||(i=v(l,n,e.publications));let z={fn:L,onsubscribe:N},I=t.has(w)?t.get(w).add(z):t.set(w,new Set([z])).get(w),D=()=>{I.delete(z),I.size===0&&t.delete(w)};return i.then(H=>(p(H),N(),o&&o.on("error",q),{unsubscribe:D,state:s,sql:l}))}function p(w){o=w.stream,s.pid=w.state.pid,s.secret=w.state.secret}async function v(w,L,N){if(!N)throw new Error("Missing publication names");let q=await w.unsafe(`CREATE_REPLICATION_SLOT ${L} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[z]=q,I=await w.unsafe(`START_REPLICATION SLOT ${L} LOGICAL ${z.consistent_point} (proto_version '1', publication_names '${N}')`).writable(),D={lsn:Buffer.concat(z.consistent_point.split("/").map(S=>Buffer.from(("00000000"+S).slice(-8),"hex")))};return I.on("data",O),I.on("error",H),I.on("close",w.close),{stream:I,state:q.state};function H(S){console.error("Unexpected error during logical streaming - reconnecting",S)}function O(S){S[0]===119?Cf(S.subarray(25),D,w.options.parsers,F,e.transform):S[0]===107&&S[17]&&(D.lsn=S.subarray(1,9),Z())}function F(S,W){let V=W.relation.schema+"."+W.relation.table;T("*",S,W),T("*:"+V,S,W),W.relation.keys.length&&T("*:"+V+"="+W.relation.keys.map(G=>S[G.name]),S,W),T(W.command,S,W),T(W.command+":"+V,S,W),W.relation.keys.length&&T(W.command+":"+V+"="+W.relation.keys.map(G=>S[G.name]),S,W)}function Z(){let S=Buffer.alloc(34);S[0]="r".charCodeAt(0),S.fill(D.lsn,1),S.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),I.write(S)}}function T(w,L,N){t.has(w)&&t.get(w).forEach(({fn:q})=>q(L,N,w))}}function Nf(r){return new Date(Date.UTC(2e3,0,1)+Number(r/BigInt(1e3)))}function Cf(r,e,t,n,s){let i=(o,[a,l])=>(o[a.charCodeAt(0)]=l,o);Object.entries({R:o=>{let a=1,l=e[o.readUInt32BE(a)]={schema:o.toString("utf8",a+=4,a=o.indexOf(0,a))||"pg_catalog",table:o.toString("utf8",a+1,a=o.indexOf(0,a+1)),columns:Array(o.readUInt16BE(a+=2)),keys:[]};a+=2;let f=0,u;for(;a<o.length;)u=l.columns[f++]={key:o[a++],name:s.column.from?s.column.from(o.toString("utf8",a,a=o.indexOf(0,a))):o.toString("utf8",a,a=o.indexOf(0,a)),type:o.readUInt32BE(a+=1),parser:t[o.readUInt32BE(a)],atttypmod:o.readUInt32BE(a+=4)},u.key&&l.keys.push(u),a+=4},Y:()=>{},O:()=>{},B:o=>{e.date=Nf(o.readBigInt64BE(9)),e.lsn=o.subarray(1,9)},I:o=>{let a=1,l=e[o.readUInt32BE(a)],{row:f}=Zn(o,l.columns,a+=7,s);n(f,{command:"insert",relation:l})},D:o=>{let a=1,l=e[o.readUInt32BE(a)];a+=4;let f=o[a]===75;n(f||o[a]===79?Zn(o,l.columns,a+=3,s).row:null,{command:"delete",relation:l,key:f})},U:o=>{let a=1,l=e[o.readUInt32BE(a)];a+=4;let f=o[a]===75,u=f||o[a]===79?Zn(o,l.columns,a+=3,s):null;u&&(a=u.i);let{row:y}=Zn(o,l.columns,a+3,s);n(y,{command:"update",relation:l,key:f,old:u&&u.row})},T:()=>{},C:()=>{}}).reduce(i,{})[r[0]](r)}function Zn(r,e,t,n){let s,i,o,a=n.raw?new Array(e.length):{};for(let l=0;l<e.length;l++)s=r[t++],i=e[l],o=s===110?null:s===117?void 0:i.parser===void 0?r.toString("utf8",t+4,t+=4+r.readUInt32BE(t)):i.parser.array===!0?i.parser(r.toString("utf8",t+5,t+=4+r.readUInt32BE(t))):i.parser(r.toString("utf8",t+4,t+=4+r.readUInt32BE(t))),n.raw?a[l]=n.raw===!0?o:n.value.from?n.value.from(o,i):o:a[i.name]=n.value.from?n.value.from(o,i):o;return{i:t,row:n.row.from?n.row.from(a):a}}function Af(r){let e=r.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!e)throw new Error("Malformed subscribe pattern: "+r);let[,t,n,s]=e;return(t||"*")+(n?":"+(n.indexOf(".")===-1?"public."+n:n):"")+(s?"="+s:"")}var wo=at(require("stream"),1);function vo(r,e,t=393216){return new Promise(async(n,s)=>{await r.begin(async i=>{let o;!e&&([{oid:e}]=await i`select lo_creat(-1) as oid`);let[{fd:a}]=await i`select lo_open(${e}, ${t}) as fd`,l={writable:u,readable:f,close:()=>i`select lo_close(${a})`.then(o),tell:()=>i`select lo_tell64(${a})`,read:y=>i`select loread(${a}, ${y}) as data`,write:y=>i`select lowrite(${a}, ${y})`,truncate:y=>i`select lo_truncate64(${a}, ${y})`,seek:(y,p=0)=>i`select lo_lseek64(${a}, ${y}, ${p})`,size:()=>i`
          select
            lo_lseek64(${a}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return n(l),new Promise(async y=>o=y);async function f({highWaterMark:y=2048*8,start:p=0,end:v=1/0}={}){let T=v-p;return p&&await l.seek(p),new wo.default.Readable({highWaterMark:y,async read(w){let L=w>T?w-T:w;T-=w;let[{data:N}]=await l.read(L);this.push(N),N.length<w&&this.push(null)}})}async function u({highWaterMark:y=2048*8,start:p=0}={}){return p&&await l.seek(p),new wo.default.Writable({highWaterMark:y,write(v,T,w){l.write(v).then(()=>w(),w)}})}}).catch(s)})}Object.assign(Wn,{PostgresError:Mt,toPascal:Lt,pascal:uo,toCamel:jt,camel:lo,toKebab:Dt,kebab:fo,fromPascal:Wr,fromCamel:Zr,fromKebab:Gr,BigInt:{to:20,from:[20],parse:r=>BigInt(r),serialize:r=>r.toString()}});var er=Wn;function Wn(r,e){let t=Pf(r,e),n=t.no_subscribe||bo(Wn,{...t}),s=!1,i=Ke(),o=Ke(),a=Ke(),l=Ke(),f=Ke(),u=Ke(),y=Ke(),p=Ke(),v={connecting:o,reserved:a,closed:l,ended:f,open:u,busy:y,full:p},T=[...Array(t.max)].map(()=>yo(t,v,{onopen:pe,onend:he,onclose:ze})),w=L(F);return Object.assign(w,{get parameters(){return t.parameters},largeObject:vo.bind(null,w),subscribe:n,CLOSE:Jt,END:Jt,PostgresError:Mt,options:t,reserve:z,listen:N,begin:I,close:V,end:W}),w;function L(_){return _.debug=t.debug,Object.entries(t.types).reduce((X,[fe,xe])=>(X[fe]=ve=>new Ye(ve,xe.to),X),$),Object.assign(ne,{types:$,typed:$,unsafe:re,notify:q,array:O,json:H,file:ge}),ne;function $(X,fe){return new Ye(X,fe)}function ne(X,...fe){return X&&Array.isArray(X.raw)?new Ue(X,fe,_,S):typeof X=="string"&&!fe.length?new Ht(t.transform.column.to?t.transform.column.to(X):X):new Kr(X,fe)}function re(X,fe=[],xe={}){return arguments.length===2&&!Array.isArray(fe)&&(xe=fe,fe=[]),new Ue([X],fe,_,S,{prepare:!1,...xe,simple:"simple"in xe?xe.simple:fe.length===0})}function ge(X,fe=[],xe={}){return arguments.length===2&&!Array.isArray(fe)&&(xe=fe,fe=[]),new Ue([],fe,ye=>{Fa.default.readFile(X,"utf8",($e,de)=>{if($e)return ye.reject($e);ye.strings=[de],_(ye)})},S,{...xe,simple:"simple"in xe?xe.simple:fe.length===0})}}async function N(_,$,ne){let re={fn:$,onlisten:ne},ge=N.sql||(N.sql=Wn({...t,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(N.channels).forEach(([ye,{listeners:$e}])=>{delete N.channels[ye],Promise.all($e.map(de=>N(ye,de.fn,de.onlisten).catch(()=>{})))})},onnotify(ye,$e){ye in N.channels&&N.channels[ye].listeners.forEach(de=>de.fn($e))}})),X=N.channels||(N.channels={});if(_ in X){X[_].listeners.push(re);let ye=await X[_].result;return re.onlisten&&re.onlisten(),{state:ye.state,unlisten:ve}}X[_]={result:ge`listen ${ge.unsafe('"'+_.replace(/"/g,'""')+'"')}`,listeners:[re]};let xe=await X[_].result;return re.onlisten&&re.onlisten(),{state:xe.state,unlisten:ve};async function ve(){if(_ in X&&(X[_].listeners=X[_].listeners.filter(ye=>ye!==re),!X[_].listeners.length))return delete X[_],ge`unlisten ${ge.unsafe('"'+_.replace(/"/g,'""')+'"')}`}}async function q(_,$){return await w`select pg_notify(${_}, ${""+$})`}async function z(){let _=Ke(),$=u.length?u.shift():await new Promise(ge=>{i.push({reserve:ge}),l.length&&ie(l.shift())});D($,a),$.reserved=()=>_.length?$.execute(_.shift()):D($,a),$.reserved.release=!0;let ne=L(re);return ne.release=()=>{$.reserved=null,pe($)},ne;function re(ge){$.queue===p?_.push(ge):$.execute(ge)||D($,p)}}async function I(_,$){!$&&($=_,_="");let ne=Ke(),re=0,ge,X=null;try{return await w.unsafe("begin "+_.replace(/[^a-z ]/ig,""),[],{onexecute:xe}).execute(),await Promise.race([fe(ge,$),new Promise((ve,ye)=>ge.onclose=ye)])}catch(ve){throw ve}async function fe(ve,ye,$e){let de=L(Ae);de.savepoint=St,de.prepare=be=>X=be.replace(/[^a-z0-9$-_. ]/gi);let Je,Ie;$e&&await de`savepoint ${de($e)}`;try{if(Ie=await new Promise((be,He)=>{let it=ye(de);Promise.resolve(Array.isArray(it)?Promise.all(it):it).then(be,He)}),Je)throw Je}catch(be){throw await($e?de`rollback to ${de($e)}`:de`rollback`),be instanceof Mt&&be.code==="25P02"&&Je||be}return $e||(X?await de`prepare transaction '${de.unsafe(X)}'`:await de`commit`),Ie;function St(be,He){return be&&Array.isArray(be.raw)?St(it=>it.apply(it,arguments)):(arguments.length===1&&(He=be,be=null),fe(ve,He,"s"+re+++(be?"_"+be:"")))}function Ae(be){be.catch(He=>Je||(Je=He)),ve.queue===p?ne.push(be):ve.execute(be)||D(ve,p)}}function xe(ve){ge=ve,D(ve,a),ve.reserved=()=>ne.length?ve.execute(ne.shift()):D(ve,a)}}function D(_,$){return _.queue.remove(_),$.push(_),_.queue=$,$===u?_.idleTimer.start():_.idleTimer.cancel(),_}function H(_){return new Ye(_,3802)}function O(_,$){return Array.isArray(_)?new Ye(_,$||(_.length?Qn(_)||25:0),t.shared.typeArrayMap):O(Array.from(arguments))}function F(_){if(s)return _.reject(Ne.connection("CONNECTION_ENDED",t,t));if(u.length)return Z(u.shift(),_);if(l.length)return ie(l.shift(),_);y.length?Z(y.shift(),_):i.push(_)}function Z(_,$){return _.execute($)?D(_,y):D(_,p)}function S(_){return new Promise(($,ne)=>{_.state?_.active?yo(t).cancel(_.state,$,ne):_.cancelled={resolve:$,reject:ne}:(i.remove(_),_.cancelled=!0,_.reject(Ne.generic("57014","canceling statement due to user request")),$())})}async function W({timeout:_=null}={}){if(s)return s;await 1;let $;return s=Promise.race([new Promise(ne=>_!==null&&($=setTimeout(G,_*1e3,ne))),Promise.all(T.map(ne=>ne.end()).concat(N.sql?N.sql.end({timeout:0}):[],n.sql?n.sql.end({timeout:0}):[]))]).then(()=>clearTimeout($))}async function V(){await Promise.all(T.map(_=>_.end()))}async function G(_){for(await Promise.all(T.map($=>$.terminate()));i.length;)i.shift().reject(Ne.connection("CONNECTION_DESTROYED",t));_()}function ie(_,$){return D(_,o),_.connect($),_}function he(_){D(_,f)}function pe(_){if(i.length===0)return D(_,u);let $=Math.ceil(i.length/(o.length+1)),ne=!0;for(;ne&&i.length&&$-- >0;){let re=i.shift();if(re.reserve)return re.reserve(_);ne=_.execute(re)}ne?D(_,y):D(_,p)}function ze(_,$){D(_,l),_.reserved=null,_.onclose&&(_.onclose($),_.onclose=null),t.onclose&&t.onclose(_.id),i.length&&ie(_,i.shift())}}function Pf(r,e){if(r&&r.shared)return r;let t=process.env,n=(!r||typeof r=="string"?e:r)||{},{url:s,multihost:i}=If(r),o=[...s.searchParams].reduce((p,[v,T])=>(p[v]=T,p),{}),a=n.hostname||n.host||i||s.hostname||t.PGHOST||"localhost",l=n.port||s.port||t.PGPORT||5432,f=n.user||n.username||s.username||t.PGUSERNAME||t.PGUSER||Mf();n.no_prepare&&(n.prepare=!1),o.sslmode&&(o.ssl=o.sslmode,delete o.sslmode),"timeout"in n&&(console.log("The timeout option is deprecated, use idle_timeout instead"),n.idle_timeout=n.timeout),o.sslrootcert==="system"&&(o.ssl="verify-full");let u=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],y={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:kf,max_pipeline:100,backoff:Of,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(a)?a:a.split(",").map(p=>p.split(":")[0]),port:Array.isArray(l)?l:a.split(",").map(p=>parseInt(p.split(":")[1]||l)),path:n.path||a.indexOf("/")>-1&&a+"/.s.PGSQL."+l,database:n.database||n.db||(s.pathname||"").slice(1)||t.PGDATABASE||f,user:f,pass:n.pass||n.password||s.password||t.PGPASSWORD||"",...Object.entries(y).reduce((p,[v,T])=>{let w=v in n?n[v]:v in o?o[v]==="disable"||o[v]==="false"?!1:o[v]:t["PG"+v.toUpperCase()]||T;return p[v]=typeof w=="string"&&u.includes(v)?+w:w,p},{}),connection:{application_name:"postgres.js",...n.connection,...Object.entries(o).reduce((p,[v,T])=>(v in y||(p[v]=T),p),{})},types:n.types||{},target_session_attrs:Ef(n,s,t),onnotice:n.onnotice,onnotify:n.onnotify,onclose:n.onclose,onparameter:n.onparameter,socket:n.socket,transform:$f(n.transform||{undefined:void 0}),parameters:{},shared:{retries:0,typeArrayMap:{}},...Ea(n.types)}}function Ef(r,e,t){let n=r.target_session_attrs||e.searchParams.get("target_session_attrs")||t.PGTARGETSESSIONATTRS;if(!n||["read-write","read-only","primary","standby","prefer-standby"].includes(n))return n;throw new Error("target_session_attrs "+n+" is not supported")}function Of(r){return(.5+Math.random()/2)*Math.min(3**r/100,20)}function kf(){return 60*(30+Math.random()*30)}function $f(r){return{undefined:r.undefined,column:{from:typeof r.column=="function"?r.column:r.column&&r.column.from,to:r.column&&r.column.to},value:{from:typeof r.value=="function"?r.value:r.value&&r.value.from,to:r.value&&r.value.to},row:{from:typeof r.row=="function"?r.row:r.row&&r.row.from,to:r.row&&r.row.to}}}function If(r){if(!r||typeof r!="string")return{url:{searchParams:new Map}};let e=r;e=e.slice(e.indexOf("://")+3).split(/[?/]/)[0],e=decodeURIComponent(e.slice(e.indexOf("@")+1));let t=new URL(r.replace(e,e.split(",")[0]));return{url:{username:decodeURIComponent(t.username),password:decodeURIComponent(t.password),host:t.host,hostname:t.hostname,port:t.port,pathname:t.pathname,searchParams:t.searchParams},multihost:e.indexOf(",")>-1&&e}}function Mf(){try{return za.default.userInfo().username}catch{return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}var d=Symbol.for("drizzle:entityKind"),ay=Symbol.for("drizzle:hasOwnEntityKind");function b(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,d))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(r).constructor;if(t)for(;t;){if(d in t&&t[d]===e[d])return!0;t=Object.getPrototypeOf(t)}return!1}var jf,Gn=class{write(e){console.log(e)}};jf=d,c(Gn,jf,"ConsoleLogWriter");var Lf,Jr=class{constructor(e){c(this,"writer");this.writer=e?.writer??new Gn}logQuery(e,t){let n=t.map(i=>{try{return JSON.stringify(i)}catch{return String(i)}}),s=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${s}`)}};Lf=d,c(Jr,Lf,"DefaultLogger");var Df,Hr=class{logQuery(){}};Df=d,c(Hr,Df,"NoopLogger");var Rf,zf,Ee=class{constructor(){c(this,zf,"QueryPromise")}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};Rf=d,zf=Symbol.toStringTag,c(Ee,Rf,"QueryPromise");var Ff,ce=class{constructor(e,t){c(this,"name");c(this,"keyAsName");c(this,"primary");c(this,"notNull");c(this,"default");c(this,"defaultFn");c(this,"onUpdateFn");c(this,"hasDefault");c(this,"isUnique");c(this,"uniqueName");c(this,"uniqueType");c(this,"dataType");c(this,"columnType");c(this,"enumValues");c(this,"generated");c(this,"generatedIdentity");c(this,"config");this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};Ff=d,c(ce,Ff,"Column");var Qf,Yr=class{constructor(e,t,n){c(this,"config");c(this,"$default",this.$defaultFn);c(this,"$onUpdate",this.$onUpdateFn);this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};Qf=d,c(Yr,Qf,"ColumnBuilder");var Xe=Symbol.for("drizzle:Name");var qf,Xr=class{constructor(e,t){c(this,"reference");c(this,"_onUpdate","no action");c(this,"_onDelete","no action");this.reference=()=>{let{name:n,columns:s,foreignColumns:i}=e();return{name:n,columns:s,foreignTable:i[0].table,foreignColumns:i}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Jn(e,this)}};qf=d,c(Xr,qf,"PgForeignKeyBuilder");var Bf,Jn=class{constructor(e,t){c(this,"reference");c(this,"onUpdate");c(this,"onDelete");this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}getName(){let{name:e,columns:t,foreignColumns:n}=this.reference(),s=t.map(a=>a.name),i=n.map(a=>a.name),o=[this.table[Xe],...s,n[0].table[Xe],...i];return e??`${o.join("_")}_fk`}};Bf=d,c(Jn,Bf,"PgForeignKey");function Hn(r,...e){return r(...e)}function So(r,e){return`${r[Xe]}_${e.join("_")}_unique`}var Vf,Yn=class{constructor(e,t){c(this,"columns");c(this,"nullsNotDistinctConfig",!1);this.name=t,this.columns=e}nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Xn(e,this.columns,this.nullsNotDistinctConfig,this.name)}};Vf=d,c(Yn,Vf,"PgUniqueConstraintBuilder");var Uf,_o=class{constructor(e){c(this,"name");this.name=e}on(...e){return new Yn(e,this.name)}};Uf=d,c(_o,Uf,"PgUniqueOnConstraintBuilder");var Kf,Xn=class{constructor(e,t,n,s){c(this,"columns");c(this,"name");c(this,"nullsNotDistinct",!1);this.table=e,this.columns=t,this.name=s??So(this.table,this.columns.map(i=>i.name)),this.nullsNotDistinct=n}getName(){return this.name}};Kf=d,c(Xn,Kf,"PgUniqueConstraint");function Qa(r,e,t){for(let n=e;n<r.length;n++){let s=r[n];if(s==="\\"){n++;continue}if(s==='"')return[r.slice(e,n).replace(/\\/g,""),n+1];if(!t&&(s===","||s==="}"))return[r.slice(e,n).replace(/\\/g,""),n]}return[r.slice(e).replace(/\\/g,""),r.length]}function qa(r,e=0){let t=[],n=e,s=!1;for(;n<r.length;){let i=r[n];if(i===","){(s||n===e)&&t.push(""),s=!0,n++;continue}if(s=!1,i==="\\"){n+=2;continue}if(i==='"'){let[l,f]=Qa(r,n+1,!0);t.push(l),n=f;continue}if(i==="}")return[t,n+1];if(i==="{"){let[l,f]=qa(r,n+1);t.push(l),n=f;continue}let[o,a]=Qa(r,n,!1);t.push(o),n=a}return[t,n]}function Ba(r){let[e]=qa(r,1);return e}function To(r){return`{${r.map(e=>Array.isArray(e)?To(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var Zf,M=class extends Yr{constructor(){super(...arguments);c(this,"foreignKeyConfigs",[])}array(t){return new ts(this.config.name,this,t)}references(t,n={}){return this.foreignKeyConfigs.push({ref:t,actions:n}),this}unique(t,n){return this.config.isUnique=!0,this.config.uniqueName=t,this.config.uniqueType=n?.nulls,this}generatedAlwaysAs(t){return this.config.generated={as:t,type:"always",mode:"stored"},this}buildForeignKeys(t,n){return this.foreignKeyConfigs.map(({ref:s,actions:i})=>Hn((o,a)=>{let l=new Xr(()=>{let f=o();return{columns:[t],foreignColumns:[f]}});return a.onUpdate&&l.onUpdate(a.onUpdate),a.onDelete&&l.onDelete(a.onDelete),l.build(n)},s,i))}buildExtraConfigColumn(t){return new es(t,this.config)}};Zf=d,c(M,Zf,"PgColumnBuilder");var Wf,C=class extends ce{constructor(e,t){t.uniqueName||(t.uniqueName=So(e,[t.name])),super(e,t),this.table=e}};Wf=d,c(C,Wf,"PgColumn");var Gf,es=class extends C{constructor(){super(...arguments);c(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});c(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(t){return this.indexConfig.opClass=t,this}};Gf=d,c(es,Gf,"ExtraConfigColumn");var Jf,xo=class{constructor(e,t,n,s){c(this,"name");c(this,"keyAsName");c(this,"type");c(this,"indexConfig");this.name=e,this.keyAsName=t,this.type=n,this.indexConfig=s}};Jf=d,c(xo,Jf,"IndexedColumn");var Hf,ts=class extends M{constructor(e,t,n){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=n}build(e){let t=this.config.baseBuilder.build(e);return new rs(e,this.config,t)}};Hf=d,c(ts,Hf,"PgArrayBuilder");var Yf,No=class extends C{constructor(t,n,s,i){super(t,n);c(this,"size");this.baseColumn=s,this.range=i,this.size=n.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(t){return typeof t=="string"&&(t=Ba(t)),t.map(n=>this.baseColumn.mapFromDriverValue(n))}mapToDriverValue(t,n=!1){let s=t.map(i=>i===null?null:b(this.baseColumn,No)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return n?s:To(s)}},rs=No;Yf=d,c(rs,Yf,"PgArray");var Co=Symbol.for("drizzle:isPgEnum");function Va(r){return!!r&&typeof r=="function"&&Co in r&&r[Co]===!0}var Xf,ns=class extends M{constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new ss(e,this.config)}};Xf=d,c(ns,Xf,"PgEnumColumnBuilder");var ed,ss=class extends C{constructor(t,n){super(t,n);c(this,"enum",this.config.enum);c(this,"enumValues",this.config.enum.enumValues);this.enum=n.enum}getSQLType(){return this.enum.enumName}};ed=d,c(ss,ed,"PgEnumColumn");function Ua(r,e,t){let n=Object.assign(s=>new ns(s??"",n),{enumName:r,enumValues:e,schema:t,[Co]:!0});return n}var td,Se=class{constructor(e,t,n,s=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:n,isWith:s}}};td=d,c(Se,td,"Subquery");var rd,Rt=class extends Se{};rd=d,c(Rt,rd,"WithSubquery");var Ka="0.40.0";var Ao,Po,ue={startActiveSpan(r,e){return Ao?(Po||(Po=Ao.trace.getTracer("drizzle-orm",Ka)),Hn((t,n)=>n.startActiveSpan(r,s=>{try{return e(s)}catch(i){throw s.setStatus({code:t.SpanStatusCode.ERROR,message:i instanceof Error?i.message:"Unknown error"}),i}finally{s.end()}}),Ao,Po)):e()}};var me=Symbol.for("drizzle:ViewBaseConfig");var is=Symbol.for("drizzle:Schema"),os=Symbol.for("drizzle:Columns"),Za=Symbol.for("drizzle:ExtraConfigColumns"),Eo=Symbol.for("drizzle:OriginalName"),Oo=Symbol.for("drizzle:BaseName"),en=Symbol.for("drizzle:IsAlias"),Wa=Symbol.for("drizzle:ExtraConfigBuilder"),nd=Symbol.for("drizzle:IsDrizzleTable"),sd,id,od,ad,cd,ld,ud,fd,dd,md,P=class{constructor(e,t,n){c(this,id);c(this,od);c(this,ad);c(this,cd);c(this,ld);c(this,ud);c(this,fd,!1);c(this,dd,!0);c(this,md);this[Xe]=this[Eo]=e,this[is]=t,this[Oo]=n}};sd=d,id=Xe,od=Eo,ad=is,cd=os,ld=Za,ud=Oo,fd=en,dd=nd,md=Wa,c(P,sd,"Table"),c(P,"Symbol",{Name:Xe,Schema:is,OriginalName:Eo,Columns:os,ExtraConfigColumns:Za,BaseName:Oo,IsAlias:en,ExtraConfigBuilder:Wa});function qe(r){return r[Xe]}function zt(r){return`${r[is]??"public"}.${r[Xe]}`}var gd,ko=class{};gd=d,c(ko,gd,"FakePrimitiveParam");function $o(r){return r!=null&&typeof r.getSQL=="function"}function hd(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var yd,Te=class{constructor(e){c(this,"value");this.value=Array.isArray(e)?e:[e]}getSQL(){return new j([this])}};yd=d,c(Te,yd,"StringChunk");var bd,tr=class{constructor(e){c(this,"decoder",Ja);c(this,"shouldInlineParams",!1);this.queryChunks=e}append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return ue.startActiveSpan("drizzle.buildSQL",t=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,t){let n=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:s,escapeName:i,escapeParam:o,prepareTyping:a,inlineParams:l,paramStartIndex:f}=n;return hd(e.map(u=>{if(b(u,Te))return{sql:u.value.join(""),params:[]};if(b(u,rr))return{sql:i(u.value),params:[]};if(u===void 0)return{sql:"",params:[]};if(Array.isArray(u)){let y=[new Te("(")];for(let[p,v]of u.entries())y.push(v),p<u.length-1&&y.push(new Te(", "));return y.push(new Te(")")),this.buildQueryFromSourceParams(y,n)}if(b(u,tr))return this.buildQueryFromSourceParams(u.queryChunks,{...n,inlineParams:l||u.shouldInlineParams});if(b(u,P)){let y=u[P.Symbol.Schema],p=u[P.Symbol.Name];return{sql:y===void 0||u[en]?i(p):i(y)+"."+i(p),params:[]}}if(b(u,ce)){let y=s.getColumnCasing(u);if(t.invokeSource==="indexes")return{sql:i(y),params:[]};let p=u.table[P.Symbol.Schema];return{sql:u.table[en]||p===void 0?i(u.table[P.Symbol.Name])+"."+i(y):i(p)+"."+i(u.table[P.Symbol.Name])+"."+i(y),params:[]}}if(b(u,De)){let y=u[me].schema,p=u[me].name;return{sql:y===void 0||u[me].isAlias?i(p):i(y)+"."+i(p),params:[]}}if(b(u,Qe)){if(b(u.value,ct))return{sql:o(f.value++,u),params:[u],typings:["none"]};let y=u.value===null?null:u.encoder.mapToDriverValue(u.value);if(b(y,tr))return this.buildQueryFromSourceParams([y],n);if(l)return{sql:this.mapInlineParam(y,n),params:[]};let p=["none"];return a&&(p=[a(u.encoder)]),{sql:o(f.value++,y),params:[y],typings:p}}return b(u,ct)?{sql:o(f.value++,u),params:[u],typings:["none"]}:b(u,tr.Aliased)&&u.fieldAlias!==void 0?{sql:i(u.fieldAlias),params:[]}:b(u,Se)?u._.isWith?{sql:i(u._.alias),params:[]}:this.buildQueryFromSourceParams([new Te("("),u._.sql,new Te(") "),new rr(u._.alias)],n):Va(u)?u.schema?{sql:i(u.schema)+"."+i(u.enumName),params:[]}:{sql:i(u.enumName),params:[]}:$o(u)?u.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([u.getSQL()],n):this.buildQueryFromSourceParams([new Te("("),u.getSQL(),new Te(")")],n):l?{sql:this.mapInlineParam(u,n),params:[]}:{sql:o(f.value++,u),params:[u],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let n=e.toString();return t(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new tr.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},j=tr;bd=d,c(j,bd,"SQL");var wd,rr=class{constructor(e){c(this,"brand");this.value=e}getSQL(){return new j([this])}};wd=d,c(rr,wd,"Name");function Ga(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var Ja={mapFromDriverValue:r=>r},Ha={mapToDriverValue:r=>r},eb={...Ja,...Ha},vd,Qe=class{constructor(e,t=Ha){c(this,"brand");this.value=e,this.encoder=t}getSQL(){return new j([this])}};vd=d,c(Qe,vd,"Param");function h(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new Te(r[0]));for(let[n,s]of e.entries())t.push(s,new Te(r[n+1]));return new j(t)}(r=>{function e(){return new j([])}r.empty=e;function t(l){return new j(l)}r.fromList=t;function n(l){return new j([new Te(l)])}r.raw=n;function s(l,f){let u=[];for(let[y,p]of l.entries())y>0&&f!==void 0&&u.push(f),u.push(p);return new j(u)}r.join=s;function i(l){return new rr(l)}r.identifier=i;function o(l){return new ct(l)}r.placeholder=o;function a(l,f){return new Qe(l,f)}r.param=a})(h||(h={}));(r=>{var t;let n=class{constructor(i,o){c(this,"isSelectionField",!1);this.sql=i,this.fieldAlias=o}getSQL(){return this.sql}clone(){return new n(this.sql,this.fieldAlias)}},e=n;t=d,c(e,t,"SQL.Aliased"),r.Aliased=e})(j||(j={}));var _d,ct=class{constructor(e){this.name=e}getSQL(){return new j([this])}};_d=d,c(ct,_d,"Placeholder");function Io(r,e){return r.map(t=>{if(b(t,ct)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}if(b(t,Qe)&&b(t.value,ct)){if(!(t.value.name in e))throw new Error(`No value for placeholder "${t.value.name}" was provided`);return t.encoder.mapToDriverValue(e[t.value.name])}return t})}var pd=Symbol.for("drizzle:IsDrizzleView"),Sd,Td,xd,De=class{constructor({name:e,schema:t,selectedFields:n,query:s}){c(this,Td);c(this,xd,!0);this[me]={name:e,originalName:e,schema:t,selectedFields:n,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new j([this])}};Sd=d,Td=me,xd=pd,c(De,Sd,"View");ce.prototype.getSQL=function(){return new j([this])};P.prototype.getSQL=function(){return new j([this])};Se.prototype.getSQL=function(){return new j([this])};var Nd,Ct=class{constructor(e){this.table=e}get(e,t){return t==="table"?this.table:e[t]}};Nd=d,c(Ct,Nd,"ColumnAliasProxyHandler");var Cd,Ft=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}get(e,t){if(t===P.Symbol.IsAlias)return!0;if(t===P.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===P.Symbol.OriginalName)return this.alias;if(t===me)return{...e[me],name:this.alias,isAlias:!0};if(t===P.Symbol.Columns){let s=e[P.Symbol.Columns];if(!s)return s;let i={};return Object.keys(s).map(o=>{i[o]=new Proxy(s[o],new Ct(new Proxy(e,this)))}),i}let n=e[t];return b(n,ce)?new Proxy(n,new Ct(new Proxy(e,this))):n}};Cd=d,c(Ft,Cd,"TableAliasProxyHandler");var Ad,Mo=class{constructor(e){this.alias=e}get(e,t){return t==="sourceTable"?tn(e.sourceTable,this.alias):e[t]}};Ad=d,c(Mo,Ad,"RelationTableAliasProxyHandler");function tn(r,e){return new Proxy(r,new Ft(e,!1))}function lt(r,e){return new Proxy(r,new Ct(new Proxy(r.table,new Ft(e,!1))))}function jo(r,e){return new j.Aliased(rn(r.sql,e),r.fieldAlias)}function rn(r,e){return h.join(r.queryChunks.map(t=>b(t,ce)?lt(t,e):b(t,j)?rn(t,e):b(t,j.Aliased)?jo(t,e):t))}var Pd,Lo=class{constructor(e){c(this,"config");this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===me)return{...e[me],selectedFields:new Proxy(e[me].selectedFields,this)};if(typeof t=="symbol")return e[t];let s=(b(e,Se)?e._.selectedFields:b(e,De)?e[me].selectedFields:e)[t];if(b(s,j.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!s.isSelectionField)return s.sql;let i=s.clone();return i.isSelectionField=!0,i}if(b(s,j)){if(this.config.sqlBehavior==="sql")return s;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return b(s,ce)?this.config.alias?new Proxy(s,new Ct(new Proxy(s.table,new Ft(this.config.alias,this.config.replaceOriginalName??!1)))):s:typeof s!="object"||s===null?s:new Proxy(s,new Lo(this.config))}},ae=Lo;Pd=d,c(ae,Pd,"SelectionProxyHandler");function Ya(r,e,t){let n={},s=r.reduce((i,{path:o,field:a},l)=>{let f;b(a,ce)?f=a:b(a,j)?f=a.decoder:f=a.sql.decoder;let u=i;for(let[y,p]of o.entries())if(y<o.length-1)p in u||(u[p]={}),u=u[p];else{let v=e[l],T=u[p]=v===null?null:f.mapFromDriverValue(v);if(t&&b(a,ce)&&o.length===2){let w=o[0];w in n?typeof n[w]=="string"&&n[w]!==qe(a.table)&&(n[w]=!1):n[w]=T===null?qe(a.table):!1}}return i},{});if(t&&Object.keys(n).length>0)for(let[i,o]of Object.entries(n))typeof o=="string"&&!t[o]&&(s[i]=null);return s}function Ze(r,e){return Object.entries(r).reduce((t,[n,s])=>{if(typeof n!="string")return t;let i=e?[...e,n]:[n];return b(s,ce)||b(s,j)||b(s,j.Aliased)?t.push({path:i,field:s}):b(s,P)?t.push(...Ze(s[P.Symbol.Columns],i)):t.push(...Ze(s,i)),t},[])}function nn(r,e){let t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(let[s,i]of t.entries())if(i!==n[s])return!1;return!0}function as(r,e){let t=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,s])=>b(s,j)||b(s,ce)?[n,s]:[n,new Qe(s,r[P.Symbol.Columns][n])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function Xa(r,e){for(let t of e)for(let n of Object.getOwnPropertyNames(t.prototype))n!=="constructor"&&Object.defineProperty(r.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))}function sn(r){return r[P.Symbol.Columns]}function ht(r){return b(r,Se)?r._.alias:b(r,De)?r[me].name:b(r,j)?void 0:r[P.Symbol.IsAlias]?r[P.Symbol.Name]:r[P.Symbol.BaseName]}function te(r,e){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:e}}function ec(r){if(typeof r!="object"||r===null||r.constructor.name!=="Object")return!1;if("logger"in r){let e=typeof r.logger;return!(e!=="boolean"&&(e!=="object"||typeof r.logger.logQuery!="function")&&e!=="undefined")}if("schema"in r){let e=typeof r.logger;return!(e!=="object"&&e!=="undefined")}if("casing"in r){let e=typeof r.logger;return!(e!=="string"&&e!=="undefined")}if("mode"in r)return!(r.mode!=="default"||r.mode!=="planetscale"||r.mode!==void 0);if("connection"in r){let e=typeof r.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in r){let e=typeof r.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(r).length===0}var Ed,nr=class extends Ee{constructor(t,n,s,i){super();c(this,"config");c(this,"authToken");c(this,"execute",t=>ue.startActiveSpan("drizzle.operation",()=>this._prepare().execute(t,this.authToken)));this.session=n,this.dialect=s,this.config={table:t,withList:i}}where(t){return this.config.where=t,this}returning(t=this.config.table[P.Symbol.Columns]){return this.config.returningFields=t,this.config.returning=Ze(t),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(t){return ue.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,t,!0))}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ae({alias:qe(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};Ed=d,c(nr,Ed,"PgDelete");function Od(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function kd(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,n,s)=>{let i=s===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return t+i},"")}function $d(r){return r}var Id,on=class{constructor(e){c(this,"cache",{});c(this,"cachedTables",{});c(this,"convert");this.convert=e==="snake_case"?Od:e==="camelCase"?kd:$d}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[P.Symbol.Schema]??"public",n=e.table[P.Symbol.OriginalName],s=`${t}.${n}.${e.name}`;return this.cache[s]||this.cacheTable(e.table),this.cache[s]}cacheTable(e){let t=e[P.Symbol.Schema]??"public",n=e[P.Symbol.OriginalName],s=`${t}.${n}`;if(!this.cachedTables[s]){for(let i of Object.values(e[P.Symbol.Columns])){let o=`${s}.${i.name}`;this.cache[o]=this.convert(i.name)}this.cachedTables[s]=!0}}clearCache(){this.cache={},this.cachedTables={}}};Id=d,c(on,Id,"CasingCache");var Md,sr=class extends Error{constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}};Md=d,c(sr,Md,"DrizzleError");var jd,an=class extends sr{constructor(){super({message:"Rollback"})}};jd=d,c(an,jd,"TransactionRollbackError");var Ld,ut=class extends M{generatedAlwaysAsIdentity(e){if(e){let{name:t,...n}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:n}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...n}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:n}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};Ld=d,c(ut,Ld,"PgIntColumnBaseBuilder");var Dd,cs=class extends ut{constructor(e){super(e,"number","PgBigInt53")}build(e){return new ls(e,this.config)}};Dd=d,c(cs,Dd,"PgBigInt53Builder");var Rd,ls=class extends C{getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}};Rd=d,c(ls,Rd,"PgBigInt53");var zd,us=class extends ut{constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new fs(e,this.config)}};zd=d,c(us,zd,"PgBigInt64Builder");var Fd,fs=class extends C{getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};Fd=d,c(fs,Fd,"PgBigInt64");function tc(r,e){let{name:t,config:n}=te(r,e);return n.mode==="number"?new cs(t):new us(t)}var Qd,ds=class extends M{constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new ms(e,this.config)}};Qd=d,c(ds,Qd,"PgBigSerial53Builder");var qd,ms=class extends C{getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}};qd=d,c(ms,qd,"PgBigSerial53");var Bd,hs=class extends M{constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new ps(e,this.config)}};Bd=d,c(hs,Bd,"PgBigSerial64Builder");var Vd,ps=class extends C{getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};Vd=d,c(ps,Vd,"PgBigSerial64");function rc(r,e){let{name:t,config:n}=te(r,e);return n.mode==="number"?new ds(t):new hs(t)}var Ud,gs=class extends M{constructor(e){super(e,"boolean","PgBoolean")}build(e){return new ys(e,this.config)}};Ud=d,c(gs,Ud,"PgBooleanBuilder");var Kd,ys=class extends C{getSQLType(){return"boolean"}};Kd=d,c(ys,Kd,"PgBoolean");function nc(r){return new gs(r??"")}var Zd,bs=class extends M{constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new ws(e,this.config)}};Zd=d,c(bs,Zd,"PgCharBuilder");var Wd,ws=class extends C{constructor(){super(...arguments);c(this,"length",this.config.length);c(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};Wd=d,c(ws,Wd,"PgChar");function sc(r,e={}){let{name:t,config:n}=te(r,e);return new bs(t,n)}var Gd,vs=class extends M{constructor(e){super(e,"string","PgCidr")}build(e){return new _s(e,this.config)}};Gd=d,c(vs,Gd,"PgCidrBuilder");var Jd,_s=class extends C{getSQLType(){return"cidr"}};Jd=d,c(_s,Jd,"PgCidr");function ic(r){return new vs(r??"")}var Hd,Ss=class extends M{constructor(e,t,n){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=n}build(e){return new Ts(e,this.config)}};Hd=d,c(Ss,Hd,"PgCustomColumnBuilder");var Yd,Ts=class extends C{constructor(t,n){super(t,n);c(this,"sqlName");c(this,"mapTo");c(this,"mapFrom");this.sqlName=n.customTypeParams.dataType(n.fieldConfig),this.mapTo=n.customTypeParams.toDriver,this.mapFrom=n.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(t){return typeof this.mapFrom=="function"?this.mapFrom(t):t}mapToDriverValue(t){return typeof this.mapTo=="function"?this.mapTo(t):t}};Yd=d,c(Ts,Yd,"PgCustomColumn");function oc(r){return(e,t)=>{let{name:n,config:s}=te(e,t);return new Ss(n,s,r)}}var Xd,et=class extends M{defaultNow(){return this.default(h`now()`)}};Xd=d,c(et,Xd,"PgDateColumnBaseBuilder");var em,xs=class extends et{constructor(e){super(e,"date","PgDate")}build(e){return new ir(e,this.config)}};em=d,c(xs,em,"PgDateBuilder");var tm,ir=class extends C{getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}};tm=d,c(ir,tm,"PgDate");var rm,Ns=class extends et{constructor(e){super(e,"string","PgDateString")}build(e){return new or(e,this.config)}};rm=d,c(Ns,rm,"PgDateStringBuilder");var nm,or=class extends C{getSQLType(){return"date"}};nm=d,c(or,nm,"PgDateString");function ac(r,e){let{name:t,config:n}=te(r,e);return n?.mode==="date"?new xs(t):new Ns(t)}var sm,Cs=class extends M{constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new As(e,this.config)}};sm=d,c(Cs,sm,"PgDoublePrecisionBuilder");var im,As=class extends C{getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};im=d,c(As,im,"PgDoublePrecision");function cc(r){return new Cs(r??"")}var om,Ps=class extends M{constructor(e){super(e,"string","PgInet")}build(e){return new Es(e,this.config)}};om=d,c(Ps,om,"PgInetBuilder");var am,Es=class extends C{getSQLType(){return"inet"}};am=d,c(Es,am,"PgInet");function lc(r){return new Ps(r??"")}var cm,Os=class extends ut{constructor(e){super(e,"number","PgInteger")}build(e){return new ks(e,this.config)}};cm=d,c(Os,cm,"PgIntegerBuilder");var lm,ks=class extends C{getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};lm=d,c(ks,lm,"PgInteger");function uc(r){return new Os(r??"")}var um,$s=class extends M{constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new Is(e,this.config)}};um=d,c($s,um,"PgIntervalBuilder");var fm,Is=class extends C{constructor(){super(...arguments);c(this,"fields",this.config.intervalConfig.fields);c(this,"precision",this.config.intervalConfig.precision)}getSQLType(){let t=this.fields?` ${this.fields}`:"",n=this.precision?`(${this.precision})`:"";return`interval${t}${n}`}};fm=d,c(Is,fm,"PgInterval");function fc(r,e={}){let{name:t,config:n}=te(r,e);return new $s(t,n)}var dm,Ms=class extends M{constructor(e){super(e,"json","PgJson")}build(e){return new ar(e,this.config)}};dm=d,c(Ms,dm,"PgJsonBuilder");var mm,ar=class extends C{constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};mm=d,c(ar,mm,"PgJson");function dc(r){return new Ms(r??"")}var hm,js=class extends M{constructor(e){super(e,"json","PgJsonb")}build(e){return new cr(e,this.config)}};hm=d,c(js,hm,"PgJsonbBuilder");var pm,cr=class extends C{constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};pm=d,c(cr,pm,"PgJsonb");function mc(r){return new js(r??"")}var gm,Ls=class extends M{constructor(e){super(e,"array","PgLine")}build(e){return new Ds(e,this.config)}};gm=d,c(Ls,gm,"PgLineBuilder");var ym,Ds=class extends C{getSQLType(){return"line"}mapFromDriverValue(e){let[t,n,s]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(n),Number.parseFloat(s)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}};ym=d,c(Ds,ym,"PgLine");var bm,Rs=class extends M{constructor(e){super(e,"json","PgLineABC")}build(e){return new zs(e,this.config)}};bm=d,c(Rs,bm,"PgLineABCBuilder");var wm,zs=class extends C{getSQLType(){return"line"}mapFromDriverValue(e){let[t,n,s]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(n),c:Number.parseFloat(s)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};wm=d,c(zs,wm,"PgLineABC");function hc(r,e){let{name:t,config:n}=te(r,e);return!n?.mode||n.mode==="tuple"?new Ls(t):new Rs(t)}var vm,Fs=class extends M{constructor(e){super(e,"string","PgMacaddr")}build(e){return new Qs(e,this.config)}};vm=d,c(Fs,vm,"PgMacaddrBuilder");var _m,Qs=class extends C{getSQLType(){return"macaddr"}};_m=d,c(Qs,_m,"PgMacaddr");function pc(r){return new Fs(r??"")}var Sm,qs=class extends M{constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Bs(e,this.config)}};Sm=d,c(qs,Sm,"PgMacaddr8Builder");var Tm,Bs=class extends C{getSQLType(){return"macaddr8"}};Tm=d,c(Bs,Tm,"PgMacaddr8");function gc(r){return new qs(r??"")}var xm,Vs=class extends M{constructor(e,t,n){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=n}build(e){return new lr(e,this.config)}};xm=d,c(Vs,xm,"PgNumericBuilder");var Nm,lr=class extends C{constructor(t,n){super(t,n);c(this,"precision");c(this,"scale");this.precision=n.precision,this.scale=n.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};Nm=d,c(lr,Nm,"PgNumeric");function Do(r,e){let{name:t,config:n}=te(r,e);return new Vs(t,n?.precision,n?.scale)}var yc=Do;var Cm,Us=class extends M{constructor(e){super(e,"array","PgPointTuple")}build(e){return new Ks(e,this.config)}};Cm=d,c(Us,Cm,"PgPointTupleBuilder");var Am,Ks=class extends C{getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,n]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(n)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}};Am=d,c(Ks,Am,"PgPointTuple");var Pm,Zs=class extends M{constructor(e){super(e,"json","PgPointObject")}build(e){return new Ws(e,this.config)}};Pm=d,c(Zs,Pm,"PgPointObjectBuilder");var Em,Ws=class extends C{getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,n]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(n)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};Em=d,c(Ws,Em,"PgPointObject");function bc(r,e){let{name:t,config:n}=te(r,e);return!n?.mode||n.mode==="tuple"?new Us(t):new Zs(t)}function Om(r){let e=[];for(let t=0;t<r.length;t+=2)e.push(Number.parseInt(r.slice(t,t+2),16));return new Uint8Array(e)}function wc(r,e){let t=new ArrayBuffer(8),n=new DataView(t);for(let s=0;s<8;s++)n.setUint8(s,r[e+s]);return n.getFloat64(0,!0)}function Ro(r){let e=Om(r),t=0,n=e[t];t+=1;let s=new DataView(e.buffer),i=s.getUint32(t,n===1);t+=4;let o;if(i&536870912&&(o=s.getUint32(t,n===1),t+=4),(i&65535)===1){let a=wc(e,t);t+=8;let l=wc(e,t);return t+=8,[a,l]}throw new Error("Unsupported geometry type")}var km,Gs=class extends M{constructor(e){super(e,"array","PgGeometry")}build(e){return new Js(e,this.config)}};km=d,c(Gs,km,"PgGeometryBuilder");var $m,Js=class extends C{getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Ro(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}};$m=d,c(Js,$m,"PgGeometry");var Im,Hs=class extends M{constructor(e){super(e,"json","PgGeometryObject")}build(e){return new Ys(e,this.config)}};Im=d,c(Hs,Im,"PgGeometryObjectBuilder");var Mm,Ys=class extends C{getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=Ro(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};Mm=d,c(Ys,Mm,"PgGeometryObject");function vc(r,e){let{name:t,config:n}=te(r,e);return!n?.mode||n.mode==="tuple"?new Gs(t):new Hs(t)}var jm,Xs=class extends M{constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new ei(e,this.config)}};jm=d,c(Xs,jm,"PgRealBuilder");var Lm,ei=class extends C{constructor(t,n){super(t,n);c(this,"mapFromDriverValue",t=>typeof t=="string"?Number.parseFloat(t):t)}getSQLType(){return"real"}};Lm=d,c(ei,Lm,"PgReal");function _c(r){return new Xs(r??"")}var Dm,ti=class extends M{constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new ri(e,this.config)}};Dm=d,c(ti,Dm,"PgSerialBuilder");var Rm,ri=class extends C{getSQLType(){return"serial"}};Rm=d,c(ri,Rm,"PgSerial");function Sc(r){return new ti(r??"")}var zm,ni=class extends ut{constructor(e){super(e,"number","PgSmallInt")}build(e){return new si(e,this.config)}};zm=d,c(ni,zm,"PgSmallIntBuilder");var Fm,si=class extends C{constructor(){super(...arguments);c(this,"mapFromDriverValue",t=>typeof t=="string"?Number(t):t)}getSQLType(){return"smallint"}};Fm=d,c(si,Fm,"PgSmallInt");function Tc(r){return new ni(r??"")}var Qm,ii=class extends M{constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new oi(e,this.config)}};Qm=d,c(ii,Qm,"PgSmallSerialBuilder");var qm,oi=class extends C{getSQLType(){return"smallserial"}};qm=d,c(oi,qm,"PgSmallSerial");function xc(r){return new ii(r??"")}var Bm,ai=class extends M{constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new ci(e,this.config)}};Bm=d,c(ai,Bm,"PgTextBuilder");var Vm,ci=class extends C{constructor(){super(...arguments);c(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}};Vm=d,c(ci,Vm,"PgText");function Nc(r,e={}){let{name:t,config:n}=te(r,e);return new ai(t,n)}var Um,li=class extends et{constructor(e,t,n){super(e,"string","PgTime"),this.withTimezone=t,this.precision=n,this.config.withTimezone=t,this.config.precision=n}build(e){return new ur(e,this.config)}};Um=d,c(li,Um,"PgTimeBuilder");var Km,ur=class extends C{constructor(t,n){super(t,n);c(this,"withTimezone");c(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};Km=d,c(ur,Km,"PgTime");function Cc(r,e={}){let{name:t,config:n}=te(r,e);return new li(t,n.withTimezone??!1,n.precision)}var Zm,ui=class extends et{constructor(e,t,n){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=n}build(e){return new fr(e,this.config)}};Zm=d,c(ui,Zm,"PgTimestampBuilder");var Wm,fr=class extends C{constructor(t,n){super(t,n);c(this,"withTimezone");c(this,"precision");c(this,"mapFromDriverValue",t=>new Date(this.withTimezone?t:t+"+0000"));c(this,"mapToDriverValue",t=>t.toISOString());this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}};Wm=d,c(fr,Wm,"PgTimestamp");var Gm,fi=class extends et{constructor(e,t,n){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=n}build(e){return new dr(e,this.config)}};Gm=d,c(fi,Gm,"PgTimestampStringBuilder");var Jm,dr=class extends C{constructor(t,n){super(t,n);c(this,"withTimezone");c(this,"precision");this.withTimezone=n.withTimezone,this.precision=n.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};Jm=d,c(dr,Jm,"PgTimestampString");function Ac(r,e={}){let{name:t,config:n}=te(r,e);return n?.mode==="string"?new fi(t,n.withTimezone??!1,n.precision):new ui(t,n?.withTimezone??!1,n?.precision)}var Hm,di=class extends M{constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(h`gen_random_uuid()`)}build(e){return new mr(e,this.config)}};Hm=d,c(di,Hm,"PgUUIDBuilder");var Ym,mr=class extends C{getSQLType(){return"uuid"}};Ym=d,c(mr,Ym,"PgUUID");function cn(r){return new di(r??"")}var Xm,mi=class extends M{constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new hi(e,this.config)}};Xm=d,c(mi,Xm,"PgVarcharBuilder");var eh,hi=class extends C{constructor(){super(...arguments);c(this,"length",this.config.length);c(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};eh=d,c(hi,eh,"PgVarchar");function hr(r,e={}){let{name:t,config:n}=te(r,e);return new mi(t,n)}var th,pi=class extends M{constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new gi(e,this.config)}};th=d,c(pi,th,"PgBinaryVectorBuilder");var rh,gi=class extends C{constructor(){super(...arguments);c(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}};rh=d,c(gi,rh,"PgBinaryVector");function Pc(r,e){let{name:t,config:n}=te(r,e);return new pi(t,n)}var nh,yi=class extends M{constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new bi(e,this.config)}};nh=d,c(yi,nh,"PgHalfVectorBuilder");var sh,bi=class extends C{constructor(){super(...arguments);c(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(t){return JSON.stringify(t)}mapFromDriverValue(t){return t.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};sh=d,c(bi,sh,"PgHalfVector");function Ec(r,e){let{name:t,config:n}=te(r,e);return new yi(t,n)}var ih,wi=class extends M{constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new vi(e,this.config)}};ih=d,c(wi,ih,"PgSparseVectorBuilder");var oh,vi=class extends C{constructor(){super(...arguments);c(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}};oh=d,c(vi,oh,"PgSparseVector");function Oc(r,e){let{name:t,config:n}=te(r,e);return new wi(t,n)}var ah,_i=class extends M{constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new Si(e,this.config)}};ah=d,c(_i,ah,"PgVectorBuilder");var ch,Si=class extends C{constructor(){super(...arguments);c(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(t){return JSON.stringify(t)}mapFromDriverValue(t){return t.slice(1,-1).split(",").map(n=>Number.parseFloat(n))}};ch=d,c(Si,ch,"PgVector");function kc(r,e){let{name:t,config:n}=te(r,e);return new _i(t,n)}function $c(){return{bigint:tc,bigserial:rc,boolean:nc,char:sc,cidr:ic,customType:oc,date:ac,doublePrecision:cc,inet:lc,integer:uc,interval:fc,json:dc,jsonb:mc,line:hc,macaddr:pc,macaddr8:gc,numeric:Do,point:bc,geometry:vc,real:_c,serial:Sc,smallint:Tc,smallserial:xc,text:Nc,time:Cc,timestamp:Ac,uuid:cn,varchar:hr,bit:Pc,halfvec:Ec,sparsevec:Oc,vector:kc}}var zo=Symbol.for("drizzle:PgInlineForeignKeys"),Ic=Symbol.for("drizzle:EnableRLS"),lh,uh,fh,dh,mh,Ce=class extends P{constructor(){super(...arguments);c(this,uh,[]);c(this,fh,!1);c(this,dh);c(this,mh,{})}};lh=d,uh=zo,fh=Ic,dh=P.Symbol.ExtraConfigBuilder,mh=P.Symbol.ExtraConfigColumns,c(Ce,lh,"PgTable"),c(Ce,"Symbol",Object.assign({},P.Symbol,{InlineForeignKeys:zo,EnableRLS:Ic}));function Fo(r,e,t,n,s=r){let i=new Ce(r,n,s),o=typeof e=="function"?e($c()):e,a=Object.fromEntries(Object.entries(o).map(([u,y])=>{let p=y;p.setName(u);let v=p.build(i);return i[zo].push(...p.buildForeignKeys(v,i)),[u,v]})),l=Object.fromEntries(Object.entries(o).map(([u,y])=>{let p=y;p.setName(u);let v=p.buildExtraConfigColumn(i);return[u,v]})),f=Object.assign(i,a);return f[P.Symbol.Columns]=a,f[P.Symbol.ExtraConfigColumns]=l,t&&(f[Ce.Symbol.ExtraConfigBuilder]=t),Object.assign(f,{enableRLS:()=>(f[Ce.Symbol.EnableRLS]=!0,f)})}var Qo=(r,e,t)=>Fo(r,e,t,void 0);var hh,ln=class{constructor(e,t){c(this,"columns");c(this,"name");this.columns=e,this.name=t}build(e){return new Ti(e,this.columns,this.name)}};hh=d,c(ln,hh,"PgPrimaryKeyBuilder");var ph,Ti=class{constructor(e,t,n){c(this,"columns");c(this,"name");this.table=e,this.columns=t,this.name=n}getName(){return this.name??`${this.table[Ce.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};ph=d,c(Ti,ph,"PgPrimaryKey");function Be(r,e){return Ga(e)&&!$o(r)&&!b(r,Qe)&&!b(r,ct)&&!b(r,ce)&&!b(r,P)&&!b(r,De)?new Qe(r,e):r}var Qt=(r,e)=>h`${r} = ${Be(e,r)}`,Mc=(r,e)=>h`${r} <> ${Be(e,r)}`;function un(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new j(e):new j([new Te("("),h.join(e,new Te(" and ")),new Te(")")])}function jc(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new j(e):new j([new Te("("),h.join(e,new Te(" or ")),new Te(")")])}function Lc(r){return h`not ${r}`}var Dc=(r,e)=>h`${r} > ${Be(e,r)}`,Rc=(r,e)=>h`${r} >= ${Be(e,r)}`,zc=(r,e)=>h`${r} < ${Be(e,r)}`,Fc=(r,e)=>h`${r} <= ${Be(e,r)}`;function Qc(r,e){return Array.isArray(e)?e.length===0?h`false`:h`${r} in ${e.map(t=>Be(t,r))}`:h`${r} in ${Be(e,r)}`}function qc(r,e){return Array.isArray(e)?e.length===0?h`true`:h`${r} not in ${e.map(t=>Be(t,r))}`:h`${r} not in ${Be(e,r)}`}function Bc(r){return h`${r} is null`}function Vc(r){return h`${r} is not null`}function Uc(r){return h`exists ${r}`}function Kc(r){return h`not exists ${r}`}function Zc(r,e,t){return h`${r} between ${Be(e,r)} and ${Be(t,r)}`}function Wc(r,e,t){return h`${r} not between ${Be(e,r)} and ${Be(t,r)}`}function xi(r,e){return h`${r} like ${e}`}function Gc(r,e){return h`${r} not like ${e}`}function Jc(r,e){return h`${r} ilike ${e}`}function Hc(r,e){return h`${r} not ilike ${e}`}function Yc(r){return h`${r} asc`}function Xc(r){return h`${r} desc`}var bh,fn=class{constructor(e,t,n){c(this,"referencedTableName");c(this,"fieldName");this.sourceTable=e,this.referencedTable=t,this.relationName=n,this.referencedTableName=t[P.Symbol.Name]}};bh=d,c(fn,bh,"Relation");var wh,Ni=class{constructor(e,t){this.table=e,this.config=t}};wh=d,c(Ni,wh,"Relations");var vh,qo=class extends fn{constructor(e,t,n,s){super(e,t,n?.relationName),this.config=n,this.isNullable=s}withFieldName(e){let t=new qo(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},pt=qo;vh=d,c(pt,vh,"One");var _h,Bo=class extends fn{constructor(e,t,n){super(e,t,n?.relationName),this.config=n}withFieldName(e){let t=new Bo(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}},pr=Bo;_h=d,c(pr,_h,"Many");function el(){return{and:un,between:Zc,eq:Qt,exists:Uc,gt:Dc,gte:Rc,ilike:Jc,inArray:Qc,isNull:Bc,isNotNull:Vc,like:xi,lt:zc,lte:Fc,ne:Mc,not:Lc,notBetween:Wc,notExists:Kc,notLike:Gc,notIlike:Hc,notInArray:qc,or:jc,sql:h}}function tl(){return{sql:h,asc:Yc,desc:Xc}}function rl(r,e){Object.keys(r).length===1&&"default"in r&&!b(r.default,P)&&(r=r.default);let t={},n={},s={};for(let[i,o]of Object.entries(r))if(b(o,P)){let a=zt(o),l=n[a];t[a]=i,s[i]={tsName:i,dbName:o[P.Symbol.Name],schema:o[P.Symbol.Schema],columns:o[P.Symbol.Columns],relations:l?.relations??{},primaryKey:l?.primaryKey??[]};for(let u of Object.values(o[P.Symbol.Columns]))u.primary&&s[i].primaryKey.push(u);let f=o[P.Symbol.ExtraConfigBuilder]?.(o[P.Symbol.ExtraConfigColumns]);if(f)for(let u of Object.values(f))b(u,ln)&&s[i].primaryKey.push(...u.columns)}else if(b(o,Ni)){let a=zt(o.table),l=t[a],f=o.config(e(o.table)),u;for(let[y,p]of Object.entries(f))if(l){let v=s[l];v.relations[y]=p,u&&v.primaryKey.push(...u)}else a in n||(n[a]={relations:{},primaryKey:u}),n[a].relations[y]=p}return{tables:s,tableNamesMap:t}}function gh(r){return function(t,n){return new pt(r,t,n,n?.fields.reduce((s,i)=>s&&i.notNull,!0)??!1)}}function yh(r){return function(t,n){return new pr(r,t,n)}}function nl(r,e,t){if(b(t,pt)&&t.config)return{fields:t.config.fields,references:t.config.references};let n=e[zt(t.referencedTable)];if(!n)throw new Error(`Table "${t.referencedTable[P.Symbol.Name]}" not found in schema`);let s=r[n];if(!s)throw new Error(`Table "${n}" not found in schema`);let i=t.sourceTable,o=e[zt(i)];if(!o)throw new Error(`Table "${i[P.Symbol.Name]}" not found in schema`);let a=[];for(let l of Object.values(s.relations))(t.relationName&&t!==l&&l.relationName===t.relationName||!t.relationName&&l.referencedTable===t.sourceTable)&&a.push(l);if(a.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${n}"`):new Error(`There are multiple relations between "${n}" and "${t.sourceTable[P.Symbol.Name]}". Please specify relation name`);if(a[0]&&b(a[0],pt)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${t.fieldName}"`)}function sl(r){return{one:gh(r),many:yh(r)}}function Ci(r,e,t,n,s=i=>i){let i={};for(let[o,a]of n.entries())if(a.isJson){let l=e.relations[a.tsKey],f=t[o],u=typeof f=="string"?JSON.parse(f):f;i[a.tsKey]=b(l,pt)?u&&Ci(r,r[a.relationTableTsKey],u,a.selection,s):u.map(y=>Ci(r,r[a.relationTableTsKey],y,a.selection,s))}else{let l=s(t[o]),f=a.field,u;b(f,ce)?u=f:b(f,j)?u=f.decoder:u=f.sql.decoder,i[a.tsKey]=l===null?null:u.mapFromDriverValue(l)}return i}var Sh,ft=class extends De{};Sh=d,c(ft,Sh,"PgViewBase");var Th,gt=class{constructor(e){c(this,"casing");this.casing=new on(e?.casing)}async migrate(e,t,n){let s=typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",i=typeof n=="string"?"drizzle":n.migrationsSchema??"drizzle",o=h`
			CREATE TABLE IF NOT EXISTS ${h.identifier(i)}.${h.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(i)}`),await t.execute(o);let l=(await t.all(h`select id, hash, created_at from ${h.identifier(i)}.${h.identifier(s)} order by created_at desc limit 1`))[0];await t.transaction(async f=>{for await(let u of e)if(!l||Number(l.created_at)<u.folderMillis){for(let y of u.sql)await f.execute(h.raw(y));await f.execute(h`insert into ${h.identifier(i)}.${h.identifier(s)} ("hash", "created_at") values(${u.hash}, ${u.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[h`with `];for(let[n,s]of e.entries())t.push(h`${h.identifier(s._.alias)} as (${s._.sql})`),n<e.length-1&&t.push(h`, `);return t.push(h` `),h.join(t)}buildDeleteQuery({table:e,where:t,returning:n,withList:s}){let i=this.buildWithCTE(s),o=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,a=t?h` where ${t}`:void 0;return h`${i}delete from ${e}${a}${o}`}buildUpdateSet(e,t){let n=e[P.Symbol.Columns],s=Object.keys(n).filter(o=>t[o]!==void 0||n[o]?.onUpdateFn!==void 0),i=s.length;return h.join(s.flatMap((o,a)=>{let l=n[o],f=t[o]??h.param(l.onUpdateFn(),l),u=h`${h.identifier(this.casing.getColumnCasing(l))} = ${f}`;return a<i-1?[u,h.raw(", ")]:[u]}))}buildUpdateQuery({table:e,set:t,where:n,returning:s,withList:i,from:o,joins:a}){let l=this.buildWithCTE(i),f=e[Ce.Symbol.Name],u=e[Ce.Symbol.Schema],y=e[Ce.Symbol.OriginalName],p=f===y?void 0:f,v=h`${u?h`${h.identifier(u)}.`:void 0}${h.identifier(y)}${p&&h` ${h.identifier(p)}`}`,T=this.buildUpdateSet(e,t),w=o&&h.join([h.raw(" from "),this.buildFromTable(o)]),L=this.buildJoins(a),N=s?h` returning ${this.buildSelection(s,{isSingleTable:!o})}`:void 0,q=n?h` where ${n}`:void 0;return h`${l}update ${v} set ${T}${w}${L}${q}${N}`}buildSelection(e,{isSingleTable:t=!1}={}){let n=e.length,s=e.flatMap(({field:i},o)=>{let a=[];if(b(i,j.Aliased)&&i.isSelectionField)a.push(h.identifier(i.fieldAlias));else if(b(i,j.Aliased)||b(i,j)){let l=b(i,j.Aliased)?i.sql:i;t?a.push(new j(l.queryChunks.map(f=>b(f,C)?h.identifier(this.casing.getColumnCasing(f)):f))):a.push(l),b(i,j.Aliased)&&a.push(h` as ${h.identifier(i.fieldAlias)}`)}else b(i,ce)&&(t?a.push(h.identifier(this.casing.getColumnCasing(i))):a.push(i));return o<n-1&&a.push(h`, `),a});return h.join(s)}buildJoins(e){if(!e||e.length===0)return;let t=[];for(let[n,s]of e.entries()){n===0&&t.push(h` `);let i=s.table,o=s.lateral?h` lateral`:void 0;if(b(i,Ce)){let a=i[Ce.Symbol.Name],l=i[Ce.Symbol.Schema],f=i[Ce.Symbol.OriginalName],u=a===f?void 0:s.alias;t.push(h`${h.raw(s.joinType)} join${o} ${l?h`${h.identifier(l)}.`:void 0}${h.identifier(f)}${u&&h` ${h.identifier(u)}`} on ${s.on}`)}else if(b(i,De)){let a=i[me].name,l=i[me].schema,f=i[me].originalName,u=a===f?void 0:s.alias;t.push(h`${h.raw(s.joinType)} join${o} ${l?h`${h.identifier(l)}.`:void 0}${h.identifier(f)}${u&&h` ${h.identifier(u)}`} on ${s.on}`)}else t.push(h`${h.raw(s.joinType)} join${o} ${i} on ${s.on}`);n<e.length-1&&t.push(h` `)}return h.join(t)}buildFromTable(e){if(b(e,P)&&e[P.Symbol.OriginalName]!==e[P.Symbol.Name]){let t=h`${h.identifier(e[P.Symbol.OriginalName])}`;return e[P.Symbol.Schema]&&(t=h`${h.identifier(e[P.Symbol.Schema])}.${t}`),h`${t} ${h.identifier(e[P.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:n,where:s,having:i,table:o,joins:a,orderBy:l,groupBy:f,limit:u,offset:y,lockingClause:p,distinct:v,setOperators:T}){let w=n??Ze(t);for(let ie of w)if(b(ie.field,ce)&&qe(ie.field.table)!==(b(o,Se)?o._.alias:b(o,ft)?o[me].name:b(o,j)?void 0:qe(o))&&!(he=>a?.some(({alias:pe})=>pe===(he[P.Symbol.IsAlias]?qe(he):he[P.Symbol.BaseName])))(ie.field.table)){let he=qe(ie.field.table);throw new Error(`Your "${ie.path.join("->")}" field references a column "${he}"."${ie.field.name}", but the table "${he}" is not part of the query! Did you forget to join it?`)}let L=!a||a.length===0,N=this.buildWithCTE(e),q;v&&(q=v===!0?h` distinct`:h` distinct on (${h.join(v.on,h`, `)})`);let z=this.buildSelection(w,{isSingleTable:L}),I=this.buildFromTable(o),D=this.buildJoins(a),H=s?h` where ${s}`:void 0,O=i?h` having ${i}`:void 0,F;l&&l.length>0&&(F=h` order by ${h.join(l,h`, `)}`);let Z;f&&f.length>0&&(Z=h` group by ${h.join(f,h`, `)}`);let S=typeof u=="object"||typeof u=="number"&&u>=0?h` limit ${u}`:void 0,W=y?h` offset ${y}`:void 0,V=h.empty();if(p){let ie=h` for ${h.raw(p.strength)}`;p.config.of&&ie.append(h` of ${h.join(Array.isArray(p.config.of)?p.config.of:[p.config.of],h`, `)}`),p.config.noWait?ie.append(h` no wait`):p.config.skipLocked&&ie.append(h` skip locked`),V.append(ie)}let G=h`${N}select${q} ${z} from ${I}${D}${H}${Z}${O}${F}${S}${W}${V}`;return T.length>0?this.buildSetOperations(G,T):G}buildSetOperations(e,t){let[n,...s]=t;if(!n)throw new Error("Cannot pass undefined values to any set operator");return s.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:n,rightSelect:s,limit:i,orderBy:o,offset:a}}){let l=h`(${e.getSQL()}) `,f=h`(${s.getSQL()})`,u;if(o&&o.length>0){let T=[];for(let w of o)if(b(w,C))T.push(h.identifier(w.name));else if(b(w,j)){for(let L=0;L<w.queryChunks.length;L++){let N=w.queryChunks[L];b(N,C)&&(w.queryChunks[L]=h.identifier(N.name))}T.push(h`${w}`)}else T.push(h`${w}`);u=h` order by ${h.join(T,h`, `)} `}let y=typeof i=="object"||typeof i=="number"&&i>=0?h` limit ${i}`:void 0,p=h.raw(`${t} ${n?"all ":""}`),v=a?h` offset ${a}`:void 0;return h`${l}${p}${f}${u}${y}${v}`}buildInsertQuery({table:e,values:t,onConflict:n,returning:s,withList:i,select:o,overridingSystemValue_:a}){let l=[],f=e[P.Symbol.Columns],u=Object.entries(f).filter(([N,q])=>!q.shouldDisableInsert()),y=u.map(([,N])=>h.identifier(this.casing.getColumnCasing(N)));if(o){let N=t;b(N,j)?l.push(N):l.push(N.getSQL())}else{let N=t;l.push(h.raw("values "));for(let[q,z]of N.entries()){let I=[];for(let[D,H]of u){let O=z[D];if(O===void 0||b(O,Qe)&&O.value===void 0)if(H.defaultFn!==void 0){let F=H.defaultFn(),Z=b(F,j)?F:h.param(F,H);I.push(Z)}else if(!H.default&&H.onUpdateFn!==void 0){let F=H.onUpdateFn(),Z=b(F,j)?F:h.param(F,H);I.push(Z)}else I.push(h`default`);else I.push(O)}l.push(I),q<N.length-1&&l.push(h`, `)}}let p=this.buildWithCTE(i),v=h.join(l),T=s?h` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,w=n?h` on conflict ${n}`:void 0,L=a===!0?h`overriding system value `:void 0;return h`${p}insert into ${e} ${y} ${L}${v}${w}${T}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:n}){let s=t?h` concurrently`:void 0,i=n?h` with no data`:void 0;return h`refresh materialized view${s} ${e}${i}`}prepareTyping(e){return b(e,cr)||b(e,ar)?"json":b(e,lr)?"decimal":b(e,ur)?"time":b(e,fr)||b(e,dr)?"timestamp":b(e,ir)||b(e,or)?"date":b(e,mr)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:n,table:s,tableConfig:i,queryConfig:o,tableAlias:a,nestedQueryRelation:l,joinOn:f}){let u=[],y,p,v=[],T,w=[];if(o===!0)u=Object.entries(i.columns).map(([q,z])=>({dbKey:z.name,tsKey:q,field:lt(z,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let N=Object.fromEntries(Object.entries(i.columns).map(([O,F])=>[O,lt(F,a)]));if(o.where){let O=typeof o.where=="function"?o.where(N,el()):o.where;T=O&&rn(O,a)}let q=[],z=[];if(o.columns){let O=!1;for(let[F,Z]of Object.entries(o.columns))Z!==void 0&&F in i.columns&&(!O&&Z===!0&&(O=!0),z.push(F));z.length>0&&(z=O?z.filter(F=>o.columns?.[F]===!0):Object.keys(i.columns).filter(F=>!z.includes(F)))}else z=Object.keys(i.columns);for(let O of z){let F=i.columns[O];q.push({tsKey:O,value:F})}let I=[];o.with&&(I=Object.entries(o.with).filter(O=>!!O[1]).map(([O,F])=>({tsKey:O,queryConfig:F,relation:i.relations[O]})));let D;if(o.extras){D=typeof o.extras=="function"?o.extras(N,{sql:h}):o.extras;for(let[O,F]of Object.entries(D))q.push({tsKey:O,value:jo(F,a)})}for(let{tsKey:O,value:F}of q)u.push({dbKey:b(F,j.Aliased)?F.fieldAlias:i.columns[O].name,tsKey:O,field:b(F,ce)?lt(F,a):F,relationTableTsKey:void 0,isJson:!1,selection:[]});let H=typeof o.orderBy=="function"?o.orderBy(N,tl()):o.orderBy??[];Array.isArray(H)||(H=[H]),v=H.map(O=>b(O,ce)?lt(O,a):rn(O,a)),y=o.limit,p=o.offset;for(let{tsKey:O,queryConfig:F,relation:Z}of I){let S=nl(t,n,Z),W=zt(Z.referencedTable),V=n[W],G=`${a}_${O}`,ie=un(...S.fields.map((ze,_)=>Qt(lt(S.references[_],G),lt(ze,a)))),he=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:n,table:e[V],tableConfig:t[V],queryConfig:b(Z,pt)?F===!0?{limit:1}:{...F,limit:1}:F,tableAlias:G,joinOn:ie,nestedQueryRelation:Z}),pe=h`${h.identifier(G)}.${h.identifier("data")}`.as(O);w.push({on:h`true`,table:new Se(he.sql,{},G),alias:G,joinType:"left",lateral:!0}),u.push({dbKey:O,tsKey:O,field:pe,relationTableTsKey:V,isJson:!0,selection:he.selection})}}if(u.length===0)throw new sr({message:`No fields selected for table "${i.tsName}" ("${a}")`});let L;if(T=un(f,T),l){let N=h`json_build_array(${h.join(u.map(({field:I,tsKey:D,isJson:H})=>H?h`${h.identifier(`${a}_${D}`)}.${h.identifier("data")}`:b(I,j.Aliased)?I.sql:I),h`, `)})`;b(l,pr)&&(N=h`coalesce(json_agg(${N}${v.length>0?h` order by ${h.join(v,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:N.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:u}];y!==void 0||p!==void 0||v.length>0?(L=this.buildSelectQuery({table:tn(s,a),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:T,limit:y,offset:p,orderBy:v,setOperators:[]}),T=void 0,y=void 0,p=void 0,v=[]):L=tn(s,a),L=this.buildSelectQuery({table:b(L,Ce)?L:new Se(L,{},a),fields:{},fieldsFlat:q.map(({field:I})=>({path:[],field:b(I,ce)?lt(I,a):I})),joins:w,where:T,limit:y,offset:p,orderBy:v,setOperators:[]})}else L=this.buildSelectQuery({table:tn(s,a),fields:{},fieldsFlat:u.map(({field:N})=>({path:[],field:b(N,ce)?lt(N,a):N})),joins:w,where:T,limit:y,offset:p,orderBy:v,setOperators:[]});return{tableTsKey:i.tsName,sql:L,selection:u}}};Th=d,c(gt,Th,"PgDialect");var xh,dn=class{getSelectedFields(){return this._.selectedFields}};xh=d,c(dn,xh,"TypedQueryBuilder");var $h,Oe=class{constructor(e){c(this,"fields");c(this,"session");c(this,"dialect");c(this,"withList",[]);c(this,"distinct");c(this,"authToken");this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}setToken(e){return this.authToken=e,this}from(e){let t=!!this.fields,n=e,s;return this.fields?s=this.fields:b(n,Se)?s=Object.fromEntries(Object.keys(n._.selectedFields).map(i=>[i,n[i]])):b(n,ft)?s=n[me].selectedFields:b(n,j)?s={}:s=sn(n),new mn({table:n,fields:s,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}};$h=d,c(Oe,$h,"PgSelectBuilder");var Ih,Ai=class extends dn{constructor({table:t,fields:n,isPartialSelect:s,session:i,dialect:o,withList:a,distinct:l}){super();c(this,"_");c(this,"config");c(this,"joinsNotNullableMap");c(this,"tableName");c(this,"isPartialSelect");c(this,"session");c(this,"dialect");c(this,"leftJoin",this.createJoin("left"));c(this,"rightJoin",this.createJoin("right"));c(this,"innerJoin",this.createJoin("inner"));c(this,"fullJoin",this.createJoin("full"));c(this,"union",this.createSetOperator("union",!1));c(this,"unionAll",this.createSetOperator("union",!0));c(this,"intersect",this.createSetOperator("intersect",!1));c(this,"intersectAll",this.createSetOperator("intersect",!0));c(this,"except",this.createSetOperator("except",!1));c(this,"exceptAll",this.createSetOperator("except",!0));this.config={withList:a,table:t,fields:{...n},distinct:l,setOperators:[]},this.isPartialSelect=s,this.session=i,this.dialect=o,this._={selectedFields:n},this.tableName=ht(t),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(t){return(n,s)=>{let i=this.tableName,o=ht(n);if(typeof o=="string"&&this.config.joins?.some(a=>a.alias===o))throw new Error(`Alias "${o}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof o=="string"&&!b(n,j))){let a=b(n,Se)?n._.selectedFields:b(n,De)?n[me].selectedFields:n[P.Symbol.Columns];this.config.fields[o]=a}if(typeof s=="function"&&(s=s(new Proxy(this.config.fields,new ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:s,table:n,joinType:t,alias:o}),typeof o=="string")switch(t){case"left":{this.joinsNotNullableMap[o]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[o]=!0;break}case"inner":{this.joinsNotNullableMap[o]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[o]=!1;break}}return this}}createSetOperator(t,n){return s=>{let i=typeof s=="function"?s(Nh()):s;if(!nn(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:t,isAll:n,rightSelect:i}),this}}addSetOperators(t){return this.config.setOperators.push(...t),this}where(t){return typeof t=="function"&&(t=t(new Proxy(this.config.fields,new ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=t,this}having(t){return typeof t=="function"&&(t=t(new Proxy(this.config.fields,new ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=t,this}groupBy(...t){if(typeof t[0]=="function"){let n=t[0](new Proxy(this.config.fields,new ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(n)?n:[n]}else this.config.groupBy=t;return this}orderBy(...t){if(typeof t[0]=="function"){let n=t[0](new Proxy(this.config.fields,new ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(n)?n:[n];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}else{let n=t;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}return this}limit(t){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=t:this.config.limit=t,this}offset(t){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=t:this.config.offset=t,this}for(t,n={}){return this.config.lockingClause={strength:t,config:n},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}as(t){return new Proxy(new Se(this.getSQL(),this.config.fields,t),new ae({alias:t,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}};Ih=d,c(Ai,Ih,"PgSelectQueryBuilder");var Mh,mn=class extends Ai{constructor(){super(...arguments);c(this,"authToken");c(this,"execute",t=>ue.startActiveSpan("drizzle.operation",()=>this._prepare().execute(t,this.authToken)))}_prepare(t){let{session:n,config:s,dialect:i,joinsNotNullableMap:o,authToken:a}=this;if(!n)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ue.startActiveSpan("drizzle.prepareQuery",()=>{let l=Ze(s.fields),f=n.prepareQuery(i.sqlToQuery(this.getSQL()),l,t,!0);return f.joinsNotNullableMap=o,f.setToken(a)})}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}};Mh=d,c(mn,Mh,"PgSelect");Xa(mn,[Ee]);function gr(r,e){return(t,n,...s)=>{let i=[n,...s].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of i)if(!nn(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(i)}}var Nh=()=>({union:Ch,unionAll:Ah,intersect:Ph,intersectAll:Eh,except:Oh,exceptAll:kh}),Ch=gr("union",!1),Ah=gr("union",!0),Ph=gr("intersect",!1),Eh=gr("intersect",!0),Oh=gr("except",!1),kh=gr("except",!0);var jh,dt=class{constructor(e){c(this,"dialect");c(this,"dialectConfig");c(this,"$with",(e,t)=>{let n=this;return{as:i=>(typeof i=="function"&&(i=i(n)),new Proxy(new Rt(i.getSQL(),t??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}});this.dialect=b(e,gt)?e:void 0,this.dialectConfig=b(e,gt)?void 0:e}with(...e){let t=this;function n(o){return new Oe({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function s(o){return new Oe({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function i(o,a){return new Oe({fields:a??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:o}})}return{select:n,selectDistinct:s,selectDistinctOn:i}}select(e){return new Oe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Oe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new Oe({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new gt(this.dialectConfig)),this.dialect}};jh=d,c(dt,jh,"PgQueryBuilder");var Lh,yr=class{constructor(e,t,n,s,i){c(this,"authToken");this.table=e,this.session=t,this.dialect=n,this.withList=s,this.overridingSystemValue_=i}setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(n=>{let s={},i=this.table[P.Symbol.Columns];for(let o of Object.keys(n)){let a=n[o];s[o]=b(a,j)?a:new Qe(a,i[o])}return s});return new hn(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t=typeof e=="function"?e(new dt):e;if(!b(t,j)&&!nn(this.table[os],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new hn(this.table,t,this.session,this.dialect,this.withList,!0)}};Lh=d,c(yr,Lh,"PgInsertBuilder");var Dh,hn=class extends Ee{constructor(t,n,s,i,o,a,l){super();c(this,"config");c(this,"authToken");c(this,"execute",t=>ue.startActiveSpan("drizzle.operation",()=>this._prepare().execute(t,this.authToken)));this.session=s,this.dialect=i,this.config={table:t,values:n,withList:o,select:a,overridingSystemValue_:l}}returning(t=this.config.table[P.Symbol.Columns]){return this.config.returningFields=t,this.config.returning=Ze(t),this}onConflictDoNothing(t={}){if(t.target===void 0)this.config.onConflict=h`do nothing`;else{let n="";n=Array.isArray(t.target)?t.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(t.target));let s=t.where?h` where ${t.where}`:void 0;this.config.onConflict=h`(${h.raw(n)})${s} do nothing`}return this}onConflictDoUpdate(t){if(t.where&&(t.targetWhere||t.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let n=t.where?h` where ${t.where}`:void 0,s=t.targetWhere?h` where ${t.targetWhere}`:void 0,i=t.setWhere?h` where ${t.setWhere}`:void 0,o=this.dialect.buildUpdateSet(this.config.table,as(this.config.table,t.set)),a="";return a=Array.isArray(t.target)?t.target.map(l=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(l))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(t.target)),this.config.onConflict=h`(${h.raw(a)})${s} do update set ${o}${n}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(t){return ue.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,t,!0))}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ae({alias:qe(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};Dh=d,c(hn,Dh,"PgInsert");var Rh,pn=class extends Ee{constructor(t,n,s){super();c(this,"config");c(this,"authToken");c(this,"execute",t=>ue.startActiveSpan("drizzle.operation",()=>this._prepare().execute(t,this.authToken)));this.session=n,this.dialect=s,this.config={view:t}}concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(t){return ue.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,t,!0))}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}};Rh=d,c(pn,Rh,"PgRefreshMaterializedView");var zh,br=class{constructor(e,t,n,s){c(this,"authToken");this.table=e,this.session=t,this.dialect=n,this.withList=s}setToken(e){return this.authToken=e,this}set(e){return new Pi(this.table,as(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}};zh=d,c(br,zh,"PgUpdateBuilder");var Fh,Pi=class extends Ee{constructor(t,n,s,i,o){super();c(this,"config");c(this,"tableName");c(this,"joinsNotNullableMap");c(this,"leftJoin",this.createJoin("left"));c(this,"rightJoin",this.createJoin("right"));c(this,"innerJoin",this.createJoin("inner"));c(this,"fullJoin",this.createJoin("full"));c(this,"authToken");c(this,"execute",t=>this._prepare().execute(t,this.authToken));this.session=s,this.dialect=i,this.config={set:n,table:t,withList:o,joins:[]},this.tableName=ht(t),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}from(t){let n=t,s=ht(n);return typeof s=="string"&&(this.joinsNotNullableMap[s]=!0),this.config.from=n,this}getTableLikeFields(t){return b(t,Ce)?t[P.Symbol.Columns]:b(t,Se)?t._.selectedFields:t[me].selectedFields}createJoin(t){return(n,s)=>{let i=ht(n);if(typeof i=="string"&&this.config.joins.some(o=>o.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof s=="function"){let o=this.config.from&&!b(this.config.from,j)?this.getTableLikeFields(this.config.from):void 0;s=s(new Proxy(this.config.table[P.Symbol.Columns],new ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),o&&new Proxy(o,new ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:s,table:n,joinType:t,alias:i}),typeof i=="string")switch(t){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}where(t){return this.config.where=t,this}returning(t){if(!t&&(t=Object.assign({},this.config.table[P.Symbol.Columns]),this.config.from)){let n=ht(this.config.from);if(typeof n=="string"&&this.config.from&&!b(this.config.from,j)){let s=this.getTableLikeFields(this.config.from);t[n]=s}for(let s of this.config.joins){let i=ht(s.table);if(typeof i=="string"&&!b(s.table,j)){let o=this.getTableLikeFields(s.table);t[i]=o}}}return this.config.returningFields=t,this.config.returning=Ze(t),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:t,...n}=this.dialect.sqlToQuery(this.getSQL());return n}_prepare(t){let n=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,t,!0);return n.joinsNotNullableMap=this.joinsNotNullableMap,n}prepare(t){return this._prepare(t)}setToken(t){return this.authToken=t,this}getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ae({alias:qe(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};Fh=d,c(Pi,Fh,"PgUpdate");var Qh,qh,Ei=class extends j{constructor(t){super(Ei.buildEmbeddedCount(t.source,t.filters).queryChunks);c(this,"sql");c(this,"token");c(this,qh,"PgCountBuilder");c(this,"session");this.params=t,this.mapWith(Number),this.session=t.session,this.sql=Ei.buildCount(t.source,t.filters)}static buildEmbeddedCount(t,n){return h`(select count(*) from ${t}${h.raw(" where ").if(n)}${n})`}static buildCount(t,n){return h`select count(*) as count from ${t}${h.raw(" where ").if(n)}${n};`}setToken(t){return this.token=t,this}then(t,n){return Promise.resolve(this.session.count(this.sql,this.token)).then(t,n)}catch(t){return this.then(void 0,t)}finally(t){return this.then(n=>(t?.(),n),n=>{throw t?.(),n})}},gn=Ei;Qh=d,qh=Symbol.toStringTag,c(gn,Qh,"PgCountBuilder");var Bh,yn=class{constructor(e,t,n,s,i,o,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=s,this.tableConfig=i,this.dialect=o,this.session=a}findMany(e){return new bn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new bn(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}};Bh=d,c(yn,Bh,"PgRelationalQueryBuilder");var Vh,bn=class extends Ee{constructor(t,n,s,i,o,a,l,f,u){super();c(this,"authToken");this.fullSchema=t,this.schema=n,this.tableNamesMap=s,this.table=i,this.tableConfig=o,this.dialect=a,this.session=l,this.config=f,this.mode=u}_prepare(t){return ue.startActiveSpan("drizzle.prepareQuery",()=>{let{query:n,builtQuery:s}=this._toSQL();return this.session.prepareQuery(s,void 0,t,!0,(i,o)=>{let a=i.map(l=>Ci(this.schema,this.tableConfig,l,n.selection,o));return this.mode==="first"?a[0]:a})})}prepare(t){return this._prepare(t)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let t=this._getQuery(),n=this.dialect.sqlToQuery(t.sql);return{query:t,builtQuery:n}}toSQL(){return this._toSQL().builtQuery}setToken(t){return this.authToken=t,this}execute(){return ue.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};Vh=d,c(bn,Vh,"PgRelationalQuery");var Uh,wn=class extends Ee{constructor(e,t,n,s){super(),this.execute=e,this.sql=t,this.query=n,this.mapBatchResult=s}getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};Uh=d,c(wn,Uh,"PgRaw");var Kh,qt=class{constructor(e,t,n){c(this,"query");c(this,"$with",(e,t)=>{let n=this;return{as:i=>(typeof i=="function"&&(i=i(new dt(n.dialect))),new Proxy(new Rt(i.getSQL(),t??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}});c(this,"authToken");if(this.dialect=e,this.session=t,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[s,i]of Object.entries(this._.schema))this.query[s]=new yn(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[s],i,e,t)}$count(e,t){return new gn({source:e,filters:t,session:this.session})}with(...e){let t=this;function n(f){return new Oe({fields:f??void 0,session:t.session,dialect:t.dialect,withList:e})}function s(f){return new Oe({fields:f??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function i(f,u){return new Oe({fields:u??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:f}})}function o(f){return new br(f,t.session,t.dialect,e)}function a(f){return new yr(f,t.session,t.dialect,e)}function l(f){return new nr(f,t.session,t.dialect,e)}return{select:n,selectDistinct:s,selectDistinctOn:i,update:o,insert:a,delete:l}}select(e){return new Oe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Oe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new Oe({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new br(e,this.session,this.dialect)}insert(e){return new yr(e,this.session,this.dialect)}delete(e){return new nr(e,this.session,this.dialect)}refreshMaterializedView(e){return new pn(e,this.session,this.dialect)}execute(e){let t=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(t),s=this.session.prepareQuery(n,void 0,void 0,!1);return new wn(()=>s.execute(void 0,this.authToken),t,n,i=>s.mapResult(i,!0))}transaction(e,t){return this.session.transaction(e,t)}};Kh=d,c(qt,Kh,"PgDatabase");var Zh,Oi=class{constructor(e,t,n){this.seqName=e,this.seqOptions=t,this.schema=n}};Zh=d,c(Oi,Zh,"PgSequence");function il(r,e,t){return new Oi(r,e,t)}var Vo=Symbol.for("drizzle:PgViewConfig");var Wh,vn=class{constructor(e,t){c(this,"config",{});this.name=e,this.schema=t}with(e){return this.config.with=e,this}};Wh=d,c(vn,Wh,"PgDefaultViewBuilderCore");var Gh,ki=class extends vn{as(e){typeof e=="function"&&(e=e(new dt));let t=new ae({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),n=new Proxy(e.getSelectedFields(),t);return new Proxy(new wr({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:n,query:e.getSQL().inlineParams()}}),t)}};Gh=d,c(ki,Gh,"PgViewBuilder");var Jh,$i=class extends vn{constructor(t,n,s){super(t,s);c(this,"columns");this.columns=sn(Qo(t,n))}existing(){return new Proxy(new wr({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new ae({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(t){return new Proxy(new wr({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:t.inlineParams()}}),new ae({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}};Jh=d,c($i,Jh,"PgManualViewBuilder");var Hh,_n=class{constructor(e,t){c(this,"config",{});this.name=e,this.schema=t}using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}};Hh=d,c(_n,Hh,"PgMaterializedViewBuilderCore");var Yh,Ii=class extends _n{as(e){typeof e=="function"&&(e=e(new dt));let t=new ae({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),n=new Proxy(e.getSelectedFields(),t);return new Proxy(new vr({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:n,query:e.getSQL().inlineParams()}}),t)}};Yh=d,c(Ii,Yh,"PgMaterializedViewBuilder");var Xh,Mi=class extends _n{constructor(t,n,s){super(t,s);c(this,"columns");this.columns=sn(Qo(t,n))}existing(){return new Proxy(new vr({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new ae({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(t){return new Proxy(new vr({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:t.inlineParams()}}),new ae({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}};Xh=d,c(Mi,Xh,"PgManualMaterializedViewBuilder");var ep,tp,wr=class extends ft{constructor({pgConfig:t,config:n}){super(n);c(this,tp);t&&(this[Vo]={with:t.with})}};ep=d,tp=Vo,c(wr,ep,"PgView");var ol=Symbol.for("drizzle:PgMaterializedViewConfig"),rp,np,vr=class extends ft{constructor({pgConfig:t,config:n}){super(n);c(this,np);this[ol]={with:t?.with,using:t?.using,tablespace:t?.tablespace,withNoData:t?.withNoData}}};rp=d,np=ol,c(vr,rp,"PgMaterializedView");function al(r,e,t){return e?new $i(r,e,t):new ki(r,t)}function cl(r,e,t){return e?new Mi(r,e,t):new Ii(r,t)}var sp,ji=class{constructor(e){c(this,"table",(e,t,n)=>Fo(e,t,n,this.schemaName));c(this,"view",(e,t)=>al(e,t,this.schemaName));c(this,"materializedView",(e,t)=>cl(e,t,this.schemaName));c(this,"enum",(e,t)=>Ua(e,t,this.schemaName));c(this,"sequence",(e,t)=>il(e,t,this.schemaName));this.schemaName=e}getSQL(){return new j([h.identifier(this.schemaName)])}shouldOmitSQLParens(){return!0}};sp=d,c(ji,sp,"PgSchema");function ll(r){if(r==="public")throw new Error("You can't specify 'public' as schema name. Postgres is using public schema by default. If you want to use 'public' schema, just use pgTable() instead of creating a schema");return new ji(r)}var ip,Sn=class{constructor(e){c(this,"authToken");c(this,"joinsNotNullableMap");this.query=e}getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}};ip=d,c(Sn,ip,"PgPreparedQuery");var op,Tn=class{constructor(e){this.dialect=e}execute(e,t){return ue.startActiveSpan("drizzle.operation",()=>ue.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){let n=await this.execute(e,t);return Number(n[0].count)}};op=d,c(Tn,op,"PgSession");var ap,xn=class extends qt{constructor(e,t,n,s=0){super(e,t,n),this.schema=n,this.nestedIndex=s}rollback(){throw new an}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),h.raw(t.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};ap=d,c(xn,ap,"PgTransaction");var cp,Li=class extends Sn{constructor(e,t,n,s,i,o,a){super({sql:t,params:n}),this.client=e,this.queryString=t,this.params=n,this.logger=s,this.fields=i,this._isResponseInArrayMode=o,this.customResultMapper=a}async execute(e={}){return ue.startActiveSpan("drizzle.execute",async t=>{let n=Io(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(n)}),this.logger.logQuery(this.queryString,n);let{fields:s,queryString:i,client:o,joinsNotNullableMap:a,customResultMapper:l}=this;if(!s&&!l)return ue.startActiveSpan("drizzle.driver.execute",()=>o.unsafe(i,n));let f=await ue.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":i,"drizzle.query.params":JSON.stringify(n)}),o.unsafe(i,n).values()));return ue.startActiveSpan("drizzle.mapResponse",()=>l?l(f):f.map(u=>Ya(s,u,a)))})}all(e={}){return ue.startActiveSpan("drizzle.execute",async t=>{let n=Io(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(n)}),this.logger.logQuery(this.queryString,n),ue.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(n)}),this.client.unsafe(this.queryString,n)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}};cp=d,c(Li,cp,"PostgresJsPreparedQuery");var lp,Uo=class extends Tn{constructor(t,n,s,i={}){super(n);c(this,"logger");this.client=t,this.schema=s,this.options=i,this.logger=i.logger??new Hr}prepareQuery(t,n,s,i,o){return new Li(this.client,t.sql,t.params,this.logger,n,i,o)}query(t,n){return this.logger.logQuery(t,n),this.client.unsafe(t,n).values()}queryObjects(t,n){return this.client.unsafe(t,n)}transaction(t,n){return this.client.begin(async s=>{let i=new Uo(s,this.dialect,this.schema,this.options),o=new Di(this.dialect,i,this.schema);return n&&await o.setTransaction(n),t(o)})}},_r=Uo;lp=d,c(_r,lp,"PostgresJsSession");var up,Ko=class extends xn{constructor(e,t,n,s=0){super(e,t,n,s),this.session=t}transaction(e){return this.session.client.savepoint(t=>{let n=new _r(t,this.dialect,this.schema,this.session.options),s=new Ko(this.dialect,n,this.schema);return e(s)})}},Di=Ko;up=d,c(Di,up,"PostgresJsTransaction");var fp,Ri=class extends qt{};fp=d,c(Ri,fp,"PostgresJsDatabase");function Sr(r,e={}){let t=l=>l;for(let l of["1184","1082","1083","1114"])r.options.parsers[l]=t,r.options.serializers[l]=t;r.options.serializers[114]=t,r.options.serializers[3802]=t;let n=new gt({casing:e.casing}),s;e.logger===!0?s=new Jr:e.logger!==!1&&(s=e.logger);let i;if(e.schema){let l=rl(e.schema,sl);i={fullSchema:e.schema,schema:l.tables,tableNamesMap:l.tableNamesMap}}let o=new _r(r,n,i,{logger:s}),a=new Ri(n,o,i);return a.$client=r,a}function zi(...r){if(typeof r[0]=="string"){let e=er(r[0]);return Sr(e,r[1])}if(ec(r[0])){let{connection:e,client:t,...n}=r[0];if(t)return Sr(t,n);if(typeof e=="object"&&e.url!==void 0){let{url:i,...o}=e,a=er(i,o);return Sr(a,n)}let s=er(e);return Sr(s,n)}return Sr(r[0],r[1])}(r=>{function e(t){return Sr({options:{parsers:{},serializers:{}}},t)}r.mock=e})(zi||(zi={}));var Vt=at(sa(),1),bt=at(Vl(),1);function Yp(){bt.PojosMetadataMap.create("Listing",{id:String,title:String,price:Number,purchaseType:String,sellerId:String}),bt.PojosMetadataMap.create("ListingApiQuery",{searchTitle:String,condition:String,proximityMiles:String,searchMatchMode:String}),bt.PojosMetadataMap.create("ListingApiQueryUnstructured",{searchTitle:String,condition:String,proximityMiles:String,searchMatchMode:String}),bt.PojosMetadataMap.create("ListingOutputDto",{id:String,title:String,price:Number,purchaseType:String,sellerId:String}),bt.PojosMetadataMap.create("ListingInputDto",{title:String,price:Number,purchaseType:String,sellerId:String}),bt.PojosMetadataMap.create("ListingTable",{id:String,title:String,price:Number,purchaseType:String,sellerId:String})}Yp();var Nr=(0,Vt.createMapper)({strategyInitializer:(0,bt.pojos)()});(0,Vt.createMap)(Nr,"Listing","ListingOutputDto");(0,Vt.createMap)(Nr,"ListingInputDto","Listing");(0,Vt.createMap)(Nr,"ListingTable","Listing");(0,Vt.createMap)(Nr,"ListingApiQueryUnstructured","ListingApiQuery");var Xp=ll("delivery_service"),Cr=Xp.table("deliveries",{title:hr().notNull(),sellerId:cn("seller_id").notNull(),purchaseType:hr("purchase_type").default("SALE"),id:cn("id").defaultRandom().primaryKey(),price:yc().notNull(),condition:hr()});var Ki=class{constructor(e,t){this._dbClient=e;this._mapper=t}async create(e){let[t]=await this._dbClient.insert(Cr).values(e).returning();return this._mapper.map(t,"ListingTable","Listing")}async getAllByQuery(e){let t=this._dbClient.select().from(Cr).where(Qt(Cr.condition,"NEW")).$dynamic();console.log(e),e.searchTitle&&(e.searchMatchMode==="FUZZY"?t.where(xi(Cr.title,`%${e.searchTitle}%`)):t.where(Qt(Cr.title,e.searchTitle)));let n=await t;if(!n.length)throw new Error("no listings found matching filters");return n.map(s=>this._mapper.map(s,"ListingTable","Listing"))}};var ru=at(Zl(),1);var se;(function(r){r.assertEqual=s=>s;function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let o of s)i[o]=o;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(a=>typeof s[s[a]]!="number"),o={};for(let a of i)o[a]=s[a];return r.objectValues(o)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.push(o);return i},r.find=(s,i)=>{for(let o of s)if(i(o))return o},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(se||(se={}));var Wl;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Wl||(Wl={}));var k=se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Et=r=>{switch(typeof r){case"undefined":return k.undefined;case"string":return k.string;case"number":return isNaN(r)?k.nan:k.number;case"boolean":return k.boolean;case"function":return k.function;case"bigint":return k.bigint;case"symbol":return k.symbol;case"object":return Array.isArray(r)?k.array:r===null?k.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?k.promise:typeof Map<"u"&&r instanceof Map?k.map:typeof Set<"u"&&r instanceof Set?k.set:typeof Date<"u"&&r instanceof Date?k.date:k.object;default:return k.unknown}},x=se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var Re=class extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)n._errors.push(t(o));else{let a=n,l=0;for(;l<o.path.length;){let f=o.path[l];l===o.path.length-1?(a[f]=a[f]||{_errors:[]},a[f]._errors.push(t(o))):a[f]=a[f]||{_errors:[]},a=a[f],l++}}};return s(this),n}static assert(e){if(!(e instanceof Re))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};Re.create=r=>new Re(r);var En=(r,e)=>{let t;switch(r.code){case x.invalid_type:r.received===k.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case x.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,se.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:t=`Unrecognized key(s) in object: ${se.joinValues(r.keys,", ")}`;break;case x.invalid_union:t="Invalid input";break;case x.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${se.joinValues(r.options)}`;break;case x.invalid_enum_value:t=`Invalid enum value. Expected ${se.joinValues(r.options)}, received '${r.received}'`;break;case x.invalid_arguments:t="Invalid function arguments";break;case x.invalid_return_type:t="Invalid function return type";break;case x.invalid_date:t="Invalid date";break;case x.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:se.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case x.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case x.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case x.custom:t="Invalid input";break;case x.invalid_intersection_types:t="Intersection results could not be merged";break;case x.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case x.not_finite:t="Number must be finite";break;default:t=e.defaultError,se.assertNever(r)}return{message:t}},cg=En;function aa(){return cg}var ca=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],o={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let a="",l=n.filter(f=>!!f).slice().reverse();for(let f of l)a=f(o,{data:e,defaultError:a}).message;return{...s,path:i,message:a}};function E(r,e){let t=aa(),n=ca({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===En?void 0:En].filter(s=>!!s)});r.common.issues.push(n)}var ke=class{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return K;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t){let i=await s.key,o=await s.value;n.push({key:i,value:o})}return ke.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:o}=s;if(i.status==="aborted"||o.status==="aborted")return K;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(n[i.value]=o.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Cn=r=>({status:"dirty",value:r}),Ve=r=>({status:"valid",value:r}),Gl=r=>r.status==="aborted",Jl=r=>r.status==="dirty",Pr=r=>r.status==="valid",Zi=r=>typeof Promise<"u"&&r instanceof Promise;function Wi(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}function Yl(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t}var R;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(R||(R={}));var An,Pn,Ge=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Hl=(r,e)=>{if(Pr(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Re(r.common.issues);return this._error=t,this._error}}};function J(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,a)=>{var l,f;let{message:u}=r;return o.code==="invalid_enum_value"?{message:u??a.defaultError}:typeof a.data>"u"?{message:(l=u??n)!==null&&l!==void 0?l:a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:(f=u??t)!==null&&f!==void 0?f:a.defaultError}},description:s}}var Y=class{get description(){return this._def.description}_getType(e){return Et(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Et(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ke,ctx:{common:e.parent.common,data:e.data,parsedType:Et(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Zi(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;let s={common:{issues:[],async:(n=t?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Et(e)},i=this._parseSync({data:e,path:s.path,parent:s});return Hl(s,i)}"~validate"(e){var t,n;let s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Et(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:s});return Pr(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((n=(t=i?.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>Pr(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Et(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(Zi(s)?s:Promise.resolve(s));return Hl(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let o=e(s),a=()=>i.addIssue({code:x.custom,...n(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new st({schema:this,typeName:U.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return rt.create(this,this._def)}nullable(){return _t.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return We.create(this)}promise(){return Zt.create(this,this._def)}or(e){return kr.create([this,e],this._def)}and(e){return $r.create(this,e,this._def)}transform(e){return new st({...J(this._def),schema:this,typeName:U.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Dr({...J(this._def),innerType:this,defaultValue:t,typeName:U.ZodDefault})}brand(){return new Gi({typeName:U.ZodBranded,type:this,...J(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Rr({...J(this._def),innerType:this,catchValue:t,typeName:U.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return zr.create(this,e)}readonly(){return Fr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},lg=/^c[^\s-]{8,}$/i,ug=/^[0-9a-z]+$/,fg=/^[0-9A-HJKMNP-TV-Z]{26}$/i,dg=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,mg=/^[a-z0-9_-]{21}$/i,hg=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,pg=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,gg=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,yg="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",oa,bg=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wg=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,vg=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,_g=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Sg=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Tg=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Xl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",xg=new RegExp(`^${Xl}$`);function eu(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Ng(r){return new RegExp(`^${eu(r)}$`)}function Cg(r){let e=`${Xl}T${eu(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Ag(r,e){return!!((e==="v4"||!e)&&bg.test(r)||(e==="v6"||!e)&&vg.test(r))}function Pg(r,e){if(!hg.test(r))return!1;try{let[t]=r.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function Eg(r,e){return!!((e==="v4"||!e)&&wg.test(r)||(e==="v6"||!e)&&_g.test(r))}var tt=class extends Y{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==k.string){let i=this._getOrReturnCtx(e);return E(i,{code:x.invalid_type,expected:k.string,received:i.parsedType}),K}let n=new ke,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(s=this._getOrReturnCtx(e,s),o?E(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&E(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")gg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"email",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")oa||(oa=new RegExp(yg,"u")),oa.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"emoji",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")dg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"uuid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")mg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"nanoid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")lg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cuid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")ug.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cuid2",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")fg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"ulid",code:x.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),E(s,{validation:"url",code:x.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"regex",code:x.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?Cg(i).test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?xg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Ng(i).test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{code:x.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?pg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"duration",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?Ag(e.data,i.version)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"ip",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?Pg(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"jwt",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?Eg(e.data,i.version)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"cidr",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Sg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"base64",code:x.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?Tg.test(e.data)||(s=this._getOrReturnCtx(e,s),E(s,{validation:"base64url",code:x.invalid_string,message:i.message}),n.dirty()):se.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:x.invalid_string,...R.errToObj(n)})}_addCheck(e){return new tt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...R.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...R.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...R.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...R.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...R.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...R.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...R.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...R.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...R.errToObj(t)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new tt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new tt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new tt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};tt.create=r=>{var e;return new tt({checks:[],typeName:U.ZodString,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...J(r)})};function Og(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=parseInt(r.toFixed(s).replace(".","")),o=parseInt(e.toFixed(s).replace(".",""));return i%o/Math.pow(10,s)}var kt=class extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==k.number){let i=this._getOrReturnCtx(e);return E(i,{code:x.invalid_type,expected:k.number,received:i.parsedType}),K}let n,s=new ke;for(let i of this._def.checks)i.kind==="int"?se.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:x.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?Og(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:x.not_finite,message:i.message}),s.dirty()):se.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,R.toString(t))}gt(e,t){return this.setLimit("min",e,!1,R.toString(t))}lte(e,t){return this.setLimit("max",e,!0,R.toString(t))}lt(e,t){return this.setLimit("max",e,!1,R.toString(t))}setLimit(e,t,n,s){return new kt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:R.toString(s)}]})}_addCheck(e){return new kt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&se.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};kt.create=r=>new kt({checks:[],typeName:U.ZodNumber,coerce:r?.coerce||!1,...J(r)});var $t=class extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==k.bigint)return this._getInvalidInput(e);let n,s=new ke;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):se.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return E(t,{code:x.invalid_type,expected:k.bigint,received:t.parsedType}),K}gte(e,t){return this.setLimit("min",e,!0,R.toString(t))}gt(e,t){return this.setLimit("min",e,!1,R.toString(t))}lte(e,t){return this.setLimit("max",e,!0,R.toString(t))}lt(e,t){return this.setLimit("max",e,!1,R.toString(t))}setLimit(e,t,n,s){return new $t({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:R.toString(s)}]})}_addCheck(e){return new $t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};$t.create=r=>{var e;return new $t({checks:[],typeName:U.ZodBigInt,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...J(r)})};var On=class extends Y{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==k.boolean){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.boolean,received:n.parsedType}),K}return Ve(e.data)}};On.create=r=>new On({typeName:U.ZodBoolean,coerce:r?.coerce||!1,...J(r)});var Kt=class extends Y{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==k.date){let i=this._getOrReturnCtx(e);return E(i,{code:x.invalid_type,expected:k.date,received:i.parsedType}),K}if(isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return E(i,{code:x.invalid_date}),K}let n=new ke,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:x.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),E(s,{code:x.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):se.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Kt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Kt.create=r=>new Kt({checks:[],coerce:r?.coerce||!1,typeName:U.ZodDate,...J(r)});var kn=class extends Y{_parse(e){if(this._getType(e)!==k.symbol){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.symbol,received:n.parsedType}),K}return Ve(e.data)}};kn.create=r=>new kn({typeName:U.ZodSymbol,...J(r)});var Er=class extends Y{_parse(e){if(this._getType(e)!==k.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.undefined,received:n.parsedType}),K}return Ve(e.data)}};Er.create=r=>new Er({typeName:U.ZodUndefined,...J(r)});var Or=class extends Y{_parse(e){if(this._getType(e)!==k.null){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.null,received:n.parsedType}),K}return Ve(e.data)}};Or.create=r=>new Or({typeName:U.ZodNull,...J(r)});var $n=class extends Y{constructor(){super(...arguments),this._any=!0}_parse(e){return Ve(e.data)}};$n.create=r=>new $n({typeName:U.ZodAny,...J(r)});var Ot=class extends Y{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ve(e.data)}};Ot.create=r=>new Ot({typeName:U.ZodUnknown,...J(r)});var mt=class extends Y{_parse(e){let t=this._getOrReturnCtx(e);return E(t,{code:x.invalid_type,expected:k.never,received:t.parsedType}),K}};mt.create=r=>new mt({typeName:U.ZodNever,...J(r)});var In=class extends Y{_parse(e){if(this._getType(e)!==k.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.void,received:n.parsedType}),K}return Ve(e.data)}};In.create=r=>new In({typeName:U.ZodVoid,...J(r)});var We=class extends Y{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==k.array)return E(t,{code:x.invalid_type,expected:k.array,received:t.parsedType}),K;if(s.exactLength!==null){let o=t.data.length>s.exactLength.value,a=t.data.length<s.exactLength.value;(o||a)&&(E(t,{code:o?x.too_big:x.too_small,minimum:a?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(E(t,{code:x.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(E(t,{code:x.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>s.type._parseAsync(new Ge(t,o,t.path,a)))).then(o=>ke.mergeArray(n,o));let i=[...t.data].map((o,a)=>s.type._parseSync(new Ge(t,o,t.path,a)));return ke.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new We({...this._def,minLength:{value:e,message:R.toString(t)}})}max(e,t){return new We({...this._def,maxLength:{value:e,message:R.toString(t)}})}length(e,t){return new We({...this._def,exactLength:{value:e,message:R.toString(t)}})}nonempty(e){return this.min(1,e)}};We.create=(r,e)=>new We({type:r,minLength:null,maxLength:null,exactLength:null,typeName:U.ZodArray,...J(e)});function Ar(r){if(r instanceof we){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=rt.create(Ar(n))}return new we({...r._def,shape:()=>e})}else return r instanceof We?new We({...r._def,type:Ar(r.element)}):r instanceof rt?rt.create(Ar(r.unwrap())):r instanceof _t?_t.create(Ar(r.unwrap())):r instanceof nt?nt.create(r.items.map(e=>Ar(e))):r}var we=class extends Y{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=se.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==k.object){let f=this._getOrReturnCtx(e);return E(f,{code:x.invalid_type,expected:k.object,received:f.parsedType}),K}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof mt&&this._def.unknownKeys==="strip"))for(let f in s.data)o.includes(f)||a.push(f);let l=[];for(let f of o){let u=i[f],y=s.data[f];l.push({key:{status:"valid",value:f},value:u._parse(new Ge(s,y,s.path,f)),alwaysSet:f in s.data})}if(this._def.catchall instanceof mt){let f=this._def.unknownKeys;if(f==="passthrough")for(let u of a)l.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(f==="strict")a.length>0&&(E(s,{code:x.unrecognized_keys,keys:a}),n.dirty());else if(f!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let f=this._def.catchall;for(let u of a){let y=s.data[u];l.push({key:{status:"valid",value:u},value:f._parse(new Ge(s,y,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let f=[];for(let u of l){let y=await u.key,p=await u.value;f.push({key:y,value:p,alwaysSet:u.alwaysSet})}return f}).then(f=>ke.mergeObjectSync(n,f)):ke.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new we({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var s,i,o,a;let l=(o=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,n).message)!==null&&o!==void 0?o:n.defaultError;return t.code==="unrecognized_keys"?{message:(a=R.errToObj(e).message)!==null&&a!==void 0?a:l}:{message:l}}}:{}})}strip(){return new we({...this._def,unknownKeys:"strip"})}passthrough(){return new we({...this._def,unknownKeys:"passthrough"})}extend(e){return new we({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new we({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:U.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new we({...this._def,catchall:e})}pick(e){let t={};return se.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new we({...this._def,shape:()=>t})}omit(e){let t={};return se.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new we({...this._def,shape:()=>t})}deepPartial(){return Ar(this)}partial(e){let t={};return se.objectKeys(this.shape).forEach(n=>{let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}),new we({...this._def,shape:()=>t})}required(e){let t={};return se.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof rt;)i=i._def.innerType;t[n]=i}}),new we({...this._def,shape:()=>t})}keyof(){return tu(se.objectKeys(this.shape))}};we.create=(r,e)=>new we({shape:()=>r,unknownKeys:"strip",catchall:mt.create(),typeName:U.ZodObject,...J(e)});we.strictCreate=(r,e)=>new we({shape:()=>r,unknownKeys:"strict",catchall:mt.create(),typeName:U.ZodObject,...J(e)});we.lazycreate=(r,e)=>new we({shape:r,unknownKeys:"strip",catchall:mt.create(),typeName:U.ZodObject,...J(e)});var kr=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let a of i)if(a.result.status==="valid")return a.result;for(let a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(a=>new Re(a.ctx.common.issues));return E(t,{code:x.invalid_union,unionErrors:o}),K}if(t.common.async)return Promise.all(n.map(async i=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(s);{let i,o=[];for(let l of n){let f={...t,common:{...t.common,issues:[]},parent:null},u=l._parseSync({data:t.data,path:t.path,parent:f});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:f}),f.common.issues.length&&o.push(f.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let a=o.map(l=>new Re(l));return E(t,{code:x.invalid_union,unionErrors:a}),K}}get options(){return this._def.options}};kr.create=(r,e)=>new kr({options:r,typeName:U.ZodUnion,...J(e)});var wt=r=>r instanceof Mr?wt(r.schema):r instanceof st?wt(r.innerType()):r instanceof jr?[r.value]:r instanceof vt?r.options:r instanceof Lr?se.objectValues(r.enum):r instanceof Dr?wt(r._def.innerType):r instanceof Er?[void 0]:r instanceof Or?[null]:r instanceof rt?[void 0,...wt(r.unwrap())]:r instanceof _t?[null,...wt(r.unwrap())]:r instanceof Gi||r instanceof Fr?wt(r.unwrap()):r instanceof Rr?wt(r._def.innerType):[],Mn=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.object)return E(t,{code:x.invalid_type,expected:k.object,received:t.parsedType}),K;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(E(t,{code:x.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),K)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let o=wt(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(s.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);s.set(a,i)}}return new Mn({typeName:U.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...J(n)})}};function la(r,e){let t=Et(r),n=Et(e);if(r===e)return{valid:!0,data:r};if(t===k.object&&n===k.object){let s=se.objectKeys(e),i=se.objectKeys(r).filter(a=>s.indexOf(a)!==-1),o={...r,...e};for(let a of i){let l=la(r[a],e[a]);if(!l.valid)return{valid:!1};o[a]=l.data}return{valid:!0,data:o}}else if(t===k.array&&n===k.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let o=r[i],a=e[i],l=la(o,a);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===k.date&&n===k.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var $r=class extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,o)=>{if(Gl(i)||Gl(o))return K;let a=la(i.value,o.value);return a.valid?((Jl(i)||Jl(o))&&t.dirty(),{status:t.value,value:a.data}):(E(n,{code:x.invalid_intersection_types}),K)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,o])=>s(i,o)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};$r.create=(r,e,t)=>new $r({left:r,right:e,typeName:U.ZodIntersection,...J(t)});var nt=class extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.array)return E(n,{code:x.invalid_type,expected:k.array,received:n.parsedType}),K;if(n.data.length<this._def.items.length)return E(n,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),K;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((o,a)=>{let l=this._def.items[a]||this._def.rest;return l?l._parse(new Ge(n,o,n.path,a)):null}).filter(o=>!!o);return n.common.async?Promise.all(i).then(o=>ke.mergeArray(t,o)):ke.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new nt({...this._def,rest:e})}};nt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new nt({items:r,typeName:U.ZodTuple,rest:null,...J(e)})};var Ir=class extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.object)return E(n,{code:x.invalid_type,expected:k.object,received:n.parsedType}),K;let s=[],i=this._def.keyType,o=this._def.valueType;for(let a in n.data)s.push({key:i._parse(new Ge(n,a,n.path,a)),value:o._parse(new Ge(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?ke.mergeObjectAsync(t,s):ke.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof Y?new Ir({keyType:e,valueType:t,typeName:U.ZodRecord,...J(n)}):new Ir({keyType:tt.create(),valueType:e,typeName:U.ZodRecord,...J(t)})}},jn=class extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.map)return E(n,{code:x.invalid_type,expected:k.map,received:n.parsedType}),K;let s=this._def.keyType,i=this._def.valueType,o=[...n.data.entries()].map(([a,l],f)=>({key:s._parse(new Ge(n,a,n.path,[f,"key"])),value:i._parse(new Ge(n,l,n.path,[f,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let l of o){let f=await l.key,u=await l.value;if(f.status==="aborted"||u.status==="aborted")return K;(f.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(f.value,u.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let l of o){let f=l.key,u=l.value;if(f.status==="aborted"||u.status==="aborted")return K;(f.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(f.value,u.value)}return{status:t.value,value:a}}}};jn.create=(r,e,t)=>new jn({valueType:e,keyType:r,typeName:U.ZodMap,...J(t)});var It=class extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==k.set)return E(n,{code:x.invalid_type,expected:k.set,received:n.parsedType}),K;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(E(n,{code:x.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(E(n,{code:x.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function o(l){let f=new Set;for(let u of l){if(u.status==="aborted")return K;u.status==="dirty"&&t.dirty(),f.add(u.value)}return{status:t.value,value:f}}let a=[...n.data.values()].map((l,f)=>i._parse(new Ge(n,l,n.path,f)));return n.common.async?Promise.all(a).then(l=>o(l)):o(a)}min(e,t){return new It({...this._def,minSize:{value:e,message:R.toString(t)}})}max(e,t){return new It({...this._def,maxSize:{value:e,message:R.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};It.create=(r,e)=>new It({valueType:r,minSize:null,maxSize:null,typeName:U.ZodSet,...J(e)});var Ut=class extends Y{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.function)return E(t,{code:x.invalid_type,expected:k.function,received:t.parsedType}),K;function n(a,l){return ca({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,aa(),En].filter(f=>!!f),issueData:{code:x.invalid_arguments,argumentsError:l}})}function s(a,l){return ca({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,aa(),En].filter(f=>!!f),issueData:{code:x.invalid_return_type,returnTypeError:l}})}let i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof Zt){let a=this;return Ve(async function(...l){let f=new Re([]),u=await a._def.args.parseAsync(l,i).catch(v=>{throw f.addIssue(n(l,v)),f}),y=await Reflect.apply(o,this,u);return await a._def.returns._def.type.parseAsync(y,i).catch(v=>{throw f.addIssue(s(y,v)),f})})}else{let a=this;return Ve(function(...l){let f=a._def.args.safeParse(l,i);if(!f.success)throw new Re([n(l,f.error)]);let u=Reflect.apply(o,this,f.data),y=a._def.returns.safeParse(u,i);if(!y.success)throw new Re([s(u,y.error)]);return y.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ut({...this._def,args:nt.create(e).rest(Ot.create())})}returns(e){return new Ut({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new Ut({args:e||nt.create([]).rest(Ot.create()),returns:t||Ot.create(),typeName:U.ZodFunction,...J(n)})}},Mr=class extends Y{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Mr.create=(r,e)=>new Mr({getter:r,typeName:U.ZodLazy,...J(e)});var jr=class extends Y{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return E(t,{received:t.data,code:x.invalid_literal,expected:this._def.value}),K}return{status:"valid",value:e.data}}get value(){return this._def.value}};jr.create=(r,e)=>new jr({value:r,typeName:U.ZodLiteral,...J(e)});function tu(r,e){return new vt({values:r,typeName:U.ZodEnum,...J(e)})}var vt=class extends Y{constructor(){super(...arguments),An.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return E(t,{expected:se.joinValues(n),received:t.parsedType,code:x.invalid_type}),K}if(Wi(this,An,"f")||Yl(this,An,new Set(this._def.values),"f"),!Wi(this,An,"f").has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return E(t,{received:t.data,code:x.invalid_enum_value,options:n}),K}return Ve(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return vt.create(e,{...this._def,...t})}exclude(e,t=this._def){return vt.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};An=new WeakMap;vt.create=tu;var Lr=class extends Y{constructor(){super(...arguments),Pn.set(this,void 0)}_parse(e){let t=se.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==k.string&&n.parsedType!==k.number){let s=se.objectValues(t);return E(n,{expected:se.joinValues(s),received:n.parsedType,code:x.invalid_type}),K}if(Wi(this,Pn,"f")||Yl(this,Pn,new Set(se.getValidEnumValues(this._def.values)),"f"),!Wi(this,Pn,"f").has(e.data)){let s=se.objectValues(t);return E(n,{received:n.data,code:x.invalid_enum_value,options:s}),K}return Ve(e.data)}get enum(){return this._def.values}};Pn=new WeakMap;Lr.create=(r,e)=>new Lr({values:r,typeName:U.ZodNativeEnum,...J(e)});var Zt=class extends Y{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==k.promise&&t.common.async===!1)return E(t,{code:x.invalid_type,expected:k.promise,received:t.parsedType}),K;let n=t.parsedType===k.promise?t.data:Promise.resolve(t.data);return Ve(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Zt.create=(r,e)=>new Zt({type:r,typeName:U.ZodPromise,...J(e)});var st=class extends Y{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===U.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:o=>{E(n,o),o.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let o=s.transform(n.data,i);if(n.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return K;let l=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return l.status==="aborted"?K:l.status==="dirty"||t.value==="dirty"?Cn(l.value):l});{if(t.value==="aborted")return K;let a=this._def.schema._parseSync({data:o,path:n.path,parent:n});return a.status==="aborted"?K:a.status==="dirty"||t.value==="dirty"?Cn(a.value):a}}if(s.type==="refinement"){let o=a=>{let l=s.refinement(a,i);if(n.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?K:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?K:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(s.type==="transform")if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Pr(o))return o;let a=s.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>Pr(o)?Promise.resolve(s.transform(o.value,i)).then(a=>({status:t.value,value:a})):o);se.assertNever(s)}};st.create=(r,e,t)=>new st({schema:r,typeName:U.ZodEffects,effect:e,...J(t)});st.createWithPreprocess=(r,e,t)=>new st({schema:e,effect:{type:"preprocess",transform:r},typeName:U.ZodEffects,...J(t)});var rt=class extends Y{_parse(e){return this._getType(e)===k.undefined?Ve(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};rt.create=(r,e)=>new rt({innerType:r,typeName:U.ZodOptional,...J(e)});var _t=class extends Y{_parse(e){return this._getType(e)===k.null?Ve(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};_t.create=(r,e)=>new _t({innerType:r,typeName:U.ZodNullable,...J(e)});var Dr=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===k.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Dr.create=(r,e)=>new Dr({innerType:r,typeName:U.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...J(e)});var Rr=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Zi(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Re(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Re(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Rr.create=(r,e)=>new Rr({innerType:r,typeName:U.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...J(e)});var Ln=class extends Y{_parse(e){if(this._getType(e)!==k.nan){let n=this._getOrReturnCtx(e);return E(n,{code:x.invalid_type,expected:k.nan,received:n.parsedType}),K}return{status:"valid",value:e.data}}};Ln.create=r=>new Ln({typeName:U.ZodNaN,...J(r)});var LT=Symbol("zod_brand"),Gi=class extends Y{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},zr=class extends Y{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?K:i.status==="dirty"?(t.dirty(),Cn(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?K:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new zr({in:e,out:t,typeName:U.ZodPipeline})}},Fr=class extends Y{_parse(e){let t=this._def.innerType._parse(e),n=s=>(Pr(s)&&(s.value=Object.freeze(s.value)),s);return Zi(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}};Fr.create=(r,e)=>new Fr({innerType:r,typeName:U.ZodReadonly,...J(e)});var DT={object:we.lazycreate},U;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(U||(U={}));var RT=tt.create,zT=kt.create,FT=Ln.create,QT=$t.create,qT=On.create,BT=Kt.create,VT=kn.create,UT=Er.create,KT=Or.create,ZT=$n.create,WT=Ot.create,GT=mt.create,JT=In.create,HT=We.create,YT=we.create,XT=we.strictCreate,ex=kr.create,tx=Mn.create,rx=$r.create,nx=nt.create,sx=Ir.create,ix=jn.create,ox=It.create,ax=Ut.create,cx=Mr.create,lx=jr.create,ux=vt.create,fx=Lr.create,dx=Zt.create,mx=st.create,hx=rt.create,px=_t.create,gx=st.createWithPreprocess,yx=zr.create;var nu=async(r,e)=>{try{let t=JSON.parse(r.body??"{}");return{statusCode:201,body:JSON.stringify({pricingRequestId:"7c8b649c-f967-4216-96ed-cb23dbcdd426",category:"ANARI XL",travelTime:"25 mins",travelDistance:"15 mi",estimatedDeliveryTime:"45 mins",feeBreakdown:{total:10.5,surcharges:[{reason:"High Congestion Area",fee:.5}],distanceCharge:5,weightCharge:5},estimatedArrivalTime:"5:30 PM",expiresAt:1742831956})}}catch(t){throw t instanceof Re?new ru.BadRequestError(t.message,{context:t.errors}):t}};function su(){let r=er(process.env.DATABASE_URL,{prepare:!1}),e=zi({client:r,casing:"snake_case"});return{service:new Ki(e,Nr),routes:[{method:"POST",path:"/pricing-requests",handler:nu}]}}var{routes:kg,service:$g}=su(),Ig=async r=>{console.log("Incoming request:",r.httpMethod,r.path);let e=kg.find(t=>t.method===r.httpMethod&&t.path===r.path);if(!e)return{statusCode:404,body:JSON.stringify({error:"Route not found"})};try{return await e.handler(r,$g)}catch(t){return console.error("Error handling request:",t),{statusCode:t.statusCode??500,body:t?.errors?JSON.stringify(t.errors):"Internal Server Error"}}};0&&(module.exports={lambdaHandler});
//# sourceMappingURL=app.js.map
